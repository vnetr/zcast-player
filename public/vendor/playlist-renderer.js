function t(t,e,i,r){var n,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(a=(s<3?n(a):s>3?n(e,i,a):n(e,i))||a);return s>3&&a&&Object.defineProperty(e,i,a),a}function e(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}"function"==typeof SuppressedError&&SuppressedError;const i=globalThis,r=i.ShadowRoot&&(void 0===i.ShadyCSS||i.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,n=Symbol(),s=new WeakMap;let a=class{constructor(t,e,i){if(this._$cssResult$=!0,i!==n)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(r&&void 0===t){const i=void 0!==e&&1===e.length;i&&(t=s.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&s.set(e,t))}return t}toString(){return this.cssText}};const o=r?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return(t=>new a("string"==typeof t?t:t+"",void 0,n))(e)})(t):t,{is:l,defineProperty:d,getOwnPropertyDescriptor:u,getOwnPropertyNames:h,getOwnPropertySymbols:c,getPrototypeOf:p}=Object,m=globalThis,y=m.trustedTypes,f=y?y.emptyScript:"",v=m.reactiveElementPolyfillSupport,g=(t,e)=>t,_={toAttribute(t,e){switch(e){case Boolean:t=t?f:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},$=(t,e)=>!l(t,e),b={attribute:!0,type:String,converter:_,reflect:!1,useDefault:!1,hasChanged:$};Symbol.metadata??=Symbol("metadata"),m.litPropertyMetadata??=new WeakMap;let A=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=b){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(t,i,e);void 0!==r&&d(this.prototype,t,r)}}static getPropertyDescriptor(t,e,i){const{get:r,set:n}=u(this.prototype,t)??{get(){return this[e]},set(t){this[e]=t}};return{get:r,set(e){const s=r?.call(this);n?.call(this,e),this.requestUpdate(t,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??b}static _$Ei(){if(this.hasOwnProperty(g("elementProperties")))return;const t=p(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(g("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(g("properties"))){const t=this.properties,e=[...h(t),...c(t)];for(const i of e)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const e=litPropertyMetadata.get(t);if(void 0!==e)for(const[t,i]of e)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const i=this._$Eu(t,e);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const t of i)e.unshift(o(t))}else void 0!==t&&e.push(o(t));return e}static _$Eu(t,e){const i=e.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{if(r)t.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const r of e){const e=document.createElement("style"),n=i.litNonce;void 0!==n&&e.setAttribute("nonce",n),e.textContent=r.cssText,t.appendChild(e)}})(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$ET(t,e){const i=this.constructor.elementProperties.get(t),r=this.constructor._$Eu(t,i);if(void 0!==r&&!0===i.reflect){const n=(void 0!==i.converter?.toAttribute?i.converter:_).toAttribute(e,i.type);this._$Em=t,null==n?this.removeAttribute(r):this.setAttribute(r,n),this._$Em=null}}_$AK(t,e){const i=this.constructor,r=i._$Eh.get(t);if(void 0!==r&&this._$Em!==r){const t=i.getPropertyOptions(r),n="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:_;this._$Em=r;const s=n.fromAttribute(e,t.type);this[r]=s??this._$Ej?.get(r)??s,this._$Em=null}}requestUpdate(t,e,i){if(void 0!==t){const r=this.constructor,n=this[t];if(i??=r.getPropertyOptions(t),!((i.hasChanged??$)(n,e)||i.useDefault&&i.reflect&&n===this._$Ej?.get(t)&&!this.hasAttribute(r._$Eu(t,i))))return;this.C(t,e,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(t,e,{useDefault:i,reflect:r,wrapped:n},s){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,s??e??this[t]),!0!==n||void 0!==s)||(this._$AL.has(t)||(this.hasUpdated||i||(e=void 0),this._$AL.set(t,e)),!0===r&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,e]of this._$Ep)this[t]=e;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,i]of t){const{wrapped:t}=i,r=this[e];!0!==t||this._$AL.has(e)||void 0===r||this.C(e,void 0,i,r)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach(t=>t.hostUpdate?.()),this.update(e)):this._$EM()}catch(e){throw t=!1,this._$EM(),e}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(t=>this._$ET(t,this[t])),this._$EM()}updated(t){}firstUpdated(t){}};A.elementStyles=[],A.shadowRootOptions={mode:"open"},A[g("elementProperties")]=new Map,A[g("finalized")]=new Map,v?.({ReactiveElement:A}),(m.reactiveElementVersions??=[]).push("2.1.1");const w=globalThis,T=w.trustedTypes,E=T?T.createPolicy("lit-html",{createHTML:t=>t}):void 0,x="$lit$",O=`lit$${Math.random().toFixed(9).slice(2)}$`,S="?"+O,P=`<${S}>`,R=document,D=()=>R.createComment(""),M=t=>null===t||"object"!=typeof t&&"function"!=typeof t,C=Array.isArray,I="[ \t\n\f\r]",j=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,U=/-->/g,k=/>/g,q=RegExp(`>|${I}(?:([^\\s"'>=/]+)(${I}*=${I}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),N=/'/g,H=/"/g,z=/^(?:script|style|textarea|title)$/i,F=(t=>(e,...i)=>({_$litType$:t,strings:e,values:i}))(1),L=Symbol.for("lit-noChange"),B=Symbol.for("lit-nothing"),V=new WeakMap,W=R.createTreeWalker(R,129);function K(t,e){if(!C(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==E?E.createHTML(e):e}const Z=(t,e)=>{const i=t.length-1,r=[];let n,s=2===e?"<svg>":3===e?"<math>":"",a=j;for(let e=0;e<i;e++){const i=t[e];let o,l,d=-1,u=0;for(;u<i.length&&(a.lastIndex=u,l=a.exec(i),null!==l);)u=a.lastIndex,a===j?"!--"===l[1]?a=U:void 0!==l[1]?a=k:void 0!==l[2]?(z.test(l[2])&&(n=RegExp("</"+l[2],"g")),a=q):void 0!==l[3]&&(a=q):a===q?">"===l[0]?(a=n??j,d=-1):void 0===l[1]?d=-2:(d=a.lastIndex-l[2].length,o=l[1],a=void 0===l[3]?q:'"'===l[3]?H:N):a===H||a===N?a=q:a===U||a===k?a=j:(a=q,n=void 0);const h=a===q&&t[e+1].startsWith("/>")?" ":"";s+=a===j?i+P:d>=0?(r.push(o),i.slice(0,d)+x+i.slice(d)+O+h):i+O+(-2===d?e:h)}return[K(t,s+(t[i]||"<?>")+(2===e?"</svg>":3===e?"</math>":"")),r]};class J{constructor({strings:t,_$litType$:e},i){let r;this.parts=[];let n=0,s=0;const a=t.length-1,o=this.parts,[l,d]=Z(t,e);if(this.el=J.createElement(l,i),W.currentNode=this.el.content,2===e||3===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(r=W.nextNode())&&o.length<a;){if(1===r.nodeType){if(r.hasAttributes())for(const t of r.getAttributeNames())if(t.endsWith(x)){const e=d[s++],i=r.getAttribute(t).split(O),a=/([.?@])?(.*)/.exec(e);o.push({type:1,index:n,name:a[2],strings:i,ctor:"."===a[1]?tt:"?"===a[1]?et:"@"===a[1]?it:Y}),r.removeAttribute(t)}else t.startsWith(O)&&(o.push({type:6,index:n}),r.removeAttribute(t));if(z.test(r.tagName)){const t=r.textContent.split(O),e=t.length-1;if(e>0){r.textContent=T?T.emptyScript:"";for(let i=0;i<e;i++)r.append(t[i],D()),W.nextNode(),o.push({type:2,index:++n});r.append(t[e],D())}}}else if(8===r.nodeType)if(r.data===S)o.push({type:2,index:n});else{let t=-1;for(;-1!==(t=r.data.indexOf(O,t+1));)o.push({type:7,index:n}),t+=O.length-1}n++}}static createElement(t,e){const i=R.createElement("template");return i.innerHTML=t,i}}function G(t,e,i=t,r){if(e===L)return e;let n=void 0!==r?i._$Co?.[r]:i._$Cl;const s=M(e)?void 0:e._$litDirective$;return n?.constructor!==s&&(n?._$AO?.(!1),void 0===s?n=void 0:(n=new s(t),n._$AT(t,i,r)),void 0!==r?(i._$Co??=[])[r]=n:i._$Cl=n),void 0!==n&&(e=G(t,n._$AS(t,e.values),n,r)),e}class Q{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,r=(t?.creationScope??R).importNode(e,!0);W.currentNode=r;let n=W.nextNode(),s=0,a=0,o=i[0];for(;void 0!==o;){if(s===o.index){let e;2===o.type?e=new X(n,n.nextSibling,this,t):1===o.type?e=new o.ctor(n,o.name,o.strings,this,t):6===o.type&&(e=new rt(n,this,t)),this._$AV.push(e),o=i[++a]}s!==o?.index&&(n=W.nextNode(),s++)}return W.currentNode=R,r}p(t){let e=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class X{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,i,r){this.type=2,this._$AH=B,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=r,this._$Cv=r?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=G(this,t,e),M(t)?t===B||null==t||""===t?(this._$AH!==B&&this._$AR(),this._$AH=B):t!==this._$AH&&t!==L&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>C(t)||"function"==typeof t?.[Symbol.iterator])(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==B&&M(this._$AH)?this._$AA.nextSibling.data=t:this.T(R.createTextNode(t)),this._$AH=t}$(t){const{values:e,_$litType$:i}=t,r="number"==typeof i?this._$AC(t):(void 0===i.el&&(i.el=J.createElement(K(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===r)this._$AH.p(e);else{const t=new Q(r,this),i=t.u(this.options);t.p(e),this.T(i),this._$AH=t}}_$AC(t){let e=V.get(t.strings);return void 0===e&&V.set(t.strings,e=new J(t)),e}k(t){C(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,r=0;for(const n of t)r===e.length?e.push(i=new X(this.O(D()),this.O(D()),this,this.options)):i=e[r],i._$AI(n),r++;r<e.length&&(this._$AR(i&&i._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class Y{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,r,n){this.type=1,this._$AH=B,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=n,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=B}_$AI(t,e=this,i,r){const n=this.strings;let s=!1;if(void 0===n)t=G(this,t,e,0),s=!M(t)||t!==this._$AH&&t!==L,s&&(this._$AH=t);else{const r=t;let a,o;for(t=n[0],a=0;a<n.length-1;a++)o=G(this,r[i+a],e,a),o===L&&(o=this._$AH[a]),s||=!M(o)||o!==this._$AH[a],o===B?t=B:t!==B&&(t+=(o??"")+n[a+1]),this._$AH[a]=o}s&&!r&&this.j(t)}j(t){t===B?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class tt extends Y{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===B?void 0:t}}class et extends Y{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==B)}}class it extends Y{constructor(t,e,i,r,n){super(t,e,i,r,n),this.type=5}_$AI(t,e=this){if((t=G(this,t,e,0)??B)===L)return;const i=this._$AH,r=t===B&&i!==B||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,n=t!==B&&(i===B||r);r&&this.element.removeEventListener(this.name,this,i),n&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class rt{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){G(this,t)}}const nt=w.litHtmlPolyfillSupport;nt?.(J,X),(w.litHtmlVersions??=[]).push("3.3.1");const st=globalThis;class at extends A{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,i)=>{const r=i?.renderBefore??e;let n=r._$litPart$;if(void 0===n){const t=i?.renderBefore??null;r._$litPart$=n=new X(e.insertBefore(D(),t),t,void 0,i??{})}return n._$AI(t),n})(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return L}}at._$litElement$=!0,at.finalized=!0,st.litElementHydrateSupport?.({LitElement:at});const ot=st.litElementPolyfillSupport;ot?.({LitElement:at}),(st.litElementVersions??=[]).push("4.2.1");const lt=t=>(e,i)=>{void 0!==i?i.addInitializer(()=>{customElements.define(t,e)}):customElements.define(t,e)},dt={attribute:!0,type:String,converter:_,reflect:!1,hasChanged:$},ut=(t=dt,e,i)=>{const{kind:r,metadata:n}=i;let s=globalThis.litPropertyMetadata.get(n);if(void 0===s&&globalThis.litPropertyMetadata.set(n,s=new Map),"setter"===r&&((t=Object.create(t)).wrapped=!0),s.set(i.name,t),"accessor"===r){const{name:r}=i;return{set(i){const n=e.get.call(this);e.set.call(this,i),this.requestUpdate(r,n,t)},init(e){return void 0!==e&&this.C(r,void 0,t,e),e}}}if("setter"===r){const{name:r}=i;return function(i){const n=this[r];e.call(this,i),this.requestUpdate(r,n,t)}}throw Error("Unsupported decorator location: "+r)};function ht(t){return(e,i)=>"object"==typeof i?ut(t,e,i):((t,e,i)=>{const r=e.hasOwnProperty(i);return e.constructor.createProperty(i,t),r?Object.getOwnPropertyDescriptor(e,i):void 0})(t,e,i)}function ct(t){return ht({...t,state:!0,attribute:!1})}function pt(t,e){return(e,i,r)=>((t,e,i)=>(i.configurable=!0,i.enumerable=!0,Reflect.decorate&&"object"!=typeof e&&Object.defineProperty(t,e,i),i))(e,i,{get(){return(e=>e.renderRoot?.querySelector(t)??null)(this)}})}let mt=class extends at{constructor(){super(...arguments),this.parentDocument=null,this.zoomFactor=1,this.frameRate=30,this.currentTimestamp=0,this.order=0,this.startTimestamp=0,this.endTimestamp=0,this.isPlaying=!1}async play(){this.isPlaying=!0}async pause(){this.isPlaying=!1}async stop(){this.isPlaying=!1}updated(t){super.updated(t)}render(){var t;return this.style.position="absolute",this.style.top="0",this.style.left="0",this.id=(null===(t=this.document)||void 0===t?void 0:t.id)||"item-renderer-"+Math.random().toString(36).substring(2,15),super.render()}};t([ht({type:Object}),e("design:type",Object)],mt.prototype,"document",void 0),t([ht({type:Object}),e("design:type",Object)],mt.prototype,"parentDocument",void 0),t([ht({type:Number}),e("design:type",Object)],mt.prototype,"zoomFactor",void 0),t([ht({type:Number}),e("design:type",Object)],mt.prototype,"frameRate",void 0),t([ht({type:Number}),e("design:type",Object)],mt.prototype,"currentTimestamp",void 0),t([ht({type:Number}),e("design:type",Object)],mt.prototype,"order",void 0),t([ht({type:Number}),e("design:type",Object)],mt.prototype,"startTimestamp",void 0),t([ht({type:Number}),e("design:type",Object)],mt.prototype,"endTimestamp",void 0),t([ht({type:Boolean}),e("design:type",Object)],mt.prototype,"isPlaying",void 0),mt=t([lt("item-renderer")],mt);var yt=mt;const ft=new Map,vt=new Map,gt=new Map,_t=t=>["running","finished"].includes(t.playState);gt.set("easeOutQuad","cubic-bezier(0.25, 0.46, 0.45, 0.94)"),gt.set("ease-in","ease-in"),gt.set("ease-out","ease-out"),gt.set("ease-in-out","ease-in-out"),gt.set("linear","linear"),ft.set("fade",()=>({keyframes:[{opacity:0},{opacity:1}],options:{fill:"forwards"}})),ft.set("slide-left",t=>({keyframes:[{transform:`translate3d(${t.width}px, 0px, 0px)`},{transform:"translate3d(0px, 0px, 0px)"}],options:{fill:"forwards"}})),ft.set("slide-right",t=>({keyframes:[{transform:`translate3d(-${t.width}px, 0px, 0px)`},{transform:"translate3d(0px, 0px, 0px)"}],options:{fill:"forwards"}})),ft.set("slide-up",t=>({keyframes:[{transform:`translate3d(0px, ${t.height}px, 0px)`},{transform:"translate3d(0px, 0px, 0px)"}],options:{fill:"forwards"}})),ft.set("slide-down",t=>({keyframes:[{transform:`translate3d(0px, -${t.height}px, 0px)`},{transform:"translate3d(0px, 0px, 0px)"}],options:{fill:"forwards"}})),vt.set("fade",()=>({keyframes:[{opacity:1},{opacity:0}],options:{fill:"forwards"}})),vt.set("slide-left",t=>({keyframes:[{transform:"translate3d(0px, 0px, 0px)"},{transform:`translate3d(-${t.width}px, 0px, 0px)`}],options:{fill:"forwards"}})),vt.set("slide-right",t=>({keyframes:[{transform:"translate3d(0px, 0px, 0px)"},{transform:`translate3d(${t.width}px, 0px, 0px)`}],options:{fill:"forwards"}})),vt.set("slide-up",t=>({keyframes:[{transform:"translate3d(0px, 0px, 0px)"},{transform:`translate3d(0px, -${t.height}px, 0px)`}],options:{fill:"forwards"}})),vt.set("slide-down",t=>({keyframes:[{transform:"translate3d(0px, 0px, 0px)"},{transform:`translate3d(0px, ${t.height}px, 0px)`}],options:{fill:"forwards"}}));const $t=t=>class extends t{constructor(){super(...arguments),this.onAnimationPlay=t=>{},this.onAnimationFinish=t=>{},this.onAnimationCancel=t=>{}}connectedCallback(){super.connectedCallback(),this.ensureTransitions()}async play(){await super.play(),this.ensureTransitions(),this.playTransitionIn(),this.playTransitionOut()}async pause(){var t,e;await super.pause(),null===(t=this.transitionInAnimation)||void 0===t||t.pause(),null===(e=this.transitionOutAnimation)||void 0===e||e.pause()}async stop(){await super.stop(),this.cleanupAnimations(),this.resetStyling()}updated(t){if(super.updated(t),t.has("currentTimestamp")){const t=Math.max(0,Math.floor(this.currentTimestamp||0)-Math.floor(this.startTimestamp||0)),e=Math.floor(this.endTimestamp||0)-Math.floor(this.startTimestamp||0);if(((t,e,i)=>t<0||t>e||i)(t,e,t<Math.floor(1e3/this.frameRate)))return void this.resetStyling();t>=Math.floor(.5*e)?(this.transitionInAnimation&&_t(this.transitionInAnimation)&&(this.transitionInAnimation.cancel(),this.transitionInAnimation=void 0),this.playTransitionOut()):this.playTransitionIn()}}playTransitionIn(){var t,e,i;const r=Math.max(0,Math.floor(this.currentTimestamp||0)-Math.floor(this.startTimestamp||0)),n=((t,e)=>!!((null==t?void 0:t.transition_in)&&t.transition_in.duration>0&&t.transition_in.duration>=e))(this.document,r);if(null===(t=this.document)||void 0===t||t.id,n){if(!this.transitionInAnimation){const t=null===(e=this.document)||void 0===e?void 0:e.transition_in;t&&"none"!==t.type&&t.duration>0&&(this.transitionInAnimation=this.createTransitionInAnimation(t))}this.transitionInAnimation&&!_t(this.transitionInAnimation)&&(this.transitionInAnimation.currentTime=r,requestAnimationFrame(()=>{var t;null===(t=this.transitionInAnimation)||void 0===t||t.play()}))}else this.transitionInAnimation&&(null===(i=this.transitionInAnimation)||void 0===i||i.pause())}playTransitionOut(){var t,e,i,r,n;const s=Math.max(0,Math.floor(this.currentTimestamp||0)-Math.floor(this.startTimestamp||0)),a=Math.floor(this.endTimestamp||0)-Math.floor(this.startTimestamp||0),o=((t,e,i)=>{var r,n;const s=(null===(r=null==t?void 0:t.transition_out)||void 0===r?void 0:r.duration)||0,a=(null===(n=null==t?void 0:t.transition_in)||void 0===n?void 0:n.duration)||0,o=(null==t?void 0:t.transition_in)&&a>0?a:0,l=Math.max(0,i-s),d=Math.max(o,l);return!!((null==t?void 0:t.transition_out)&&t.transition_out.duration>0&&d<=e&&e<i)})(this.document,s,a);if(null===(t=this.document)||void 0===t||t.id,o){if(!this.transitionOutAnimation){const t=null===(e=this.document)||void 0===e?void 0:e.transition_out;t&&"none"!==t.type&&t.duration>0&&(this.transitionOutAnimation=this.createTransitionOutAnimation(t))}if(this.transitionOutAnimation&&!_t(this.transitionOutAnimation)){this.transitionInAnimation&&(this.transitionInAnimation.cancel(),this.transitionInAnimation=void 0);const t=((t,e)=>Math.max(0,t-e))(a,Math.floor((null===(r=null===(i=this.document)||void 0===i?void 0:i.transition_out)||void 0===r?void 0:r.duration)||0)),e=s-t;this.transitionOutAnimation.currentTime=Math.max(0,e),requestAnimationFrame(()=>{var t;null===(t=this.transitionOutAnimation)||void 0===t||t.play()})}}else this.transitionOutAnimation&&(null===(n=this.transitionOutAnimation)||void 0===n||n.pause())}ensureTransitions(){}createTransitionInAnimation(t){return this.createAnimationFromTransition(t,ft)}createTransitionOutAnimation(t){return this.createAnimationFromTransition(t,vt)}createAnimationFromTransition(t,e){var i,r,n,s,a,o,l,d;const u=(t=>gt.get(t||"linear")||"linear")(t.easing),h=e.get(t.type);if(h){const e={width:(null===(r=null===(i=this.parentDocument)||void 0===i?void 0:i.properties)||void 0===r?void 0:r.width)||(null===(s=null===(n=this.document)||void 0===n?void 0:n.properties)||void 0===s?void 0:s.width)||0,height:(null===(o=null===(a=this.parentDocument)||void 0===a?void 0:a.properties)||void 0===o?void 0:o.height)||(null===(d=null===(l=this.document)||void 0===l?void 0:l.properties)||void 0===d?void 0:d.height)||0},{keyframes:c,options:p}=h(e),m=this.animate(c,{...p,duration:t.duration,easing:u});return m.pause(),m.addEventListener("play",this.onAnimationPlay),m.addEventListener("finish",this.onAnimationFinish),m.addEventListener("cancel",this.onAnimationCancel),m}console.warn("[WARNING] Unknown transition type:",t.type,"on",this.document)}cleanupAnimations(){this.transitionInAnimation&&(this.transitionInAnimation.removeEventListener("play",this.onAnimationPlay),this.transitionInAnimation.removeEventListener("finish",this.onAnimationFinish),this.transitionInAnimation.removeEventListener("cancel",this.onAnimationCancel),this.transitionInAnimation.cancel(),this.transitionInAnimation=void 0),this.transitionOutAnimation&&(this.transitionOutAnimation.removeEventListener("play",this.onAnimationPlay),this.transitionOutAnimation.removeEventListener("finish",this.onAnimationFinish),this.transitionOutAnimation.removeEventListener("cancel",this.onAnimationCancel),this.transitionOutAnimation.cancel(),this.transitionOutAnimation=void 0)}resetStyling(){var t,e;this.style.opacity="",this.style.transform="",this.style.visibility="",null===(t=this.transitionInAnimation)||void 0===t||t.cancel(),null===(e=this.transitionOutAnimation)||void 0===e||e.cancel()}disconnectedCallback(){super.disconnectedCallback(),this.cleanupAnimations()}};let bt=class extends($t(yt)){connectedCallback(){super.connectedCallback(),requestAnimationFrame(()=>{if(this.layoutRenderer){const t=this.currentTimestamp-this.startTimestamp;this.layoutRenderer.currentTimestamp=Math.max(0,t)}else console.error("[ERROR] LayoutRenderer not found",this)})}updated(t){if(super.updated(t),t.has("document")&&this.document&&"layout-document"===this.document.type&&(this.layoutDocument=this.document.originalDocument,requestAnimationFrame(()=>{this.layoutRenderer&&(this.layoutRenderer.currentTimestamp=0)})),t.has("currentTimestamp")&&this.layoutRenderer){const t=Math.max(0,Math.floor(this.currentTimestamp)-Math.floor(this.startTimestamp)),e=Math.floor(this.endTimestamp)-Math.floor(this.startTimestamp),i=t>=0&&t<e;this.dataset.relativeLayoutTimestamp=t.toString(),this.dataset.actualLayoutTimestamp=this.layoutRenderer.currentTimestamp.toString(),this.dataset.shouldBeVisible=i.toString(),this.layoutRenderer.currentTimestamp=i?t:0}}async play(){if(!this.layoutRenderer)return Promise.resolve();if(this.isPlaying)return Promise.resolve();const t=Math.max(0,Math.floor(this.currentTimestamp)-Math.floor(this.startTimestamp)),e=Math.floor(this.endTimestamp)-Math.floor(this.startTimestamp),i=t>=0&&t<e;if(this.dataset.relativeLayoutTimestamp=Math.max(0,t).toString(),this.dataset.shouldBeVisible=i.toString(),!i)return this.layoutRenderer.currentTimestamp=0,this.dataset.actualLayoutTimestamp="0",this.dataset.isPlaying="false",Promise.resolve();await Promise.all([super.play(),(async()=>{const t=Math.max(0,Math.floor(this.currentTimestamp)-Math.floor(this.startTimestamp));this.layoutRenderer.currentTimestamp=t,this.dataset.actualLayoutTimestamp=this.layoutRenderer.currentTimestamp.toString(),this.dataset.isPlaying="true",await this.layoutRenderer.play()})()])}async pause(){if(!this.layoutRenderer)return Promise.resolve();await Promise.all([super.pause(),(async()=>{await this.layoutRenderer.pause(),this.dataset.isPlaying="false",this.dataset.relativeLayoutTimestamp="0",this.dataset.actualLayoutTimestamp=this.layoutRenderer.currentTimestamp.toString()})()])}async stop(){await Promise.all([super.stop(),(async()=>{this.layoutRenderer&&(await this.layoutRenderer.stop(),this.layoutRenderer.currentTimestamp=0,this.dataset.isPlaying="false",this.dataset.relativeLayoutTimestamp="0",this.dataset.actualLayoutTimestamp="0",this.dataset.shouldBeVisible="false")})()])}render(){return super.render(),F`
            <layout-renderer 
                .document=${this.layoutDocument}
                .frameRate=${Math.max(this.frameRate||30,30)}
                .editingMode=${"false"}
                .playbackMode=${"gpu"}
                .zoomFactor=${1}
            ></layout-renderer>
        `}};t([pt("layout-renderer"),e("design:type",Object)],bt.prototype,"layoutRenderer",void 0),t([ct(),e("design:type",Object)],bt.prototype,"layoutDocument",void 0),bt=t([lt("layout-item-renderer")],bt);var At=bt;const wt=[];for(let t=0;t<256;++t)wt.push((t+256).toString(16).slice(1));let Tt;const Et=new Uint8Array(16);var xt={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ot(t,e,i){if(xt.randomUUID&&!t)return xt.randomUUID();const r=(t=t||{}).random??t.rng?.()??function(){if(!Tt){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Tt=crypto.getRandomValues.bind(crypto)}return Tt(Et)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(t,e=0){return(wt[t[e+0]]+wt[t[e+1]]+wt[t[e+2]]+wt[t[e+3]]+"-"+wt[t[e+4]]+wt[t[e+5]]+"-"+wt[t[e+6]]+wt[t[e+7]]+"-"+wt[t[e+8]]+wt[t[e+9]]+"-"+wt[t[e+10]]+wt[t[e+11]]+wt[t[e+12]]+wt[t[e+13]]+wt[t[e+14]]+wt[t[e+15]]).toLowerCase()}(r)}function St(t,e){var i;if(!t)return null;let r=[];const n=(null===(i=null==t?void 0:t.media_type)||void 0===i?void 0:i.split("/")[0])||"";if(!n||"external_link"===n)return null;"video"===n&&r.push(function(t,e){return{id:Ot(),type:"video",name:t.name||"",content:{type:"video",src:t.original_file||""},props:{width:t.resolution_width||0,height:t.resolution_height||0,x:0,y:0,background:"transparent"},options:{start:0,end:e||0,visible:!0,locked:!1,selected:!1}}}(t,e)),"audio"===n&&r.push(function(t,e){return{id:Ot(),type:"audio",name:t.name||"",content:{type:"audio",src:t.original_file||""},options:{start:0,end:e||0},props:{width:t.resolution_width||0,height:t.resolution_height||0,x:0,y:0,background:"transparent"}}}(t,e)),"image"===n&&r.push(function(t,e){return{id:Ot(),type:"image",name:t.name||"",content:{type:"image",src:t.original_file||""},props:{width:t.resolution_width||0,height:t.resolution_height||0,x:0,y:0,background:"transparent"},options:{start:0,end:e||0}}}(t,e));return{version:1,id:Ot(),options:{duration:e||0,start:0,end:e||0},children:r,name:t.name||"",type:"layout",props:{width:t.resolution_width||0,height:t.resolution_height||0,background:"transparent"}}}let Pt=class extends At{constructor(){var t;if(super(),this.document&&"media-asset"===this.document.type){const e=this.document.duration_overwrite||(null===(t=this.document.originalDocument)||void 0===t?void 0:t.duration_ms)||0;this.layoutDocument=St(this.document.originalDocument,e)}}async play(){await super.play()}async pause(){await super.pause()}async stop(){await super.stop()}updated(t){var e;if(t.has("document")&&this.document&&"media-asset"===this.document.type){const t=this.document.duration_overwrite||(null===(e=this.document.originalDocument)||void 0===e?void 0:e.duration_ms)||0;this.layoutDocument=St(this.document.originalDocument,t)}super.updated(t)}render(){return super.render()}};Pt=t([lt("asset-item-renderer"),e("design:paramtypes",[])],Pt);var Rt=Pt,Dt=Object.getOwnPropertyNames,Mt=Object.getOwnPropertySymbols,Ct=Object.prototype.hasOwnProperty;function It(t,e){return function(i,r,n){return t(i,r,n)&&e(i,r,n)}}function jt(t){return function(e,i,r){if(!e||!i||"object"!=typeof e||"object"!=typeof i)return t(e,i,r);var n=r.cache,s=n.get(e),a=n.get(i);if(s&&a)return s===i&&a===e;n.set(e,i),n.set(i,e);var o=t(e,i,r);return n.delete(e),n.delete(i),o}}function Ut(t){return Dt(t).concat(Mt(t))}var kt=Object.hasOwn||function(t,e){return Ct.call(t,e)};function qt(t,e){return t===e||!t&&!e&&t!=t&&e!=e}var Nt=Object.getOwnPropertyDescriptor,Ht=Object.keys;function zt(t,e,i){var r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(!i.equals(t[r],e[r],r,r,t,e,i))return!1;return!0}function Ft(t,e){return qt(t.getTime(),e.getTime())}function Lt(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function Bt(t,e){return t===e}function Vt(t,e,i){var r=t.size;if(r!==e.size)return!1;if(!r)return!0;for(var n,s,a=new Array(r),o=t.entries(),l=0;(n=o.next())&&!n.done;){for(var d=e.entries(),u=!1,h=0;(s=d.next())&&!s.done;)if(a[h])h++;else{var c=n.value,p=s.value;if(i.equals(c[0],p[0],l,h,t,e,i)&&i.equals(c[1],p[1],c[0],p[0],t,e,i)){u=a[h]=!0;break}h++}if(!u)return!1;l++}return!0}var Wt=qt;function Kt(t,e,i){var r=Ht(t),n=r.length;if(Ht(e).length!==n)return!1;for(;n-- >0;)if(!te(t,e,i,r[n]))return!1;return!0}function Zt(t,e,i){var r,n,s,a=Ut(t),o=a.length;if(Ut(e).length!==o)return!1;for(;o-- >0;){if(!te(t,e,i,r=a[o]))return!1;if(n=Nt(t,r),s=Nt(e,r),(n||s)&&(!n||!s||n.configurable!==s.configurable||n.enumerable!==s.enumerable||n.writable!==s.writable))return!1}return!0}function Jt(t,e){return qt(t.valueOf(),e.valueOf())}function Gt(t,e){return t.source===e.source&&t.flags===e.flags}function Qt(t,e,i){var r=t.size;if(r!==e.size)return!1;if(!r)return!0;for(var n,s,a=new Array(r),o=t.values();(n=o.next())&&!n.done;){for(var l=e.values(),d=!1,u=0;(s=l.next())&&!s.done;){if(!a[u]&&i.equals(n.value,s.value,n.value,s.value,t,e,i)){d=a[u]=!0;break}u++}if(!d)return!1}return!0}function Xt(t,e){var i=t.length;if(e.length!==i)return!1;for(;i-- >0;)if(t[i]!==e[i])return!1;return!0}function Yt(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function te(t,e,i,r){return!("_owner"!==r&&"__o"!==r&&"__v"!==r||!t.$$typeof&&!e.$$typeof)||kt(e,r)&&i.equals(t[r],e[r],r,r,t,e,i)}var ee=Array.isArray,ie="function"==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView:null,re=Object.assign,ne=Object.prototype.toString.call.bind(Object.prototype.toString);var se=ae();function ae(t){void 0===t&&(t={});var e,i=t.circular,r=void 0!==i&&i,n=t.createInternalComparator,s=t.createState,a=t.strict,o=void 0!==a&&a,l=function(t){var e=t.circular,i=t.createCustomConfig,r=t.strict,n={areArraysEqual:r?Zt:zt,areDatesEqual:Ft,areErrorsEqual:Lt,areFunctionsEqual:Bt,areMapsEqual:r?It(Vt,Zt):Vt,areNumbersEqual:Wt,areObjectsEqual:r?Zt:Kt,arePrimitiveWrappersEqual:Jt,areRegExpsEqual:Gt,areSetsEqual:r?It(Qt,Zt):Qt,areTypedArraysEqual:r?Zt:Xt,areUrlsEqual:Yt};if(i&&(n=re({},n,i(n))),e){var s=jt(n.areArraysEqual),a=jt(n.areMapsEqual),o=jt(n.areObjectsEqual),l=jt(n.areSetsEqual);n=re({},n,{areArraysEqual:s,areMapsEqual:a,areObjectsEqual:o,areSetsEqual:l})}return n}(t),d=function(t){var e=t.areArraysEqual,i=t.areDatesEqual,r=t.areErrorsEqual,n=t.areFunctionsEqual,s=t.areMapsEqual,a=t.areNumbersEqual,o=t.areObjectsEqual,l=t.arePrimitiveWrappersEqual,d=t.areRegExpsEqual,u=t.areSetsEqual,h=t.areTypedArraysEqual,c=t.areUrlsEqual;return function(t,p,m){if(t===p)return!0;if(null==t||null==p)return!1;var y=typeof t;if(y!==typeof p)return!1;if("object"!==y)return"number"===y?a(t,p,m):"function"===y&&n(t,p,m);var f=t.constructor;if(f!==p.constructor)return!1;if(f===Object)return o(t,p,m);if(ee(t))return e(t,p,m);if(null!=ie&&ie(t))return h(t,p,m);if(f===Date)return i(t,p,m);if(f===RegExp)return d(t,p,m);if(f===Map)return s(t,p,m);if(f===Set)return u(t,p,m);var v=ne(t);return"[object Date]"===v?i(t,p,m):"[object RegExp]"===v?d(t,p,m):"[object Map]"===v?s(t,p,m):"[object Set]"===v?u(t,p,m):"[object Object]"===v?"function"!=typeof t.then&&"function"!=typeof p.then&&o(t,p,m):"[object URL]"===v?c(t,p,m):"[object Error]"===v?r(t,p,m):"[object Arguments]"===v?o(t,p,m):("[object Boolean]"===v||"[object Number]"===v||"[object String]"===v)&&l(t,p,m)}}(l),u=n?n(d):(e=d,function(t,i,r,n,s,a,o){return e(t,i,o)});return function(t){var e=t.circular,i=t.comparator,r=t.createState,n=t.equals,s=t.strict;if(r)return function(t,a){var o=r(),l=o.cache,d=void 0===l?e?new WeakMap:void 0:l,u=o.meta;return i(t,a,{cache:d,equals:n,meta:u,strict:s})};if(e)return function(t,e){return i(t,e,{cache:new WeakMap,equals:n,meta:void 0,strict:s})};var a={cache:void 0,equals:n,meta:void 0,strict:s};return function(t,e){return i(t,e,a)}}({circular:r,comparator:d,createState:s,equals:u,strict:o})}ae({strict:!0}),ae({circular:!0}),ae({circular:!0,strict:!0}),ae({createInternalComparator:function(){return qt}}),ae({strict:!0,createInternalComparator:function(){return qt}}),ae({circular:!0,createInternalComparator:function(){return qt}}),ae({circular:!0,createInternalComparator:function(){return qt},strict:!0});let oe=class extends($t(yt)){constructor(){super(),this.setup()}updated(t){super.updated(t)}async play(){await Promise.all([super.play(),(async()=>{var t,e;return!0===(null===(t=this.playlistRenderer)||void 0===t?void 0:t.isPlaying)||await(null===(e=this.playlistRenderer)||void 0===e?void 0:e.play()),Promise.resolve()})()])}async pause(){await Promise.all([super.pause(),(async()=>{var t,e;return!1===(null===(t=this.playlistRenderer)||void 0===t?void 0:t.isPlaying)||await(null===(e=this.playlistRenderer)||void 0===e?void 0:e.pause()),Promise.resolve()})()])}async stop(){await Promise.all([super.stop(),(async()=>{var t;return await(null===(t=this.playlistRenderer)||void 0===t?void 0:t.stop()),Promise.resolve()})()])}async setup(){this.generatedPlaylistDocument=await this.fetch(),setInterval(async()=>{const t=await this.fetch();se(this.generatedPlaylistDocument,t)||(this.generatedPlaylistDocument=t)},1e3)}async fetch(){return{id:Ot(),name:"Dynamic DOOH",metadata:{created_at:(new Date).toISOString(),created_by:"system",last_edited_at:(new Date).toISOString(),last_edited_by:"system"},properties:{height:1920,width:1080},items:[{id:Ot(),name:"Dynamic DOOH",type:"media-asset",originalDocument:{id:Ot(),name:"Dynamic DOOH",media_type:"image",original_file:"https://placehold.co/1920x1080/orange/white",resolution_width:1080,resolution_height:1920,duration_ms:2500,file_size_human:"100KB"},created_at:(new Date).toISOString(),created_by:"system",last_edited_at:(new Date).toISOString(),last_edited_by:"system"},{id:Ot(),name:"Dynamic DOOH",type:"media-asset",originalDocument:{id:Ot(),name:"Dynamic DOOH",media_type:"image",original_file:"https://placehold.co/1920x1080/blue/white",resolution_width:1080,resolution_height:1920,duration_ms:2500,file_size_human:"100KB"},created_at:(new Date).toISOString(),created_by:"system",last_edited_at:(new Date).toISOString(),last_edited_by:"system"},{id:Ot(),name:"Dynamic DOOH",type:"media-asset",originalDocument:{id:Ot(),name:"Dynamic DOOH",media_type:"image",original_file:"https://placehold.co/1920x1080/green/white",resolution_width:1080,resolution_height:1920,duration_ms:5e3,file_size_human:"100KB"},created_at:(new Date).toISOString(),created_by:"system",last_edited_at:(new Date).toISOString(),last_edited_by:"system"}]}}render(){return super.render(),this.document&&"dynamic-dooh-document"===this.document.type?F`
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                <playlist-renderer
                    .document=${this.generatedPlaylistDocument}
                    .zoomFactor=${1}
                    .frameRate=${this.frameRate}
                    .currentTimestamp=${this.currentTimestamp}
                ></playlist-renderer>
            </div>
        `:F``}};t([pt("playlist-renderer"),e("design:type",Ae)],oe.prototype,"playlistRenderer",void 0),t([ct(),e("design:type",Object)],oe.prototype,"generatedPlaylistDocument",void 0),oe=t([lt("dynamic-dooh-item-renderer"),e("design:paramtypes",[])],oe);var le=oe;let de=class extends($t(yt)){updated(t){super.updated(t)}async play(){await Promise.all([super.play(),(async()=>{var t,e;return!0===(null===(t=this.playlistRenderer)||void 0===t?void 0:t.isPlaying)||await(null===(e=this.playlistRenderer)||void 0===e?void 0:e.play()),Promise.resolve()})()])}async pause(){await Promise.all([super.pause(),(async()=>{var t,e;return!1===(null===(t=this.playlistRenderer)||void 0===t?void 0:t.isPlaying)||await(null===(e=this.playlistRenderer)||void 0===e?void 0:e.pause()),Promise.resolve()})()])}async stop(){await Promise.all([super.stop(),(async()=>{var t;return await(null===(t=this.playlistRenderer)||void 0===t?void 0:t.stop()),Promise.resolve()})()])}render(){return super.render(),this.document&&"playlist-document"===this.document.type?F`
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                <playlist-renderer
                    .document=${this.document.originalDocument}
                    .zoomFactor=${1}
                    .frameRate=${this.frameRate}
                    .currentTimestamp=${this.currentTimestamp}
                ></playlist-renderer>
            </div>
        `:F``}};t([pt("playlist-renderer"),e("design:type",Ae)],de.prototype,"playlistRenderer",void 0),de=t([lt("playlist-item-renderer")],de);let ue=class extends($t(yt)){constructor(){super(),this.setup()}updated(t){super.updated(t)}async play(){await Promise.all([super.play(),(async()=>{var t,e;return!0===(null===(t=this.playlistRenderer)||void 0===t?void 0:t.isPlaying)||await(null===(e=this.playlistRenderer)||void 0===e?void 0:e.play()),Promise.resolve()})()])}async pause(){await Promise.all([super.pause(),(async()=>{var t,e;return!1===(null===(t=this.playlistRenderer)||void 0===t?void 0:t.isPlaying)||await(null===(e=this.playlistRenderer)||void 0===e?void 0:e.pause()),Promise.resolve()})()])}async stop(){await Promise.all([super.stop(),(async()=>{var t;return await(null===(t=this.playlistRenderer)||void 0===t?void 0:t.stop()),Promise.resolve()})()])}setup(){this.generatedPlaylistDocument={id:Ot(),name:"Static DOOH",metadata:{created_at:(new Date).toISOString(),created_by:"system",last_edited_at:(new Date).toISOString(),last_edited_by:"system"},properties:{height:1920,width:1080},items:[{id:Ot(),name:"Static DOOH",type:"media-asset",originalDocument:{id:Ot(),name:"Static DOOH",media_type:"image",original_file:"https://placehold.co/1920x1080/purple/white",resolution_width:1080,resolution_height:1920,duration_ms:2500,file_size_human:"100KB"},created_at:(new Date).toISOString(),created_by:"system",last_edited_at:(new Date).toISOString(),last_edited_by:"system"},{id:Ot(),name:"Static DOOH",type:"media-asset",originalDocument:{id:Ot(),name:"Static DOOH",media_type:"image",original_file:"https://placehold.co/1920x1080/pink/white",resolution_width:1080,resolution_height:1920,duration_ms:2500,file_size_human:"100KB"},created_at:(new Date).toISOString(),created_by:"system",last_edited_at:(new Date).toISOString(),last_edited_by:"system"}]}}render(){return super.render(),this.document&&"static-dooh-document"===this.document.type?F`
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                <playlist-renderer
                    .document=${this.generatedPlaylistDocument}
                    .zoomFactor=${1}
                    .frameRate=${this.frameRate}
                    .currentTimestamp=${this.currentTimestamp}
                ></playlist-renderer>
            </div>
        `:F``}};function he(t){return t.items.reduce((e,i)=>e+ce(i,t),0)}function ce(t,e){var i,r;let n=0;if(e){const s=e.items[e.items.findIndex(e=>e.id===t.id)+1],a=(null===(i=null==s?void 0:s.transition_in)||void 0===i?void 0:i.overlap)?s.transition_in.duration:0,o=(null===(r=t.transition_out)||void 0===r?void 0:r.overlap)?t.transition_out.duration:0;n=Math.max(a,o)}if(t.expiry_date){if(new Date(t.expiry_date).getTime()<Date.now())return 0}return t.duration_overwrite?Math.max(0,t.duration_overwrite-n):"playlist-document"===t.type?Math.max(0,he(t.originalDocument)-n):"layout-document"===t.type&&t.originalDocument.options.hasOwnProperty("duration")?Math.max(0,(t.originalDocument.options.duration||0)-n):"media-asset"===t.type&&t.originalDocument.hasOwnProperty("duration_ms")?Math.max(0,(t.originalDocument.duration_ms||0)-n):0}function pe(t,e){var i,r,n,s;let a=0;for(let o=1;o<=e;o++){const e=t.items[o],l=t.items[o-1];if(!e||!l)continue;a+=(null===(i=null==l?void 0:l.transition_out)||void 0===i?void 0:i.overlap)||(null===(r=e.transition_in)||void 0===r?void 0:r.overlap)?Math.max((null===(n=null==l?void 0:l.transition_out)||void 0===n?void 0:n.duration)||0,(null===(s=e.transition_in)||void 0===s?void 0:s.duration)||0):0}return a}function me(t,e,i,r){const n=e.items.indexOf(t),s=e.items.slice(0,n).reduce((t,e)=>t+ce(e),0);if(t.expiry_date){if(new Date(t.expiry_date).getTime()<Date.now())return s-pe(e,n)}let a=s;return a-=pe(e,n),a}function ye(t,e,i,r){const n=me(t,e);if(t.expiry_date){if(new Date(t.expiry_date).getTime()<Date.now())return n}return n+ce(t)}function fe(t){if(!t.expiry_date)return!1;return new Date(t.expiry_date).getTime()<Date.now()}function ve(t,e){const i=fe(t.document),r=t.parentDocument;ge(t),_e(t);let n=me(t.document,t.parentDocument),s=ye(t.document,t.parentDocument);const a=he(r);n<0&&(n=a+n),s<0&&(s=a+s);let o=!i&&n!==s;return o=n<s?o&&n<=e&&s>e:o&&(n<=e||s>e),{isVisible:o,isExpired:i,startTimestamp:n,endTimestamp:s}}function ge(t){const e=t.parentDocument,i=null==e?void 0:e.items.findIndex(e=>e.id===t.document.id),r=i?null==e?void 0:e.items[i-1]:null;return r&&fe(r)?ge(t):r===t.document?null:r}function _e(t){const e=t.parentDocument,i=null==e?void 0:e.items.findIndex(e=>e.id===t.document.id),r=-1!==i&&i<(null==e?void 0:e.items.length)-1?null==e?void 0:e.items[i+1]:null;return r&&fe(r)?_e(t):r===t.document?null:r}t([pt("playlist-renderer"),e("design:type",Ae)],ue.prototype,"playlistRenderer",void 0),t([ct(),e("design:type",Object)],ue.prototype,"generatedPlaylistDocument",void 0),ue=t([lt("static-dooh-item-renderer"),e("design:paramtypes",[])],ue);const $e={"media-asset":Rt,"layout-document":At,"playlist-document":de,"dynamic-dooh-document":le,"static-dooh-document":ue};class be{constructor(){this.itemRenderers=new Map,this.currentTimestamp=0,this.isPlaying=!1,this.zoomFactor=1,this.frameRate=30}play(){this.isPlaying=!0,this.itemRenderers.forEach(({renderer:t})=>{const{isVisible:e}=ve(t,this.currentTimestamp);e?(t.play().then(()=>{}),t.style.display="block"):(t.pause().then(()=>{}),t.style.display="none")})}pause(){this.isPlaying=!1,this.itemRenderers.forEach(({renderer:t})=>{t.pause().then(()=>{})})}stop(){this.isPlaying=!1,this.itemRenderers.forEach(({renderer:t})=>{t.stop().then(()=>{})})}updateCurrentTimestamp(t){this.currentTimestamp=t,Array.from(this.itemRenderers.values()).filter(({renderer:t})=>!fe(t.document)).forEach(({renderer:e,order:i})=>{e.currentTimestamp=t;const{isVisible:r,startTimestamp:n,endTimestamp:s}=ve(e,t);n===e.startTimestamp&&s===e.endTimestamp||(e.startTimestamp=n,e.endTimestamp=s,e.order=i,this.itemRenderers.set(e.document.id,{renderer:e,order:i,startTimestamp:n,endTimestamp:s})),this.isPlaying&&(r?(e.play().then(()=>{}),e.style.display="block"):(e.stop().then(()=>{}),e.style.display="none"))})}buildRenderer(t,e=null){t.items.forEach(t=>{var e,i,r,n,s;t.duration_overwrite?t.duration_overwrite:"playlist-document"===t.type?null===(i=null===(e=t.originalDocument)||void 0===e?void 0:e.items)||void 0===i||i.reduce((t,e)=>t+(e.duration_overwrite||0),0):"layout-document"===t.type?null===(n=null===(r=t.originalDocument)||void 0===r?void 0:r.options)||void 0===n||n.duration:"media-asset"===t.type&&(null===(s=t.originalDocument)||void 0===s||s.duration_ms)});const i=document.createElement("body");return i.style.width=`${t.properties.width}px`,i.style.height=`${t.properties.height}px`,i.style.overflow="hidden",i.style.position="relative",e&&(i.style.scale=`${this.zoomFactor}`),t.items.filter(t=>!fe(t)).reduce((t,e,i,r)=>(t.push(e),1===r.length&&t.push(e),t),[]).map((e,i)=>this.buildSubRenderer(e,t,i)).forEach((t,e)=>{var r,n,s;(null===(r=t.document)||void 0===r?void 0:r.name)||null===(s=null===(n=t.document)||void 0===n?void 0:n.originalDocument)||void 0===s||s.name,this.itemRenderers.set(t.document.id,{renderer:t,order:e,startTimestamp:t.startTimestamp,endTimestamp:t.endTimestamp}),i.appendChild(t)}),this.rootRenderer=i,i}updateRenderer(t,e=null){return this.itemRenderers=new Map,this.buildRenderer(t,e)}setZoomFactor(t){this.zoomFactor=t,this.itemRenderers.forEach(({renderer:t})=>{t.zoomFactor=this.zoomFactor})}setFrameRate(t){this.frameRate=t}buildSubRenderer(t,e,i){const r=new $e[t.type];r.document=t,r.parentDocument=e,r.zoomFactor=this.zoomFactor,r.frameRate=this.frameRate,r.currentTimestamp=this.currentTimestamp,r.style.position="absolute",r.style.top="0",r.style.left="0";const n=100*(e.items.length+1-i);r.style.zIndex=n.toString();const{isVisible:s,startTimestamp:a,endTimestamp:o}=ve(r,this.currentTimestamp);return r.startTimestamp=a,r.endTimestamp=o,r.order=i,r.style.display=s?"block":"none",r}}let Ae=class extends at{constructor(){super(),this.document=null,this.zoomFactor=1,this.currentTimestamp=0,this.frameRate=30,this.parentDocument=null,this.isPlaying=!1,this.renderer=null,this.currentTimestampInterval=null,this.documentDuration=0,this.rendererManager=new be}connectedCallback(){super.connectedCallback(),this.document&&(this.renderer=this.rendererManager.buildRenderer(this.document,this.parentDocument),this.documentDuration=he(this.document)),this.rendererManager.setZoomFactor(this.zoomFactor),this.rendererManager.setFrameRate(this.frameRate),this.rendererManager.updateCurrentTimestamp(this.currentTimestamp)}disconnectedCallback(){super.disconnectedCallback(),this.clear()}clear(){clearInterval(this.currentTimestampInterval),this.rendererManager.stop()}updated(t){if(void 0!==this.document&&(t.has("document")&&(this.renderer=this.rendererManager.updateRenderer(this.document,this.parentDocument),this.documentDuration=he(this.document),this.requestUpdate()),t.has("zoomFactor")&&(this.rendererManager.setZoomFactor(this.zoomFactor),this.requestUpdate()),t.has("frameRate")&&(this.rendererManager.setFrameRate(this.frameRate),this.requestUpdate()),t.has("currentTimestamp"))){const t=he(this.document);t!==this.documentDuration&&(this.documentDuration=t),this.rendererManager.updateCurrentTimestamp(this.currentTimestamp),this.requestUpdate()}}play(){this.isPlaying=!0;const t=1e3/this.frameRate,e=()=>{const e=this.currentTimestamp+t;e>=this.documentDuration?this.currentTimestamp=e-this.documentDuration:this.currentTimestamp=e,this.rendererManager.updateCurrentTimestamp(e),this.requestUpdate()};return this.rendererManager.play(),e(),this.currentTimestampInterval=setInterval(e,t),Promise.resolve()}pause(){return this.isPlaying?(this.isPlaying=!1,clearInterval(this.currentTimestampInterval),this.rendererManager.pause(),Promise.resolve()):Promise.resolve()}stop(){return this.isPlaying=!1,clearInterval(this.currentTimestampInterval),this.rendererManager.stop(),this.currentTimestamp=0,this.rendererManager.updateCurrentTimestamp(this.currentTimestamp),Promise.resolve()}render(){var t,e,i,r,n,s,a,o,l,d,u,h,c,p;return(null===(e=null===(t=this.document)||void 0===t?void 0:t.properties)||void 0===e?void 0:e.isMPV)?F``:(this.style.display="block",this.style.scale=`${this.zoomFactor}`,void 0!==(null===(r=null===(i=this.document)||void 0===i?void 0:i.properties)||void 0===r?void 0:r.height)&&void 0!==(null===(s=null===(n=this.document)||void 0===n?void 0:n.properties)||void 0===s?void 0:s.width)||console.error("[ERROR] PlaylistRenderer: document properties are not defined"),this.style.height=`${(null===(o=null===(a=this.parentDocument)||void 0===a?void 0:a.properties)||void 0===o?void 0:o.height)||(null===(d=null===(l=this.document)||void 0===l?void 0:l.properties)||void 0===d?void 0:d.height)||0}px`,this.style.width=`${(null===(h=null===(u=this.parentDocument)||void 0===u?void 0:u.properties)||void 0===h?void 0:h.width)||(null===(p=null===(c=this.document)||void 0===c?void 0:c.properties)||void 0===p?void 0:p.width)||0}px`,this.style.overflow="hidden",this.renderer?F`${this.renderer}`:F``)}};t([ht({type:Object}),e("design:type",Object)],Ae.prototype,"document",void 0),t([ht({type:Number}),e("design:type",Number)],Ae.prototype,"zoomFactor",void 0),t([ht({type:Number}),e("design:type",Number)],Ae.prototype,"currentTimestamp",void 0),t([ht({type:Number}),e("design:type",Number)],Ae.prototype,"frameRate",void 0),t([ht({type:Object}),e("design:type",Object)],Ae.prototype,"parentDocument",void 0),t([ct(),e("design:type",Boolean)],Ae.prototype,"isPlaying",void 0),t([ct(),e("design:type",HTMLElement)],Ae.prototype,"renderer",void 0),Ae=t([lt("playlist-renderer"),e("design:paramtypes",[])],Ae);export{Ae as default,_e as getItemAfter,ge as getItemBefore,ye as getItemEndTimestampInPlaylist,me as getItemStartTimestampInPlaylist,ve as getItemVisibility,he as getPlaylistDuration,ce as getPlaylistItemDuration,fe as isExpired};
//# sourceMappingURL=index.js.map

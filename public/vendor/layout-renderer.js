function t(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s}function e(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}"function"==typeof SuppressedError&&SuppressedError;const i=globalThis,n=i.ShadowRoot&&(void 0===i.ShadyCSS||i.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,o=Symbol(),r=new WeakMap;let s=class{constructor(t,e,i){if(this._$cssResult$=!0,i!==o)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(n&&void 0===t){const i=void 0!==e&&1===e.length;i&&(t=r.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&r.set(e,t))}return t}toString(){return this.cssText}};const a=t=>new s("string"==typeof t?t:t+"",void 0,o),l=(t,...e)=>{const i=1===t.length?t[0]:e.reduce((e,i,n)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[n+1],t[0]);return new s(i,t,o)},d=n?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return a(e)})(t):t,{is:c,defineProperty:u,getOwnPropertyDescriptor:h,getOwnPropertyNames:p,getOwnPropertySymbols:m,getPrototypeOf:g}=Object,f=globalThis,v=f.trustedTypes,y=v?v.emptyScript:"",A=f.reactiveElementPolyfillSupport,b=(t,e)=>t,w={toAttribute(t,e){switch(e){case Boolean:t=t?y:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},E=(t,e)=>!c(t,e),x={attribute:!0,type:String,converter:w,reflect:!1,useDefault:!1,hasChanged:E};Symbol.metadata??=Symbol("metadata"),f.litPropertyMetadata??=new WeakMap;let S=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=x){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),n=this.getPropertyDescriptor(t,i,e);void 0!==n&&u(this.prototype,t,n)}}static getPropertyDescriptor(t,e,i){const{get:n,set:o}=h(this.prototype,t)??{get(){return this[e]},set(t){this[e]=t}};return{get:n,set(e){const r=n?.call(this);o?.call(this,e),this.requestUpdate(t,r,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??x}static _$Ei(){if(this.hasOwnProperty(b("elementProperties")))return;const t=g(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(b("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(b("properties"))){const t=this.properties,e=[...p(t),...m(t)];for(const i of e)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const e=litPropertyMetadata.get(t);if(void 0!==e)for(const[t,i]of e)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const i=this._$Eu(t,e);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const t of i)e.unshift(d(t))}else void 0!==t&&e.push(d(t));return e}static _$Eu(t,e){const i=e.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{if(n)t.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const n of e){const e=document.createElement("style"),o=i.litNonce;void 0!==o&&e.setAttribute("nonce",o),e.textContent=n.cssText,t.appendChild(e)}})(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$ET(t,e){const i=this.constructor.elementProperties.get(t),n=this.constructor._$Eu(t,i);if(void 0!==n&&!0===i.reflect){const o=(void 0!==i.converter?.toAttribute?i.converter:w).toAttribute(e,i.type);this._$Em=t,null==o?this.removeAttribute(n):this.setAttribute(n,o),this._$Em=null}}_$AK(t,e){const i=this.constructor,n=i._$Eh.get(t);if(void 0!==n&&this._$Em!==n){const t=i.getPropertyOptions(n),o="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:w;this._$Em=n;const r=o.fromAttribute(e,t.type);this[n]=r??this._$Ej?.get(n)??r,this._$Em=null}}requestUpdate(t,e,i){if(void 0!==t){const n=this.constructor,o=this[t];if(i??=n.getPropertyOptions(t),!((i.hasChanged??E)(o,e)||i.useDefault&&i.reflect&&o===this._$Ej?.get(t)&&!this.hasAttribute(n._$Eu(t,i))))return;this.C(t,e,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(t,e,{useDefault:i,reflect:n,wrapped:o},r){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,r??e??this[t]),!0!==o||void 0!==r)||(this._$AL.has(t)||(this.hasUpdated||i||(e=void 0),this._$AL.set(t,e)),!0===n&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,e]of this._$Ep)this[t]=e;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,i]of t){const{wrapped:t}=i,n=this[e];!0!==t||this._$AL.has(e)||void 0===n||this.C(e,void 0,i,n)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach(t=>t.hostUpdate?.()),this.update(e)):this._$EM()}catch(e){throw t=!1,this._$EM(),e}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(t=>this._$ET(t,this[t])),this._$EM()}updated(t){}firstUpdated(t){}};S.elementStyles=[],S.shadowRootOptions={mode:"open"},S[b("elementProperties")]=new Map,S[b("finalized")]=new Map,A?.({ReactiveElement:S}),(f.reactiveElementVersions??=[]).push("2.1.1");const $=globalThis,_=$.trustedTypes,M=_?_.createPolicy("lit-html",{createHTML:t=>t}):void 0,k="$lit$",C=`lit$${Math.random().toFixed(9).slice(2)}$`,R="?"+C,O=`<${R}>`,P=document,I=()=>P.createComment(""),D=t=>null===t||"object"!=typeof t&&"function"!=typeof t,T=Array.isArray,L="[ \t\n\f\r]",F=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,z=/-->/g,N=/>/g,B=RegExp(`>|${L}(?:([^\\s"'>=/]+)(${L}*=${L}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),q=/'/g,j=/"/g,U=/^(?:script|style|textarea|title)$/i,W=(t=>(e,...i)=>({_$litType$:t,strings:e,values:i}))(1),V=Symbol.for("lit-noChange"),H=Symbol.for("lit-nothing"),G=new WeakMap,Q=P.createTreeWalker(P,129);function J(t,e){if(!T(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==M?M.createHTML(e):e}const Z=(t,e)=>{const i=t.length-1,n=[];let o,r=2===e?"<svg>":3===e?"<math>":"",s=F;for(let e=0;e<i;e++){const i=t[e];let a,l,d=-1,c=0;for(;c<i.length&&(s.lastIndex=c,l=s.exec(i),null!==l);)c=s.lastIndex,s===F?"!--"===l[1]?s=z:void 0!==l[1]?s=N:void 0!==l[2]?(U.test(l[2])&&(o=RegExp("</"+l[2],"g")),s=B):void 0!==l[3]&&(s=B):s===B?">"===l[0]?(s=o??F,d=-1):void 0===l[1]?d=-2:(d=s.lastIndex-l[2].length,a=l[1],s=void 0===l[3]?B:'"'===l[3]?j:q):s===j||s===q?s=B:s===z||s===N?s=F:(s=B,o=void 0);const u=s===B&&t[e+1].startsWith("/>")?" ":"";r+=s===F?i+O:d>=0?(n.push(a),i.slice(0,d)+k+i.slice(d)+C+u):i+C+(-2===d?e:u)}return[J(t,r+(t[i]||"<?>")+(2===e?"</svg>":3===e?"</math>":"")),n]};class K{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let o=0,r=0;const s=t.length-1,a=this.parts,[l,d]=Z(t,e);if(this.el=K.createElement(l,i),Q.currentNode=this.el.content,2===e||3===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(n=Q.nextNode())&&a.length<s;){if(1===n.nodeType){if(n.hasAttributes())for(const t of n.getAttributeNames())if(t.endsWith(k)){const e=d[r++],i=n.getAttribute(t).split(C),s=/([.?@])?(.*)/.exec(e);a.push({type:1,index:o,name:s[2],strings:i,ctor:"."===s[1]?it:"?"===s[1]?nt:"@"===s[1]?ot:et}),n.removeAttribute(t)}else t.startsWith(C)&&(a.push({type:6,index:o}),n.removeAttribute(t));if(U.test(n.tagName)){const t=n.textContent.split(C),e=t.length-1;if(e>0){n.textContent=_?_.emptyScript:"";for(let i=0;i<e;i++)n.append(t[i],I()),Q.nextNode(),a.push({type:2,index:++o});n.append(t[e],I())}}}else if(8===n.nodeType)if(n.data===R)a.push({type:2,index:o});else{let t=-1;for(;-1!==(t=n.data.indexOf(C,t+1));)a.push({type:7,index:o}),t+=C.length-1}o++}}static createElement(t,e){const i=P.createElement("template");return i.innerHTML=t,i}}function Y(t,e,i=t,n){if(e===V)return e;let o=void 0!==n?i._$Co?.[n]:i._$Cl;const r=D(e)?void 0:e._$litDirective$;return o?.constructor!==r&&(o?._$AO?.(!1),void 0===r?o=void 0:(o=new r(t),o._$AT(t,i,n)),void 0!==n?(i._$Co??=[])[n]=o:i._$Cl=o),void 0!==o&&(e=Y(t,o._$AS(t,e.values),o,n)),e}class X{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,n=(t?.creationScope??P).importNode(e,!0);Q.currentNode=n;let o=Q.nextNode(),r=0,s=0,a=i[0];for(;void 0!==a;){if(r===a.index){let e;2===a.type?e=new tt(o,o.nextSibling,this,t):1===a.type?e=new a.ctor(o,a.name,a.strings,this,t):6===a.type&&(e=new rt(o,this,t)),this._$AV.push(e),a=i[++s]}r!==a?.index&&(o=Q.nextNode(),r++)}return Q.currentNode=P,n}p(t){let e=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class tt{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,i,n){this.type=2,this._$AH=H,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Y(this,t,e),D(t)?t===H||null==t||""===t?(this._$AH!==H&&this._$AR(),this._$AH=H):t!==this._$AH&&t!==V&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>T(t)||"function"==typeof t?.[Symbol.iterator])(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==H&&D(this._$AH)?this._$AA.nextSibling.data=t:this.T(P.createTextNode(t)),this._$AH=t}$(t){const{values:e,_$litType$:i}=t,n="number"==typeof i?this._$AC(t):(void 0===i.el&&(i.el=K.createElement(J(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===n)this._$AH.p(e);else{const t=new X(n,this),i=t.u(this.options);t.p(e),this.T(i),this._$AH=t}}_$AC(t){let e=G.get(t.strings);return void 0===e&&G.set(t.strings,e=new K(t)),e}k(t){T(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,n=0;for(const o of t)n===e.length?e.push(i=new tt(this.O(I()),this.O(I()),this,this.options)):i=e[n],i._$AI(o),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class et{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,n,o){this.type=1,this._$AH=H,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=o,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=H}_$AI(t,e=this,i,n){const o=this.strings;let r=!1;if(void 0===o)t=Y(this,t,e,0),r=!D(t)||t!==this._$AH&&t!==V,r&&(this._$AH=t);else{const n=t;let s,a;for(t=o[0],s=0;s<o.length-1;s++)a=Y(this,n[i+s],e,s),a===V&&(a=this._$AH[s]),r||=!D(a)||a!==this._$AH[s],a===H?t=H:t!==H&&(t+=(a??"")+o[s+1]),this._$AH[s]=a}r&&!n&&this.j(t)}j(t){t===H?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class it extends et{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===H?void 0:t}}class nt extends et{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==H)}}class ot extends et{constructor(t,e,i,n,o){super(t,e,i,n,o),this.type=5}_$AI(t,e=this){if((t=Y(this,t,e,0)??H)===V)return;const i=this._$AH,n=t===H&&i!==H||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,o=t!==H&&(i===H||n);n&&this.element.removeEventListener(this.name,this,i),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class rt{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){Y(this,t)}}const st=$.litHtmlPolyfillSupport;st?.(K,tt),($.litHtmlVersions??=[]).push("3.3.1");const at=globalThis;let lt=class extends S{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,i)=>{const n=i?.renderBefore??e;let o=n._$litPart$;if(void 0===o){const t=i?.renderBefore??null;n._$litPart$=o=new tt(e.insertBefore(I(),t),t,void 0,i??{})}return o._$AI(t),o})(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return V}};lt._$litElement$=!0,lt.finalized=!0,at.litElementHydrateSupport?.({LitElement:lt});const dt=at.litElementPolyfillSupport;dt?.({LitElement:lt}),(at.litElementVersions??=[]).push("4.2.1");const ct=t=>(e,i)=>{void 0!==i?i.addInitializer(()=>{customElements.define(t,e)}):customElements.define(t,e)},ut={attribute:!0,type:String,converter:w,reflect:!1,hasChanged:E},ht=(t=ut,e,i)=>{const{kind:n,metadata:o}=i;let r=globalThis.litPropertyMetadata.get(o);if(void 0===r&&globalThis.litPropertyMetadata.set(o,r=new Map),"setter"===n&&((t=Object.create(t)).wrapped=!0),r.set(i.name,t),"accessor"===n){const{name:n}=i;return{set(i){const o=e.get.call(this);e.set.call(this,i),this.requestUpdate(n,o,t)},init(e){return void 0!==e&&this.C(n,void 0,t,e),e}}}if("setter"===n){const{name:n}=i;return function(i){const o=this[n];e.call(this,i),this.requestUpdate(n,o,t)}}throw Error("Unsupported decorator location: "+n)};function pt(t){return(e,i)=>"object"==typeof i?ht(t,e,i):((t,e,i)=>{const n=e.hasOwnProperty(i);return e.constructor.createProperty(i,t),n?Object.getOwnPropertyDescriptor(e,i):void 0})(t,e,i)}function mt(t){return pt({...t,state:!0,attribute:!1})}function gt(t,e){return(e,i,n)=>((t,e,i)=>(i.configurable=!0,i.enumerable=!0,Reflect.decorate&&"object"!=typeof e&&Object.defineProperty(t,e,i),i))(e,i,{get(){return(e=>e.renderRoot?.querySelector(t)??null)(this)}})}function ft(t,e=[],i=0,n=0){var o,r,s,a,l,d;if(("image"===t.type||"video"===t.type||"audio"===t.type)&&t.content&&t.content.src){const c=(null===(o=t.options)||void 0===o?void 0:o.start)+i||i||0;let u=(null===(r=t.options)||void 0===r?void 0:r.end)+i||i||0;u<c&&(u=c),u>n&&(u=n),e.push({src:t.content.src,type:t.type,priority:c,start:c,end:u,markIn:null!==(a=null===(s=t.content)||void 0===s?void 0:s["mark-in"])&&void 0!==a?a:0,markOut:null!==(d=null===(l=t.content)||void 0===l?void 0:l["mark-out"])&&void 0!==d?d:0})}return Array.isArray(t.children)&&t.children.forEach(i=>{var n,o,r,s;if("layout"===t.type)ft(i,e,0,t.options.duration);else{const a=null!==(o=null===(n=t.options)||void 0===n?void 0:n.start)&&void 0!==o?o:0,l=null!==(s=null===(r=t.options)||void 0===r?void 0:r.end)&&void 0!==s?s:0;ft(i,e,a,l)}}),e}const vt={id:0,type:"layout",version:1,options:{start:0,end:1e4,duration:1e4},props:{height:1e3,width:1e3,background:"#000000"},children:[],name:"Default"},yt={lineWidth:0,lineStyle:"solid",lineColor:"transparent",radius:0},At={scale:{x:1,y:1},rotate:0,skew:{x:0,y:0}},bt={blur:0,brightness:1,contrast:1,grayscale:0,hueRotate:0,invert:0,saturate:1,sepia:0},wt={x:0,y:0,width:100,height:100,background:"transparent",border:yt,opacity:1,transform:At},Et={...wt,...At,...bt},xt=[...Object.keys(wt),...Object.keys(At),...Object.keys(bt),...Object.keys(yt)],St={linear:function(t,e,i,n){return i*t/n+e},"ease-in":function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},"ease-out":function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},"ease-in-out":function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},"ease-in-quad":function(t,e,i,n){return i*(t/=n)*t+e},"ease-out-quad":function(t,e,i,n){return-i*(t/=n)*(t-2)+e},"ease-in-out-quad":function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},"ease-in-cubic":function(t,e,i,n){return i*(t/=n)*t*t+e},"ease-out-cubic":function(t,e,i,n){return t/=n,i*(--t*t*t+1)+e},"ease-in-out-cubic":function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},"ease-in-quart":function(t,e,i,n){return i*(t/=n)*t*t*t+e},"ease-out-quart":function(t,e,i,n){return t/=n,-i*(--t*t*t*t-1)+e},"ease-in-out-quart":function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},"ease-in-quint":function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},"ease-out-quint":function(t,e,i,n){return t/=n,i*(--t*t*t*t*t+1)+e},"ease-in-out-quint":function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},"ease-in-sine":function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},"ease-out-sine":function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},"ease-in-out-sine":function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},"ease-in-expo":function(t,e,i,n){return i*Math.pow(2,10*(t/n-1))+e},"ease-out-expo":function(t,e,i,n){return i*(1-Math.pow(2,-10*t/n))+e},"ease-in-out-expo":function(t,e,i,n){return(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:(t--,i/2*(2-Math.pow(2,-10*t))+e)},"ease-in-circ":function(t,e,i,n){return t/=n,-i*(Math.sqrt(1-t*t)-1)+e},"ease-out-circ":function(t,e,i,n){return t/=n,t--,i*Math.sqrt(1-t*t)+e},"ease-in-out-circ":function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:(t-=2,i/2*(Math.sqrt(1-t*t)+1)+e)}};const $t=new class{constructor(){this.widgets={}}register(t){this.widgets[t.type]&&console.warn(`[WARN] Widget type '${t.type}' is already registered. Overwriting it.`),this.widgets[t.type]=t,void 0===t.registerComponentFn||"function"!=typeof t.registerComponentFn?customElements.get(`${t.type}-renderer`)||customElements.define(`${t.type}-renderer`,t.webComponent):t.registerComponentFn()}getWidget(t){return this.widgets[t]}getAllWidgets(){return Object.values(this.widgets)}getVisibleWidgets(){return Object.values(this.widgets).filter(t=>!0!==t.internal)}};var _t=Object.getOwnPropertyNames,Mt=Object.getOwnPropertySymbols,kt=Object.prototype.hasOwnProperty;function Ct(t,e){return function(i,n,o){return t(i,n,o)&&e(i,n,o)}}function Rt(t){return function(e,i,n){if(!e||!i||"object"!=typeof e||"object"!=typeof i)return t(e,i,n);var o=n.cache,r=o.get(e),s=o.get(i);if(r&&s)return r===i&&s===e;o.set(e,i),o.set(i,e);var a=t(e,i,n);return o.delete(e),o.delete(i),a}}function Ot(t){return _t(t).concat(Mt(t))}var Pt=Object.hasOwn||function(t,e){return kt.call(t,e)};function It(t,e){return t===e||!t&&!e&&t!=t&&e!=e}var Dt=Object.getOwnPropertyDescriptor,Tt=Object.keys;function Lt(t,e,i){var n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(!i.equals(t[n],e[n],n,n,t,e,i))return!1;return!0}function Ft(t,e){return It(t.getTime(),e.getTime())}function zt(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function Nt(t,e){return t===e}function Bt(t,e,i){var n=t.size;if(n!==e.size)return!1;if(!n)return!0;for(var o,r,s=new Array(n),a=t.entries(),l=0;(o=a.next())&&!o.done;){for(var d=e.entries(),c=!1,u=0;(r=d.next())&&!r.done;)if(s[u])u++;else{var h=o.value,p=r.value;if(i.equals(h[0],p[0],l,u,t,e,i)&&i.equals(h[1],p[1],h[0],p[0],t,e,i)){c=s[u]=!0;break}u++}if(!c)return!1;l++}return!0}var qt=It;function jt(t,e,i){var n=Tt(t),o=n.length;if(Tt(e).length!==o)return!1;for(;o-- >0;)if(!Jt(t,e,i,n[o]))return!1;return!0}function Ut(t,e,i){var n,o,r,s=Ot(t),a=s.length;if(Ot(e).length!==a)return!1;for(;a-- >0;){if(!Jt(t,e,i,n=s[a]))return!1;if(o=Dt(t,n),r=Dt(e,n),(o||r)&&(!o||!r||o.configurable!==r.configurable||o.enumerable!==r.enumerable||o.writable!==r.writable))return!1}return!0}function Wt(t,e){return It(t.valueOf(),e.valueOf())}function Vt(t,e){return t.source===e.source&&t.flags===e.flags}function Ht(t,e,i){var n=t.size;if(n!==e.size)return!1;if(!n)return!0;for(var o,r,s=new Array(n),a=t.values();(o=a.next())&&!o.done;){for(var l=e.values(),d=!1,c=0;(r=l.next())&&!r.done;){if(!s[c]&&i.equals(o.value,r.value,o.value,r.value,t,e,i)){d=s[c]=!0;break}c++}if(!d)return!1}return!0}function Gt(t,e){var i=t.length;if(e.length!==i)return!1;for(;i-- >0;)if(t[i]!==e[i])return!1;return!0}function Qt(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function Jt(t,e,i,n){return!("_owner"!==n&&"__o"!==n&&"__v"!==n||!t.$$typeof&&!e.$$typeof)||Pt(e,n)&&i.equals(t[n],e[n],n,n,t,e,i)}var Zt=Array.isArray,Kt="function"==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView:null,Yt=Object.assign,Xt=Object.prototype.toString.call.bind(Object.prototype.toString);var te=ee();function ee(t){void 0===t&&(t={});var e,i=t.circular,n=void 0!==i&&i,o=t.createInternalComparator,r=t.createState,s=t.strict,a=void 0!==s&&s,l=function(t){var e=t.circular,i=t.createCustomConfig,n=t.strict,o={areArraysEqual:n?Ut:Lt,areDatesEqual:Ft,areErrorsEqual:zt,areFunctionsEqual:Nt,areMapsEqual:n?Ct(Bt,Ut):Bt,areNumbersEqual:qt,areObjectsEqual:n?Ut:jt,arePrimitiveWrappersEqual:Wt,areRegExpsEqual:Vt,areSetsEqual:n?Ct(Ht,Ut):Ht,areTypedArraysEqual:n?Ut:Gt,areUrlsEqual:Qt};if(i&&(o=Yt({},o,i(o))),e){var r=Rt(o.areArraysEqual),s=Rt(o.areMapsEqual),a=Rt(o.areObjectsEqual),l=Rt(o.areSetsEqual);o=Yt({},o,{areArraysEqual:r,areMapsEqual:s,areObjectsEqual:a,areSetsEqual:l})}return o}(t),d=function(t){var e=t.areArraysEqual,i=t.areDatesEqual,n=t.areErrorsEqual,o=t.areFunctionsEqual,r=t.areMapsEqual,s=t.areNumbersEqual,a=t.areObjectsEqual,l=t.arePrimitiveWrappersEqual,d=t.areRegExpsEqual,c=t.areSetsEqual,u=t.areTypedArraysEqual,h=t.areUrlsEqual;return function(t,p,m){if(t===p)return!0;if(null==t||null==p)return!1;var g=typeof t;if(g!==typeof p)return!1;if("object"!==g)return"number"===g?s(t,p,m):"function"===g&&o(t,p,m);var f=t.constructor;if(f!==p.constructor)return!1;if(f===Object)return a(t,p,m);if(Zt(t))return e(t,p,m);if(null!=Kt&&Kt(t))return u(t,p,m);if(f===Date)return i(t,p,m);if(f===RegExp)return d(t,p,m);if(f===Map)return r(t,p,m);if(f===Set)return c(t,p,m);var v=Xt(t);return"[object Date]"===v?i(t,p,m):"[object RegExp]"===v?d(t,p,m):"[object Map]"===v?r(t,p,m):"[object Set]"===v?c(t,p,m):"[object Object]"===v?"function"!=typeof t.then&&"function"!=typeof p.then&&a(t,p,m):"[object URL]"===v?h(t,p,m):"[object Error]"===v?n(t,p,m):"[object Arguments]"===v?a(t,p,m):("[object Boolean]"===v||"[object Number]"===v||"[object String]"===v)&&l(t,p,m)}}(l),c=o?o(d):(e=d,function(t,i,n,o,r,s,a){return e(t,i,a)});return function(t){var e=t.circular,i=t.comparator,n=t.createState,o=t.equals,r=t.strict;if(n)return function(t,s){var a=n(),l=a.cache,d=void 0===l?e?new WeakMap:void 0:l,c=a.meta;return i(t,s,{cache:d,equals:o,meta:c,strict:r})};if(e)return function(t,e){return i(t,e,{cache:new WeakMap,equals:o,meta:void 0,strict:r})};var s={cache:void 0,equals:o,meta:void 0,strict:r};return function(t,e){return i(t,e,s)}}({circular:n,comparator:d,createState:r,equals:c,strict:a})}function ie(t){return"string"==typeof t&&(t.startsWith("#")||t.startsWith("rgb"))}function ne(t,e){if(t.children.includes(e))return t;for(const i of t.children)if(i.hasOwnProperty("children")){const t=ne(i,e);if(t)return t}return null}function oe(t,e){if(t&&"object"==typeof t&&"variableId"in t&&"string"==typeof t.variableId&&""!==t.variableId)return t;if(Array.isArray(t)&&Array.isArray(e)){const i=Math.max(t.length,e.length),n=[];for(let o=0;o<i;o++){const i=t[o],r=e[o];n[o]=void 0!==i&&void 0!==r?oe(i,r):void 0!==i?i:r}return n}if(t&&"object"==typeof t&&!Array.isArray(t)&&e&&"object"==typeof e&&!Array.isArray(e)){const i={...e};for(const n in t)i[n]=n in e?oe(t[n],e[n]):t[n];return i}return e}ee({strict:!0}),ee({circular:!0}),ee({circular:!0,strict:!0}),ee({createInternalComparator:function(){return It}}),ee({strict:!0,createInternalComparator:function(){return It}}),ee({circular:!0,createInternalComparator:function(){return It}}),ee({circular:!0,createInternalComparator:function(){return It},strict:!0});const re=l`
  :host {
    display: block;
    margin: 0;
    padding: 0;
    width: var(--layout-width, ${a(vt.props.width)}px);
    height: var(--layout-height, ${a(vt.props.height)}px);
    background: var(
      --layout-background,
      ${a(vt.props.background)}
    );
  }
`;function se(t,e,i=0){for(const n of e.children){if(n.id===t)return{document:n,parent:e,depth:i};if(void 0!==n.children){const e=se(t,n,i+1);if(null!==e.document)return e}}return{document:null,parent:null,depth:0}}class ae{constructor(){this.subRenderers=new Map,this.internalZoomFactor=1,this.internalCurrentTimestamp=0}setDataLayerManager(t){this.dataLayerManager=t}buildRenderer(t,e,i,n,o,r=30){if(this.internalCurrentTimestamp=o,this.internalZoomFactor=n,void 0===t)return void console.error("[ERROR] No document found for layout renderer.");const s=document.createElement("div");s.classList.add("layout-renderer-root"),s.style.position="relative",s.style.margin="0",s.style.padding="0",s.style.boxSizing="border-box",s.style.width="100%",s.style.height="100%";const a=document.createElement("div");a.classList.add("layout-renderer-body"),a.style.position="relative",a.style.margin="0",a.style.padding="0",a.style.boxSizing="border-box",a.style.width="100%",a.style.height="100%";if(e&&"false"!==e&&void 0!==t.options.grid&&t.options.grid.visible){const e=this.buildGrid(t);a.appendChild(e)}return t.children.forEach(n=>{const s=this.buildSubRenderer(n,t,e,i,o,r,!0,0);if(s)try{a.appendChild(s)}catch(t){console.error(`[ERROR] Failed to append child renderer id="${null==n?void 0:n.id}" type="${null==n?void 0:n.type}" to root body:`,t)}else console.error(`[ERROR] Failed to build renderer for child id="${null==n?void 0:n.id}" type="${null==n?void 0:n.type}" at root level. Skipping append.`)}),s.appendChild(a),this.rootRenderer=s,s}buildSubRenderer(t,e,i,n,o,r=30,s=!0,a=0){var l,d;this.internalCurrentTimestamp=o;if(!en.getWidget(t.type))return void console.error(`[ERROR] No widget found for type "${t.type}".`);const c=`${t.type}-renderer`;if(!customElements.get(c))return void console.error(`[ERROR] No custom element found for type "${t.type}".`);const u=document.createElement(c);if(this.dataLayerManager&&"dataLayerManager"in u&&(u.dataLayerManager=this.dataLayerManager),void 0!==t.children&&"child-layout"!==t.type){t.children.map(t=>this.buildChildRenderer(t,e,i,n,o,r,a+1)).forEach(t=>{u.appendChild(t)})}u.props=t,u.layoutDocument=e;const h=ne(e,t);return u.parentDocument=h,h&&"flexbox"===h.type?(u.setAttribute("data-parent-type","flexbox"),u.style.left="",u.style.top="",u.style.position="relative"):u.removeAttribute("data-parent-type"),u.editingMode=i,u.playbackMode=n,u.zoomFactor=this.internalZoomFactor,u.currentTimestamp=o,u.layoutDuration=e.options.duration,u.selected="boolean"==typeof(null===(l=t.options)||void 0===l?void 0:l.selected)&&(null===(d=t.options)||void 0===d?void 0:d.selected),u.frameRate=r,u.dataset.id=(t.id||"no-id").toString(),s&&this.subRenderers.set(t.id,{renderer:u,document:t}),u}buildChildRenderer(t,e,i,n,o,r=30,s=0){const a=this.buildSubRenderer(t,e,i,n,o,r,!1,s);if(a)return a;console.error(`[ERROR] Failed to build renderer for child id="${null==t?void 0:t.id}" type="${null==t?void 0:t.type}". Skipping append.`)}updateRenderer(t,e,i,n,o=0,r=30){n!==this.internalZoomFactor&&(this.internalZoomFactor=n),o!==this.internalCurrentTimestamp&&(this.internalCurrentTimestamp=o);let s=!1;if(this.subRenderers.forEach(({document:r,renderer:a})=>{var l,d,c;if(null==r||null===r.id||void 0===r.id||""===r.id)return void console.error("[ERROR] No id found for sub-renderer.",r,a,this.subRenderers);const{document:u,parent:h}=se(r.id,t);if(h&&h.id!==t.id)return this.subRenderers.delete(r.id),void a.remove();if(null===u)return a.remove(),void this.subRenderers.delete(r.id);if(void 0===u)return a.remove(),void this.subRenderers.delete(r.id);void 0===u.options&&(console.warn(`[WARN] No options found for document with id "${u.id}". Setting default options.`),u.options={selected:!1,locked:!1,visible:!0});const p=!te(r.options,u.options)&&!te({...r.options,selected:null},{...u.options,selected:null});!!te(r.children,u.children)&&p||(s=!0),a.props=u,a.layoutDocument=t,a.parentDocument=ne(t,u),a.editingMode=e,a.playbackMode=i,a.zoomFactor=n,a.currentTimestamp=o,a.layoutDuration=null===(l=t.options)||void 0===l?void 0:l.duration,a.selected="boolean"==typeof(null===(d=u.options)||void 0===d?void 0:d.selected)&&(null===(c=u.options)||void 0===c?void 0:c.selected),this.dataLayerManager&&"dataLayerManager"in a&&(a.dataLayerManager=this.dataLayerManager),this.subRenderers.set(r.id,{renderer:a,document:u})}),s){const s=this.buildRenderer(t,e,i,n,o,r);this.rootRenderer.replaceWith(s)}return this.rootRenderer}updateZoomFactor(t){this.internalZoomFactor=t,this.subRenderers.forEach(({renderer:e})=>{e.zoomFactor=t})}updateCurrentTimestamp(t){this.internalCurrentTimestamp=t,this.subRenderers.forEach(({renderer:e})=>{e.currentTimestamp=t})}play(){this.subRenderers.forEach(({renderer:t})=>{t.play()})}pause(){this.subRenderers.forEach(({renderer:t})=>{t.pause()})}stop(){this.internalCurrentTimestamp=0,this.subRenderers.forEach(({renderer:t})=>{t.stop()})}async renderFrame(t,e){this.internalCurrentTimestamp=t;const i=Array.from(this.subRenderers.values()).map(async({renderer:e})=>await e.renderFrame(t));await Promise.all(i),null==e||e()}cleanUpRenderers(){this.subRenderers.forEach(({renderer:t})=>{t.remove()}),this.subRenderers.clear(),this.rootRenderer.remove()}buildGrid(t){const e=this.internalZoomFactor,i=t.options.grid,n=10*e,o=document.createElement("div");return o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width=t.props.width+"px",o.style.height=t.props.height+"px",o.style.transform="scaleY(-1)",o.style.backgroundImage=`\n        repeating-linear-gradient(\n            0deg,\n            ${i.color} 0,\n            ${i.color} ${n}px,\n            transparent ${n}px,\n            transparent ${i.size}px\n        ),\n        repeating-linear-gradient(\n            90deg,\n            ${i.color} 0,\n            ${i.color} ${n}px,\n            transparent ${n}px,\n            transparent ${i.size}px\n        )`,o.style.pointerEvents="none",o.style.zIndex="9999999",o.style.opacity=`${i.opacity}`,o}}const le={"Univers Next Pro":{family:"Univers Next Pro",variants:[{weight:100,style:"normal",src:"univers-next-pro-thin.ttf"},{weight:100,style:"italic",src:"univers-next-pro-thin-italic.ttf"},{weight:400,style:"normal",src:"univers-next-pro-regular.ttf"},{weight:400,style:"italic",src:"univers-next-pro-italic.ttf"},{weight:700,style:"normal",src:"univers-next-pro-bold.ttf"},{weight:700,style:"italic",src:"univers-next-pro-bold-italic.ttf"}]},"Univers Next Pro Condensed":{family:"Univers Next Pro Condensed",variants:[{weight:300,style:"normal",src:"univers-next-pro-light-condensed.ttf"},{weight:300,style:"italic",src:"univers-next-pro-light-condensed-italic.ttf"},{weight:400,style:"italic",src:"univers-next-pro-condensed-italic.ttf"},{weight:700,style:"normal",src:"univers-next-pro-bold-condensed.ttf"},{weight:700,style:"italic",src:"univers-next-pro-bold-condensed-italic.ttf"},{weight:800,style:"italic",src:"univers-next-pro-heavy-condensed-italic.ttf"}]},"Univers Next Pro Extended":{family:"Univers Next Pro Extended",variants:[{weight:300,style:"normal",src:"univers-next-pro-light-extended.ttf"},{weight:300,style:"italic",src:"univers-next-pro-light-extended-italic.ttf"},{weight:400,style:"normal",src:"univers-next-pro-extended.ttf"},{weight:400,style:"italic",src:"univers-next-pro-extended-italic.ttf"},{weight:700,style:"normal",src:"univers-next-pro-bold-extended.ttf"},{weight:700,style:"italic",src:"univers-next-pro-bold-extended-italic.ttf"}]},Ballet:{family:"Ballet",variants:[{weight:400,style:"normal",src:"Ballet72pt-Regular.woff2"}]},Bodoni:{family:"Bodoni",variants:[{weight:400,style:"normal",src:"Bodoni-06-Book.ttf"},{weight:400,style:"italic",src:"Bodoni-06-Book-Italic.ttf"},{weight:500,style:"normal",src:"Bodoni-06-Medium.ttf"},{weight:500,style:"italic",src:"Bodoni-06-Medium-Italic.ttf"},{weight:700,style:"normal",src:"Bodoni-06-Bold.ttf"},{weight:700,style:"italic",src:"Bodoni-06-Bold-Italic.ttf"},{weight:900,style:"normal",src:"Bodoni-06-Fatface.ttf"},{weight:900,style:"italic",src:"Bodoni-06-Fatface-Italic.ttf"}]},Caveat:{family:"Caveat",variants:[{weight:400,style:"normal",src:"Caveat-Regular.ttf"},{weight:500,style:"normal",src:"Caveat-Medium.ttf"},{weight:600,style:"normal",src:"Caveat-SemiBold.ttf"},{weight:700,style:"normal",src:"Caveat-Bold.ttf"}]},"Dancing Script":{family:"Dancing Script",variants:[{weight:400,style:"normal",src:"DancingScript-Regular.ttf"},{weight:500,style:"normal",src:"DancingScript-Medium.ttf"},{weight:600,style:"normal",src:"DancingScript-SemiBold.ttf"},{weight:700,style:"normal",src:"DancingScript-Bold.ttf"}]},"EB Garamond":{family:"EB Garamond",variants:[{weight:400,style:"normal",src:"EBGaramond-Regular.ttf"},{weight:400,style:"italic",src:"EBGaramond-Italic.ttf"},{weight:500,style:"normal",src:"EBGaramond-Medium.ttf"},{weight:500,style:"italic",src:"EBGaramond-MediumItalic.ttf"},{weight:600,style:"normal",src:"EBGaramond-SemiBold.ttf"},{weight:600,style:"italic",src:"EBGaramond-SemiBoldItalic.ttf"},{weight:700,style:"normal",src:"EBGaramond-Bold.ttf"},{weight:700,style:"italic",src:"EBGaramond-BoldItalic.ttf"},{weight:800,style:"normal",src:"EBGaramond-ExtraBold.ttf"},{weight:800,style:"italic",src:"EBGaramond-ExtraBoldItalic.ttf"}]},"Gentium Plus":{family:"Gentium Plus",variants:[{weight:400,style:"normal",src:"GentiumPlus-Regular.woff2"},{weight:400,style:"italic",src:"GentiumPlus-Italic.woff2"},{weight:700,style:"normal",src:"GentiumPlus-Bold.woff2"},{weight:700,style:"italic",src:"GentiumPlus-BoldItalic.woff2"}]},"Gentium Book Plus":{family:"Gentium Book Plus",variants:[{weight:400,style:"normal",src:"GentiumBookPlus-Regular.woff2"},{weight:400,style:"italic",src:"GentiumBookPlus-Italic.woff2"},{weight:700,style:"normal",src:"GentiumBookPlus-Bold.woff2"},{weight:700,style:"italic",src:"GentiumBookPlus-BoldItalic.woff2"}]},Hack:{family:"Hack",variants:[{weight:400,style:"normal",src:"Hack-Regular.ttf"},{weight:400,style:"italic",src:"Hack-Italic.ttf"},{weight:700,style:"normal",src:"Hack-Bold.ttf"},{weight:700,style:"italic",src:"Hack-BoldItalic.ttf"}]},Jost:{family:"Jost",variants:[{weight:100,style:"normal",src:"Jost-100-Hairline.ttf"},{weight:100,style:"italic",src:"Jost-100-HairlineItalic.ttf"},{weight:200,style:"normal",src:"Jost-200-Thin.ttf"},{weight:200,style:"italic",src:"Jost-200-ThinItalic.ttf"},{weight:300,style:"normal",src:"Jost-300-Light.ttf"},{weight:300,style:"italic",src:"Jost-300-LightItalic.ttf"},{weight:400,style:"normal",src:"Jost-400-Book.ttf"},{weight:400,style:"italic",src:"Jost-400-BookItalic.ttf"},{weight:500,style:"normal",src:"Jost-500-Medium.ttf"},{weight:500,style:"italic",src:"Jost-500-MediumItalic.ttf"},{weight:600,style:"normal",src:"Jost-600-Semi.ttf"},{weight:600,style:"italic",src:"Jost-600-SemiItalic.ttf"},{weight:700,style:"normal",src:"Jost-700-Bold.ttf"},{weight:700,style:"italic",src:"Jost-700-BoldItalic.ttf"},{weight:800,style:"normal",src:"Jost-800-Heavy.ttf"},{weight:800,style:"italic",src:"Jost-800-HeavyItalic.ttf"},{weight:900,style:"normal",src:"Jost-900-Black.ttf"},{weight:900,style:"italic",src:"Jost-900-BlackItalic.ttf"}]},Libertine:{family:"Libertine",variants:[{weight:400,style:"normal",src:"LinLibertine.woff2"},{weight:400,style:"italic",src:"LinLibertineI.woff2"},{weight:700,style:"normal",src:"LinLibertineB.woff2"},{weight:700,style:"italic",src:"LinLibertineBI.woff2"}]},"Linux Biolinum":{family:"Linux Biolinum",variants:[{weight:400,style:"normal",src:"LinBiolinum_R.otf"},{weight:400,style:"italic",src:"LinBiolinum_RI.otf"},{weight:700,style:"normal",src:"LinBiolinum_RB.otf"}]},"Source Serif Pro":{family:"Source Serif Pro",variants:[{weight:200,style:"normal",src:"SourceSerifPro-ExtraLight.otf.woff2"},{weight:200,style:"italic",src:"SourceSerifPro-ExtraLightIt.otf.woff2"},{weight:300,style:"normal",src:"SourceSerifPro-Light.otf.woff2"},{weight:300,style:"italic",src:"SourceSerifPro-LightIt.otf.woff2"},{weight:400,style:"normal",src:"SourceSerifPro-Regular.otf.woff2"},{weight:400,style:"italic",src:"SourceSerifPro-It.otf.woff2"},{weight:600,style:"normal",src:"SourceSerifPro-Semibold.otf.woff2"},{weight:600,style:"italic",src:"SourceSerifPro-SemiboldIt.otf.woff2"},{weight:700,style:"normal",src:"SourceSerifPro-Bold.otf.woff2"},{weight:700,style:"italic",src:"SourceSerifPro-BoldIt.otf.woff2"},{weight:900,style:"normal",src:"SourceSerifPro-Black.otf.woff2"},{weight:900,style:"italic",src:"SourceSerifPro-BlackIt.otf.woff2"}]},Oswald:{family:"Oswald",variants:[{weight:200,style:"normal",src:"Oswald-ExtraLight.ttf"},{weight:300,style:"normal",src:"Oswald-Light.ttf"},{weight:400,style:"normal",src:"Oswald-Regular.ttf"},{weight:500,style:"normal",src:"Oswald-Medium.ttf"},{weight:600,style:"normal",src:"Oswald-SemiBold.ttf"},{weight:700,style:"normal",src:"Oswald-Bold.ttf"}]},Poppins:{family:"Poppins",variants:[{weight:100,style:"normal",src:"Poppins-Thin.ttf"},{weight:100,style:"italic",src:"Poppins-ThinItalic.ttf"},{weight:200,style:"normal",src:"Poppins-ExtraLight.ttf"},{weight:200,style:"italic",src:"Poppins-ExtraLightItalic.ttf"},{weight:300,style:"normal",src:"Poppins-Light.ttf"},{weight:300,style:"italic",src:"Poppins-LightItalic.ttf"},{weight:400,style:"normal",src:"Poppins-Regular.ttf"},{weight:400,style:"italic",src:"Poppins-Italic.ttf"},{weight:500,style:"normal",src:"Poppins-Medium.ttf"},{weight:500,style:"italic",src:"Poppins-MediumItalic.ttf"},{weight:600,style:"normal",src:"Poppins-SemiBold.ttf"},{weight:600,style:"italic",src:"Poppins-SemiBoldItalic.ttf"},{weight:700,style:"normal",src:"Poppins-Bold.ttf"},{weight:700,style:"italic",src:"Poppins-BoldItalic.ttf"},{weight:800,style:"normal",src:"Poppins-ExtraBold.ttf"},{weight:800,style:"italic",src:"Poppins-ExtraBoldItalic.ttf"},{weight:900,style:"normal",src:"Poppins-Black.ttf"},{weight:900,style:"italic",src:"Poppins-BlackItalic.ttf"}]}};async function de(t){const e=window.location.pathname.split("/").filter(t=>t),i=[];for(let n=e.length;n>=0;n--){const o=0===n?"/":"/"+e.slice(0,n).join("/")+"/";i.push(`${o}fonts/${t}`)}i.push(`./fonts/${t}`),i.push(`../fonts/${t}`),i.push(`../../fonts/${t}`);for(const t of i)try{const e=await fetch(t,{method:"GET"});if(e.ok){const i=e.headers.get("content-type")||"";if(i.includes("font")||i.includes("application/octet-stream")||i.includes("application/x-font")||i.includes("font/woff")||i.includes("font/woff2")||i.includes("font/ttf")||i.includes("font/otf"))return t;{const i=await e.text();if(i.trim().toLowerCase().startsWith("<!doctype")||i.trim().toLowerCase().startsWith("<html"))continue;if(i.length>1e3)return t}}}catch(t){}return null}let ce=null;async function ue(){if(!0===ce)return ce;const t=document.createElement("video");t.src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAC/htZGF03ABMYXZjNjEuMy4xMDAAAoiXJcUqqrn9uPv7XpdlwBISEhISEhISE03gU9BQMbNmwYGRIgY2bBgZEillllxllllllll4AAACVgYF//9S3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2NCByMzEwOCAzMWUxOWY5IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTAgcmVmPTEgZGVibG9jaz0wOi0zOi0zIGFuYWx5c2U9MDowIG1lPWRpYSBzdWJtZT0wIHBzeT0xIHBzeV9yZD0yLjAwOjAuNzAgbWl4ZWRfcmVmPTAgbWVfcmFuZ2U9MTYgY2hyb21hX21lPTEgdHJlbGxpcz0wIDh4OGRjdD0wIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PTAgdGhyZWFkcz0xIGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTAgaW50cmFfcmVmcmVzaD0wIHJjPWNyZiBtYnRyZWU9MCBjcmY9MjMuMCBxY29tcD0wLjYwIHFwbWluPTAgcXBtYXg9NjkgcXBzdGVwPTQgaXBfcmF0aW89MS40MCBhcT0wAIAAAAAKZYiEOiYoAAkC4AEgjNoJWyVslbJV//F/v+L6n/9X/2+/Wp//W/6/fzqv/6n/n9daDVS0ag1Am7yWJf/VDh6lKbZdzvXfR676NvMAfPE7Z9exG0hIQwiIooYovlEOJfIRHopip551cAEk64ru1+Km/XP9Pv+/tetTVrsP/DaXfeF/J8DvaEI+Pgwz6IRk+AHfeEH+AHfcA/wYcAAAAAVBmiAmlAD2K4rsqZVZk//r/v//66401XfFwfRdFFFFFFBggwoNRQYxlrNR0GXWB0BaAGEx5JxwAPYrikJW5WMyr//x/5//PjV6VzxKGyfmnnnnn6rBOwTqnVOpR5+ZXqulDASITnUcAAAABUGaQCqUAPYrigJ2KqsrH/+X9//5OONE8avQ+T+WKLLFFEQWQiiiiKIn6iteZMoLt9UOAPQriiJmYbyj//F/P/8OtXFZxNjneS88889ppHmQeeeeeeY9z3T4JDYtnJ5p2HAAAAAFQZpgKpQA+iuSAnUYyqf/5f3//9da1Ud9WASlEhMwSEnEq3xW5xZxYStoTGLhK0YrmUhh4a0nAAAABUGagCqUAT4rgCI2NYmGaH/7itVk//qfz/7wtvXjqgjSFhbpcs+rPKsEfQ9TEoIryAeXplnlLCocLj0tpXQlJF5GyRWtrjgA+CuR4oboVWT//J/P/7+pddVzbgAxK9EOBgYcOJuMU4NmDEh2N7wv/OoiwlRNvocAAAAFQZqgKpQA8CuKAnb2pWd3//l/n//11fXOr9/iUNkUUUUUUURBZCIoooixRArWUormUhotYcAA+iuKQlUpjMn/+L/P/58dS1Y4sfTn+j3m8889SHow8x4PPMZpSxxaUWooIW9NkeAAAAAFQZrAKpQA+CuKQlUpuq5v//L+///rq+q1Xr4rQ+i6KKKKKKDBBhQag1C+nAGotgSimtnIzVI8APQriiJnNKrGX//j/z/+fnhdTvqrGyc5555557BO2J1Tz+qlT9XMvRI0Fhe9lHAAAAAFQZrgKpQA+CuKAnZKVmc6//r/v//J1rROZqD5P/LL8uOWKIgshFFFFFN3RVLkoPOUIQupRwAAAAVBmwAqlADwK4oiZusqZmT//J/P/7+r4ZPHtMHO8l557v/ff7DzIaWaXu9557nuKpEzORw3qOAA+iuSImVRVV3r//L/P//rjiK1zc4aGZFAGDNjjggkJCQkJCQkJW0+K3CVhMxU4cptLWskbCwuWOAAAAAFQZsgKpQA8CuR4octym8n/9f9//5OtTXOvF2C1zYJEgYeSF3xW55YYeLTdliwguUE1hwA9iuRQtbUxutf/5P5//hxeqvM6cAGBga8SHAxIkTeWD3b9+/fv04IXKEGYzjRUQ4AAAAFQZtAKpQA8CuKQldqqqzH/+X9//5OOpnndaYNkSIoooooiCyERRRFj3IIRXdtEHqVsMFajgAAAAVBm2AqlAD4K4oCdVKrdU//w/5//Pq+JU9dSx9OdLzzzz3PSHlB5jzzw825Sa6kFygmSk4A+iuKAnGUrMf/5f3//9edaqXtdD6a9dFFG7dQYIMKDUUUUdNEYp2lRHwTSF52HAAAAAVBm4AqlADyK4nihzVKrdX//j/0//LrhZz1A2TnnnnnnnsGxsTqnnnnpTQVKEyxGE6jgAD4K4oCdhVVmT/+v/P//rq9Sr9ebwbNny+Xy+XHLxILIRFFFxKKKpWlKFyhCM6jgAAAAAVBm6AqlADuK4oiZvmVlZU//y/z//66uuKvuXBAxiXnnu/v9heQ/en9/uJxKXrlZSoaiQusOAD6K5ICdVFVup//k/n/+Pqakzx7VYCRISlCQkJCRJR6q3CcgkrNgE05pqyRTLEZrDgAAAAFQZvAKpQA8CuJQtczKbyn/9f+f//XU4vL3NbBjNUUUdPS1GrFsjs2bH7RtFe1kXsKCNqjgAAAAAVBm+AqlAD2K4oiZtVN5XH/+T/T/8uuqSc6kHyfyzzzzzz+g9bhOqefmnnIlL1oiwEiGBvUcADyK4piR4uqqt1P/6/7//ydXrOnr2yh8iRFFFFEggshFFFFFFFEQiVNIRk1bCaw4AAAAAVBmgAqlAD2K4nihmKpzV//4v8//n1pxU30wfSBLzzzzz1IeUHmPPd7JJSnbxylFsMSWHRbWOAA+CuRAvbKqsp//l/f/+TjiJPHGsAScOTTTTTWirFs2bIxjsjGKwiuSIQtUcAAAAAFQZogKpQA7iuJ4od7Kzaf/4v5//h1JcVcCeZU8888/VYNhhPPPPOeiJa1C/gNpfDfeOAA+CuSAnZQzKf/5f3//k61I13eQAwMDAwMDAxuJT4KcGlBpSUqJVblflgMNWIXWHAAAAAFQZpAKpQA6CuKImd9xVc5r//Z/P/8nHC1d61Y8mMR3/v9/v9+wWQ/fL93aSkxZcx0SLkiGa/pScAAAAAFQZpgKpQA+iuRwpYpVMf/4/5//f1Jaq4ywE3Ut0JuiRIko4tbhOQSV165SmnPKkQLCKo4APIrikJW5uqquZ//l/n//11xLlePrYa6F0UUUdNBggwoNRQbpoMs1CLUiZiI3vYcAAAABUGagCqUAPYrieKG6VVVk//xf5//PrS454zofI55555557BPcJ1Tz7FUe699NiC5ITWocAD0K4pCVypWVzr/+v+///rri17amx8ouMUUUUURBZCIRRRRRREIqkEHnVoQvWo4AAAABUGaoCqUAPQrieKG8K2y//8f+f/z64rqnr6zQ+iWPPPPPPUh6EPMeeeeklr1hBMqRgxKOAAAAAVBmsAqlAD4K5Ei5lSm65v//L+//8nU4rWvUvAEhMwSEhKWaaKsWzZs2bHr2Rjstli3NhIYVhwA6iuKAnd9ylZj//H/P/7+uJvh69t+RPMo8/r69XV1jYYdSuqf9NescTJiULlBdrUhwAAAAAVBmuAqlAD6K5HihhVU5v//L/P//rq64vOemwDAyIGBgYGBkTL4KcGZBgaUGorfz5NykGYqMyo4ASxLkuN0eOef+P8f6Tpw1elgAVaPDz9ggAAHwzcQAADuHn3cAMO48PdxAAxaHh63EACnH8AAAAAFQZsAKpQBHo2mCNsjbJUM//t/9fv1x9f/6/59uL//j/6CCHSHqCps7WRjeOxHZdsbI52ERPII5vFkt7byXRf1fgb7/cvked5557v4ARiBtHAAAAfRbW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAAA+gAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAw90cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+gAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAABAAAAAQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPoAAAAAAABAAAAAAKHbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAAyAAAAMgBVxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACMm1pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAfJzdGJsAAAAtnN0c2QAAAAAAAAAAQAAAKZhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAABAAEABIAAAASAAAAAAAAAABFExhdmM2MS4zLjEwMCBsaWJ4MjY0AAAAAAAAAAAAAAAAGP//AAAALGF2Y0MBQsAK/+EAFWdCwAraewEQAAADABAAAAMDIPEiagEABGjOD8gAAAAQcGFzcAAAAAEAAAABAAAAFGJ0cnQAAAAAAAAaAAAAGgAAAAAYc3R0cwAAAAAAAAACAAAALAAABAAAAAABAAAARAAAALhzdHNjAAAAAAAAAA4AAAABAAAAAQAAAAEAAAACAAAAAgAAAAEAAAAFAAAAAQAAAAEAAAAGAAAAAgAAAAEAAAAJAAAAAQAAAAEAAAAKAAAAAgAAAAEAAAAMAAAAAQAAAAEAAAANAAAAAgAAAAEAAAAQAAAAAQAAAAEAAAARAAAAAgAAAAEAAAAUAAAAAQAAAAEAAAAVAAAAAgAAAAEAAAAXAAAAAQAAAAEAAAAYAAAAAgAAAAEAAADIc3RzegAAAAAAAAAAAAAALQAAAEUAAABdAAAAMwAAADIAAAAwAAAALQAAAC8AAAAxAAAAQQAAADAAAAAwAAAAMAAAADEAAAAvAAAALwAAADEAAAA5AAAALQAAADAAAAAvAAAALgAAAC8AAAAtAAAAMAAAADAAAAAxAAAALwAAADAAAAAwAAAAMQAAAC0AAAAtAAAAMAAAADMAAAAuAAAAMAAAAC4AAAAvAAAALgAAADEAAAAyAAAAMgAAADUAAABGAAAABQAAAHhzdGNvAAAAAAAAABoAAAAwAAAC3QAAA3YAAAPhAAAERgAABIAAAAT6AAAFYwAABcwAAAYEAAAGdwAABt0AAAcVAAAHewAAB+EAAAhLAAAIgwAACOwAAAlTAAAJuQAACfUAAApcAAAKwgAACvkAAAtlAAAL1QAAABpzZ3BkAQAAAHJvbGwAAAACAAAAAf//AAAAHHNiZ3AAAAAAcm9sbAAAAAEAAAAtAAAAAQAAAGF1ZHRhAAAAWW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALGlsc3QAAAAkqXRvbwAAABxkYXRhAAAAAQAAAABMYXZmNjEuMS4xMDA=",t.autoplay=!1,t.muted=!1,t.playsInline=!0,t.volume=1e-4;try{return await Promise.race([new Promise(e=>t.addEventListener("canplaythrough",e,{once:!0})),new Promise((t,e)=>setTimeout(()=>e(new Error("Timeout waiting for video to be ready")),2e3))]),await t.play(),t.pause(),t.src="",t.load(),t.remove(),ce=!0,!0}catch(e){return t.pause(),t.src="",t.load(),t.remove(),!1}}async function he(t){return new Promise(e=>{const i=document.createElement("video");i.onloadedmetadata=()=>{var t;const n=Boolean(i.mozHasAudio)||Boolean(i.webkitAudioDecodedByteCount)||Boolean(null===(t=i.audioTracks)||void 0===t?void 0:t.length);i.onloadedmetadata=null,i.onerror=null,i.src="",i.load(),i.remove(),e(n)},i.onerror=()=>{i.onloadedmetadata=null,i.onerror=null,i.src="",i.load(),i.remove(),e(!1)},i.src=t,i.load()})}function pe(t){const e=Number(t);return isNaN(e)?0:e}function me(t){var e,i,n;let o=null===(e=null==t?void 0:t.content)||void 0===e?void 0:e.src;if(!o)return console.error("[ERROR] No source found for video.",t),"";const r=o.split(":")[0];if("http"===r||"https"===r){const t=(null===(n=null===(i=window.location)||void 0===i?void 0:i.protocol)||void 0===n?void 0:n.replace(":",""))||"";r!==t&&(o=o.replace(r,t))}return o}function ge(t){var e;const i=null===(e=null==t?void 0:t.content)||void 0===e?void 0:e["playback-mode"];return i||"loop"}function fe(t,e){var i,n;return(null!=e?e:0)-(null!==(n=null===(i=null==t?void 0:t.options)||void 0===i?void 0:i.start)&&void 0!==n?n:0)}function ve(t,e,i){var n,o,r,s;const a=function(t,e,i){const n=ye(t),o=Ae(t,e,i);return o-n}(e,null===(n=null==t?void 0:t.options)||void 0===n?void 0:n.start,null===(o=null==t?void 0:t.options)||void 0===o?void 0:o.end),l=ye(e),d=fe(t,i),c=ge(t);if("once"===c){const i=l+d,n=Ae(e,null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.start,null===(s=null==t?void 0:t.options)||void 0===s?void 0:s.end);return Math.min(i,n)}if("loop"===c){return l+d%a}return d}function ye(t){const e=null==t?void 0:t["mark-in"];return e||0}function Ae(t,e,i){const n=ye(t),o=null==t?void 0:t["mark-out"];if(!o||0===o){return i-e+n}return o}let be=null;try{be=new BroadcastChannel("data-layer-manager-cache")}catch(t){console.warn("[DataLayerUtils] BroadcastChannel not supported, cross-window cache disabled:",t)}const we="DataLayerManager_",Ee="DataLayerManager_Request_",xe=new Map;function Se(t){const e=`${we}_${t}`,i=localStorage.getItem(e);if(!i)return null;try{const{data:t,timestamp:n}=JSON.parse(i);return Date.now()<n?t:(localStorage.removeItem(e),null)}catch(t){return console.error("[DataLayerManager] Error parsing cross-window cache data:",t),null}}async function $e(t,e,i="GET",n,o){if(function(t){const e=`${Ee}_${t}`,i=localStorage.getItem(e);if(!i)return!1;try{const{timestamp:t}=JSON.parse(i);return!(Date.now()-t>3e4&&(localStorage.removeItem(e),1))}catch(t){return console.error("[DataLayerManager] Error parsing cross-window request data:",t),!1}}(t)){const e=3e4,i=100,n=Date.now();for(;Date.now()-n<e;){await new Promise(t=>setTimeout(t,i));const e=Se(t);if(e)return e}}if(xe.has(t))try{return await xe.get(t)}catch(e){console.error("[DataLayerManager] Existing request failed for source:",t,e),xe.delete(t)}const r=function(t){return`${Ee}_${t}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}(t);!function(t,e){const i=`${Ee}_${t}`,n={timestamp:Date.now(),requestId:e,source:t};localStorage.setItem(i,JSON.stringify(n))}(t,r);const s=(async()=>{try{const r={method:i};n&&(r.headers=n),!o||"POST"!==i&&"PUT"!==i||("string"==typeof o?r.body=o:(r.headers={...r.headers,"Content-Type":"application/json"},r.body=JSON.stringify(o)));const s=await fetch(t,r);if(!s.ok)throw new Error(`Failed to fetch data: ${s.status}`);const a=await s.json();return function(t,e,i){const n=`${we}_${t}`,o={data:e,timestamp:Date.now()+i};localStorage.setItem(n,JSON.stringify(o))}(t,a,e),function(t,e){if(be)try{be.postMessage({type:"cache-update",source:t,data:e})}catch(t){console.error("[DataLayerManager] Error broadcasting cache update:",t)}}(t,a),a}catch(e){throw console.error("[DataLayerManager] Error fetching data from:",t,e),e}finally{xe.delete(t),function(t){const e=`${Ee}_${t}`;localStorage.removeItem(e)}(t)}})();return xe.set(t,s),s}function _e(t,e){if(!e||!e.valueType)return t;const{valueType:i,formatting:n}=e;try{switch(i){case"any":return t;case"string":return String(t);case"number":const e=function(t,e){let i=parseFloat(t);if(isNaN(i))return t;if(!e)return i;const{decimals:n,thousandsSeparator:o=",",decimalSeparator:r=".",prefix:s="",suffix:a="",roundingMode:l="round"}=e;if(void 0!==n){const t=Math.pow(10,n);switch(l){case"floor":i=Math.floor(i*t)/t;break;case"ceil":i=Math.ceil(i*t)/t;break;default:i=Math.round(i*t)/t}}let d=i.toFixed(void 0!==n?n:0);"."!==r&&(d=d.replace(".",r));if(o&&void 0!==n){const t=d.split(r);t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,o),d=t.join(r)}return`${s}${d}${a}`}(t,null==n?void 0:n.number);return e;case"boolean":return Boolean(t);case"timestamp":return function(t,e){let i;if(t instanceof Date)i=t;else if("number"==typeof t)i=new Date(t);else{if("string"!=typeof t)return String(t);i=new Date(t)}if(isNaN(i.getTime()))return String(t);if(!e)return i.toISOString();const{format:n,timezone:o,locale:r="en-US"}=e;try{const t={};if(o&&(t.timeZone=o),n){let t=n;return t=t.replace(/YYYY/g,i.getFullYear().toString()),t=t.replace(/MM/g,(i.getMonth()+1).toString().padStart(2,"0")),t=t.replace(/DD/g,i.getDate().toString().padStart(2,"0")),t=t.replace(/HH/g,i.getHours().toString().padStart(2,"0")),t=t.replace(/mm/g,i.getMinutes().toString().padStart(2,"0")),t=t.replace(/ss/g,i.getSeconds().toString().padStart(2,"0")),t}return i.toLocaleString(r,t)}catch(t){return console.error("[DataLayerManager] Error formatting timestamp:",t),i.toISOString()}}(t,null==n?void 0:n.timestamp);case"object":return"object"==typeof t?JSON.stringify(t):String(t);case"array":return Array.isArray(t)?JSON.stringify(t):String(t);default:return console.warn(`[DataLayerManager] Unknown valueType: ${i}`),t}}catch(n){return console.error(`[DataLayerManager] Error evaluating variable ${e.id} with type ${i}:`,n),t}}function Me(t,e,i=void 0){if(null==e)throw new TypeError("Path cannot be null or undefined");if("string"!=typeof e)throw new TypeError("Path must be a string, got "+typeof e);if(null==t)return i;if(""===e.trim())return t;const n=[];let o="",r=!1,s="";for(let t=0;t<e.length;t++){const i=e[t];if(r)if(s||'"'!==i&&"'"!==i){if(s&&i===s)s="";else if(s||"]"!==i)s&&!s||'"'!==i&&"'"!==i&&(o+=i);else if(n.push(o),o="",r=!1,t+1<e.length&&"."!==e[t+1]&&"["!==e[t+1])throw new SyntaxError(`Malformed path: unexpected character '${e[t+1]}' after closing bracket in "${e}"`)}else s=i;else"["===i?(o&&(n.push(o),o=""),r=!0):"."===i?o&&(n.push(o),o=""):o+=i}if(o&&n.push(o),r)throw new SyntaxError(`Malformed path: unclosed bracket in "${e}"`);if(s)throw new SyntaxError(`Malformed path: unclosed quote in "${e}"`);if(e.includes("..")||e.startsWith(".")||e.endsWith("."))throw new SyntaxError(`Malformed path: invalid dot notation in "${e}"`);if(e.includes("['']")||e.includes('[""]'))throw new SyntaxError(`Malformed path: empty key in brackets in "${e}"`);const a=n.reduce((t,e)=>null==t?void 0:t[e],t);return void 0===a?i:a}function ke(t,e,i){var n;const o=$t.getWidget(t.type);if(!o)throw new Error(`Widget type '${t.type}' not found in registry`);let r={...null===(n=o.defaults)||void 0===n?void 0:n.content,...t.content};if(void 0!==i){const e=t.parentValuePath?Me(i,t.parentValuePath):i;r=function(t,e,i){const n={...i};switch(t){case"text":if(n["text-options-static"]){let t=e;if(null==e)t="";else if(Array.isArray(e))t=e.join(", ");else if("object"==typeof e)try{t=JSON.stringify(e,null,2)}catch(i){console.warn("[generateDynamicContent] Failed to stringify object, using string conversion:",i),t=String(e)}else t="string"==typeof e?e:String(e);n["text-options-static"]={...n["text-options-static"],text:t}}break;case"image":if(n.src){let t=e;Array.isArray(e)?t=e[0]:null==e&&(t=n.src.fallback||"default-image.jpg"),n.src={...n.src,fallback:String(t)}}break;case"flexbox":break;default:console.warn(`[generateDynamicContent] Unknown widget type: ${t}`)}return n}(t.type,e,r)}else"text"===t.type&&(r=function(t){const e={...t};if(e["text-options-static"]){const t=e["text-options-static"];t.text&&"object"==typeof t.text&&t.text.fallback&&(e["text-options-static"]={...t,text:""})}return e}(r));const s={id:e?`${t.id}${e}`:t.id,type:t.type,name:t.name||`Generated ${o.data.title}`,content:r,props:t.props,options:t.options||{start:0,end:1e4,visible:!0,locked:!1,selected:!1}};return"flexbox"===t.type?{...s,children:[]}:s}function Ce(t){return t.sort((t,e)=>{var i,n;return(null!==(i=e.priority)&&void 0!==i?i:0)-(null!==(n=t.priority)&&void 0!==n?n:0)}).map(t=>t.widget)}function Re(t,e,i){const n=[];for(const o of t){const t=ke(o,i,e);n.push(t)}return n}function Oe(t,e,i,n,o,r){const s=function(t,e,i,n){return{...t,parentValuePath:void 0!==t.parentValuePath?t.parentValuePath:n,content:Pe(t.content),props:Pe(t.props)}}(t,0,0,n),a=`-${i}`,l=ke(s,a,r);if("flexbox"===t.type){const e=l,i=[];if(t.arrayIteration)if(o){let e;if(e=r&&t.arrayIteration.parentValuePath?Me(r,t.arrayIteration.parentValuePath,[]):o.getValue(t.arrayIteration.variableId,[]),Array.isArray(e)&&e.length>0)for(let n=0;n<e.length;n++){const r=e[n];for(const e of t.arrayIteration.childTemplates){const s=Oe(e,t.arrayIteration.variableId,n,t.arrayIteration.parentValuePath,o,r);i.push({widget:s,priority:e.priority})}}}else console.warn("[WIDGET_BUILDER] DataLayerManager not provided for nested array iteration");if(t.children){const e=Re(t.children,r,a);for(let n=0;n<e.length;n++){const o=t.children[n];i.push({widget:e[n],priority:o.priority})}}const n=Ce(i);e.children.push(...n)}return l}function Pe(t,e,i,n,o){if(null==t)return t;if(Array.isArray(t))return t.map(t=>Pe(t));if("object"==typeof t){const e={};for(const[i,n]of Object.entries(t))e[i]=Pe(n);return e}return t}function Ie(t,e,i){try{const n=structuredClone(t),o=function(t,e){const i=[];for(const n of t){const t=ke(n);if("flexbox"===n.type){const i=t,o=[];if(n.arrayIteration&&e){const t=e.getValue(n.arrayIteration.variableId,[]);if(Array.isArray(t)&&t.length>0)for(let i=0;i<t.length;i++){const r=t[i];for(const t of n.arrayIteration.childTemplates){const s=Oe(t,n.arrayIteration.variableId,i,n.arrayIteration.parentValuePath,e,r);o.push({widget:s,priority:t.priority||0})}}}if(n.children){const t=Re(n.children);for(let e=0;e<t.length;e++){const i=n.children[e];o.push({widget:t[e],priority:i.priority})}}const r=Ce(o);i.children.push(...r)}i.push(t)}return i}(e.widgets,i),r=[],s=t=>{t.forEach(t=>{r.push(String(t.id)),"children"in t&&t.children&&s(t.children)})};return s(o),n.children.push(...o),{document:n,generatedWidgetIds:r}}catch(e){return console.error("[extendLayoutWithDataLayerWidgets] Error:",e),{document:t,generatedWidgetIds:[]}}}let De=null;try{De=new BroadcastChannel("data-layer-manager-cache")}catch(t){console.warn("[DataLayerManager] BroadcastChannel not supported, cross-window cache disabled:",t)}const Te="DataLayerManager_variables";class Le{constructor(){this.mode="default",this.DEBUG_LOGS=!0,this.config=null,this.variableValues=new Map,this.dependencies=new Map,this.reverseDependencies=new Map,this.listeners=new Set,this.fetchIntervals=new Map,this.documentUpdateListeners=new Set,this.documentVariableDependencies=new Map,this.generatedWidgetIds=new Set,function(){if(be)try{be.onmessage=t=>{const{type:e,source:i,data:n}=t.data||{};if("cache-update"===e&&"string"==typeof i){const t=`${we}${i}`;localStorage.setItem(t,JSON.stringify({data:n,timestamp:Date.now()+6e4}))}}}catch(t){console.error("[DataLayerUtils] Error setting up cross-window listener:",t)}}(),this.loadCachedVariables()}isInitialized(){return null!==this.config}async initialize(t,e){if(t&&t.variables&&(this.config=t,this.dependencies.clear(),this.reverseDependencies.clear(),this.fetchIntervals.forEach(t=>clearInterval(t)),this.fetchIntervals.clear(),this.buildDependencyGraph(),await this.calculateAllVariables(),e)){const t=this.processDocumentProperties(e);this.notifyDocumentUpdate(t)}}getValue(t,e){const i=this.variableValues.get(t);if(void 0!==i){if("string"==typeof i&&(i.startsWith("[")||i.startsWith("{")))try{return JSON.parse(i)}catch(t){return i}return i}return e}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}subscribeToDocumentUpdates(t){return this.documentUpdateListeners.add(t),()=>this.documentUpdateListeners.delete(t)}setDocument(t){this.documentVariableDependencies.clear();return this.processDocumentProperties(t)}subscribeToVariables(t,e){return this.subscribe((i,n)=>{t.includes(i)&&e(i,n)})}loadCachedVariables(t){try{const e=localStorage.getItem(Te);if(e){const i=JSON.parse(e);for(const[t,e]of Object.entries(i))this.variableValues.set(t,e);if(t){const e=this.processDocumentProperties(t);this.notifyDocumentUpdate(e)}}}catch(t){console.error("[DataLayerManager] Error loading cached variables:",t)}}saveCachedVariables(){try{const t={};this.variableValues.forEach((e,i)=>{t[i]=e}),localStorage.setItem(Te,JSON.stringify(t))}catch(t){console.error("[DataLayerManager] Error saving variables to cache:",t)}}cleanup(){this.fetchIntervals.forEach(t=>{clearInterval(t)}),this.fetchIntervals.clear(),this.documentUpdateListeners.clear(),this.documentVariableDependencies.clear(),this.clearAll()}processDocumentProperties(t){var e;let i=structuredClone(t);if("default"===this.mode&&(null===(e=i.dataLayer)||void 0===e?void 0:e.dynamicWidgets))try{const t=i.children.filter(t=>!this.generatedWidgetIds.has(String(t.id)));this.generatedWidgetIds.clear(),i.children=t;const e=Ie(i,i.dataLayer.dynamicWidgets,this);i=e.document,e.generatedWidgetIds.forEach(t=>this.generatedWidgetIds.add(t))}catch(t){console.error("[ERROR] DataLayerManager: Error processing dynamic widgets:",t)}return i.props&&this.walkAndResolveProperties(i.props,"root.props"),i.children&&i.children.forEach((t,e)=>{this.processElementProperties(t,`root.children[${e}]`)}),i}processElementProperties(t,e){t.props&&this.walkAndResolveProperties(t.props,`${e}.props`),"content"in t&&t.content&&this.walkAndResolveProperties(t.content,`${e}.content`),"children"in t&&t.children&&t.children.forEach((t,i)=>{this.processElementProperties(t,`${e}.children[${i}]`)})}walkAndResolveProperties(t,e){for(const[i,n]of Object.entries(t)){const o=`${e}.${i}`;if(this.isVariableReference(n)){this.addDocumentDependency(n.variableId,o);let e=this.getValue(n.variableId,n.fallback);const r=n.parentValuePath||n.valuePath;r&&null!=e&&(e=Me(e,r,n.fallback)),(null==e||""===e)&&void 0!==n.fallback?t[i]=n.fallback:t[i]=e}else Array.isArray(n)?n.forEach((t,e)=>{if(t&&"object"==typeof t&&"value"in t)this.walkAndResolveProperties(t,`${o}[${e}]`);else if(this.isVariableReference(t)){this.addDocumentDependency(t.variableId,`${o}[${e}]`);let i=this.getValue(t.variableId,t.fallback);const r=t.parentValuePath||t.valuePath;r&&null!=i&&(i=Me(i,r,t.fallback)),n[e]=null!=i&&""!==i||void 0===t.fallback?i:t.fallback}}):n&&"object"==typeof n&&this.walkAndResolveProperties(n,o)}}isVariableReference(t){return t&&"object"==typeof t&&"variableId"in t&&"string"==typeof t.variableId}addDocumentDependency(t,e){this.documentVariableDependencies.has(t)||this.documentVariableDependencies.set(t,new Set),this.documentVariableDependencies.get(t).add(e)}buildDependencyGraph(){if(this.config){this.dependencies.clear(),this.reverseDependencies.clear();for(const t of this.config.variables){if("function"!==t.type||!t.function)continue;const e=t.function,i=(()=>{var t;if("add"===e.method||"subtract"===e.method)return null!==(t=e.operands)&&void 0!==t?t:[];if("equals"===e.method){return[e.left,e.right].filter(t=>"string"==typeof t&&t.length>0)}return[]})();if(i.length>0){this.reverseDependencies.set(t.id,new Set(i));for(const e of i)this.dependencies.has(e)||this.dependencies.set(e,new Set),this.dependencies.get(e).add(t.id)}}}}async calculateAllVariables(){if(!this.config)return;const t=new Set,e=new Set,i=async n=>{if(t.has(n)||e.has(n))return;const o=this.config.variables.find(t=>t.id===n);if(!o)return void console.warn(`[WARNING] DataLayerManager: Variable ${n} not found in config`);e.add(n);const r=this.reverseDependencies.get(n);if(r)for(const t of r)await i(t);await this.calculateSingleVariable(o),e.delete(n),t.add(n)};for(const t of this.config.variables)await i(t.id)}async calculateSingleVariable(t){let e;try{switch(t.type){case"fixed":e=this.calculateFixedVariable(t);break;case"function":e=this.calculateFunctionVariable(t);break;case"fetch":e=await this.calculateFetchVariable(t);break;default:console.warn(`[WARNING] DataLayerManager: Unknown variable type: ${t.type}`),e=t.defaultValue}}catch(i){console.error(`[ERROR] DataLayerManager: Error calculating variable ${t.id}:`,i),e=t.defaultValue}this.setVariableValue(t.id,e)}calculateFixedVariable(t){var e,i;return null!==(i=null===(e=t.fixed)||void 0===e?void 0:e.value)&&void 0!==i?i:t.defaultValue}calculateFunctionVariable(t){if(!t.function)return console.warn(`[WARNING] DataLayerManager: Function variable ${t.id} missing function config`),t.defaultValue;const e=t.function,i=e.method,n=e.config,o=(()=>{var t;if("add"===i||"subtract"===i){return(null!==(t=e.operands)&&void 0!==t?t:[]).map(t=>this.getValue(t))}if("equals"===i){const t=e,i=t.left,n=t.right;return[i?this.getValue(i):void 0,n?this.getValue(n):void 0]}return[]})();let r;switch(i){case"add":r=o.reduce((t,e)=>{const i=parseFloat(e);return isNaN(i)?t:t+i},0);break;case"subtract":if(0===o.length)r=0;else{const t=parseFloat(o[0]);r=isNaN(t)?0:o.slice(1).reduce((t,e)=>{const i=parseFloat(e);return isNaN(i)?t:t-i},t)}break;case"equals":r=this.calculateEqualsFunction(o,n);break;default:console.warn(`[WARNING] DataLayerManager: Unknown function method: ${i}`),r=t.defaultValue}return r}calculateEqualsFunction(t,e){var i;if(!e)return console.warn("[WARNING] DataLayerManager: Equals function missing config"),!1;const{trueValue:n,falseValue:o,operator:r="===",compareValue:s}=e;if(0===t.length)return o;const a=t[0],l=void 0!==s?s:null!==(i=t[1])&&void 0!==i?i:null,[d,c]=((t,e)=>{const i=t=>"number"==typeof t&&Number.isFinite(t)||"string"==typeof t&&""!==t.trim()&&Number.isFinite(Number(t));if(i(t)&&i(e))return[Number(t),Number(e)];const n=t=>"boolean"==typeof t?t:"string"==typeof t?"true"===t.toLowerCase():Boolean(t);if(!("boolean"!=typeof t&&"string"!=typeof t||"boolean"!=typeof e&&"string"!=typeof e)){const i="string"==typeof t?t.toLowerCase():t,o="string"==typeof e?e.toLowerCase():e;if(!(!0!==i&&!1!==i&&"true"!==i&&"false"!==i||!0!==o&&!1!==o&&"true"!==o&&"false"!==o))return[n(i),n(o)]}return[t,e]})(a,l);let u;switch(r){case"===":u=Object.is(d,c);break;case"==":u=d==c;break;case"!=":u=d!=c;break;case"!==":u=d!==c;break;case">":u=parseFloat(d)>parseFloat(c);break;case"<":u=parseFloat(d)<parseFloat(c);break;case">=":u=parseFloat(d)>=parseFloat(c);break;case"<=":u=parseFloat(d)<=parseFloat(c);break;default:console.warn(`[WARNING] DataLayerManager: Unknown comparison operator: ${r}`),u=!1}return u?null==n||""===n||n:null!=o&&""!==o&&o}async calculateFetchVariable(t){var e,i;if(!t.fetch)return console.warn(`[WARNING] DataLayerManager: Fetch variable ${t.id} missing fetch config`),null!==(e=t.defaultValue)&&void 0!==e?e:null===(i=t.fetch)||void 0===i?void 0:i.fallback;const{domain:n,port:o,route:r,valuePath:s,refreshRate:a,fallback:l,method:d="GET",headers:c,body:u}=t.fetch;let h=n;h.endsWith("/")&&(h=h.slice(0,-1));let p=r||"/";p.startsWith("/")||(p=`/${p}`);const m=`${h}${o?`:${o}`:""}${p}`,g=1e3*parseInt(a);try{const e=Se(m);if(e)return Me(e,s,l);const i=Me(await $e(m,g,d,c,u),s,l);return this.setupPeriodicRefresh(t,m,g),i}catch(e){return console.error(`[WARNING] DataLayerManager: Failed to fetch variable ${t.id}:`,e),null!=l?l:t.defaultValue}}setupPeriodicRefresh(t,e,i){const n=this.fetchIntervals.get(t.id);n&&clearInterval(n);const o=window.setInterval(async()=>{try{const n=Me(await $e(e,i,t.fetch.method||"GET",t.fetch.headers,t.fetch.body),t.fetch.valuePath,t.fetch.fallback);this.setVariableValue(t.id,n)}catch(e){console.error(`[WARNING] DataLayerManager: Periodic refresh failed for variable ${t.id}:`,e)}},i);this.fetchIntervals.set(t.id,o)}setVariableValue(t,e){var i;const n=null===(i=this.config)||void 0===i?void 0:i.variables.find(e=>e.id===t),o=_e(e,n);this.variableValues.get(t)!==o&&(this.variableValues.set(t,o),this.saveCachedVariables(),this.listeners.forEach(e=>{try{e(t,o)}catch(t){console.error("[WARNING] DataLayerManager: Error in listener callback:",t)}}),this.updateDependentVariables(t),this.checkAndUpdateDocument(t))}checkAndUpdateDocument(t){}notifyDocumentUpdate(t){this.documentUpdateListeners.forEach((e,i)=>{try{e(t)}catch(t){console.error("[ERROR] DataLayerManager: Error in document update callback:",t)}})}async updateDependentVariables(t){const e=this.dependencies.get(t);if(e&&this.config)for(const t of e){const e=this.config.variables.find(e=>e.id===t);e&&"function"===e.type&&await this.calculateSingleVariable(e)}}summarizeWidget(t){var e;const i={id:t.id,type:t.type,name:t.name||"Unnamed"};if("text"===t.type&&"content"in t&&t.content){const n=t.content;if(null===(e=n["text-options-static"])||void 0===e?void 0:e.text){const t=n["text-options-static"].text;i.textContent="string"==typeof t?t.length>50?t.substring(0,50)+"...":t:typeof t}}return"children"in t&&t.children&&(i.childrenCount=t.children.length,t.children.length>0&&(i.children=t.children.map(t=>this.summarizeWidget(t)))),i}clearAll(){this.variableValues.clear(),this.dependencies.clear(),this.reverseDependencies.clear(),this.fetchIntervals.forEach(t=>clearInterval(t)),this.fetchIntervals.clear()}}const Fe=10,ze=[l`
  .drag-handle {
    position: absolute;
    z-index: 9999;
    width: calc(100% - 16px);
    height: calc(100% - 16px);
    top: 8px;
    left: 8px;
    cursor: grab;
  }

  .drag-handle.disabled {
    cursor: pointer !important;
  }

  .drag-handle.active {
    cursor: grabbing;
    z-index: 99;
  }
`,l`
  .resize-handle {
    position: absolute;
    background: #4286f4;
    opacity: ${.5};
  }

  .resize-handle.disabled {
    cursor: pointer !important;
  }

  .resize-handle-top,
  .resize-handle-bottom {
    width: calc(100% + 6px);
    height: 6px;
    left: -3px;
    cursor: ns-resize;
  }

  .resize-handle-left,
  .resize-handle-right {
    width: 6px;
    height: calc(100% + 6px);
    top: -3px;
    cursor: ew-resize;
  }

  .resize-handle-top {
    top: -3px;
  }

  .resize-handle-bottom {
    bottom: -3px;
  }

  .resize-handle-left {
    left: -3px;
  }

  .resize-handle-right {
    right: -3px;
  }
`,l`
  .resize-bubble {
    position: absolute;
    z-index: 9999;
    width: ${Fe}px;
    height: ${Fe}px;
    border: 3px solid #4286f4;
    background: #4286f4;
    border-radius: 50%;
  }

  .resize-bubble.disabled {
    cursor: pointer !important;
  }

  .resize-bubble-top-left,
  .resize-bubble-top-right {
    top: calc(-${Fe}px + ${5}px);
  }

  .resize-bubble-bottom-left,
  .resize-bubble-bottom-right {
    bottom: calc(-${Fe}px + ${5}px);
  }

  .resize-bubble-top-left,
  .resize-bubble-bottom-left {
    left: calc(-${Fe}px + ${5}px);
  }

  .resize-bubble-top-right,
  .resize-bubble-bottom-right {
    right: calc(-${Fe}px + ${5}px);
  }

  .resize-bubble-top-left,
  .resize-bubble-bottom-right {
    cursor: nwse-resize;
  }

  .resize-bubble-top-right,
  .resize-bubble-bottom-left {
    cursor: nesw-resize;
  }
`,l`
    .dragging {
      pointer-events: none;
    }
  `];let Ne=class extends lt{constructor(){super(),this.editingMode="false",this.playbackMode="gpu",this.zoomFactor=1,this.selected=!1,this.layoutDuration=0,this.currentTimestamp=0,this.frameRate=30}updated(t){super.updated(t);let e=!1;t.has("currentTimestamp")&&(e=!0),t.has("layoutDuration")&&(e=!0),t.has("document")&&(e=!0),e&&this.updateVisibility(this.currentTimestamp)}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback()}play(){}pause(){}stop(){}async renderFrame(t){return this.updateVisibility(t),Promise.resolve()}get document(){return"string"==typeof this.props?JSON.parse(this.props):this.props}get config(){return $t.getWidget(this.document.type)}updateVisibility(t){var e,i,n;const o=void 0!==(null===(e=this.document.options)||void 0===e?void 0:e.start)?this.document.options.start:0,r=void 0!==(null===(i=this.document.options)||void 0===i?void 0:i.end)?this.document.options.end:this.layoutDuration;!1===(void 0===(null===(n=this.document.options)||void 0===n?void 0:n.visible)||this.document.options.visible)||t<o||t>r?"none"!==this.style.display&&(this.style.display="none",this.style.visibility="hidden"):"block"!==this.style.display&&(this.style.display="block",this.style.visibility="visible")}render(){super.render()}};Ne.styles=[l`
      :host {
        display: block;
        position: absolute;
        user-select: none;
      }

      * {
        position: absolute;
      }
      :host([data-parent-type="flexbox"]) {
        position: relative;
      }

      .locked {
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        height: 20px;
        background-color: black;

        display: flex;
        align-items: center;
        justify-content: center;
      }

      .locked svg {
        width: 16px;
        height: 16px;
        fill: white;
      }
    `,ze],t([pt({type:Object}),e("design:type",Object)],Ne.prototype,"layoutDocument",void 0),t([pt({type:Object}),e("design:type",Object)],Ne.prototype,"parentDocument",void 0),t([pt({type:Object}),e("design:type",Object)],Ne.prototype,"props",void 0),t([pt({type:String}),e("design:type",String)],Ne.prototype,"editingMode",void 0),t([pt({type:String}),e("design:type",String)],Ne.prototype,"playbackMode",void 0),t([pt({type:Boolean}),e("design:type",Number)],Ne.prototype,"zoomFactor",void 0),t([pt({type:Boolean}),e("design:type",Boolean)],Ne.prototype,"selected",void 0),t([pt({type:Number}),e("design:type",Number)],Ne.prototype,"layoutDuration",void 0),t([pt({type:Number}),e("design:type",Object)],Ne.prototype,"currentTimestamp",void 0),t([pt({type:Number}),e("design:type",Object)],Ne.prototype,"frameRate",void 0),Ne=t([ct("base-renderer"),e("design:paramtypes",[])],Ne);class Be{constructor(){this.eventListeners={}}setEventListener(t,e){this.eventListeners[t]=e}registerEventListeners(t){Object.entries(this.eventListeners).forEach(([e,i])=>{t.addEventListener(e,i)})}removeEventListeners(t){Object.entries(this.eventListeners).forEach(([e,i])=>{t.removeEventListener(e,i)})}}function qe(t,e,i){return function(t,e,i){return void 0!==i&&void 0!==Et[t][e][i]}(t,e,i)?Et[t][e][i]:function(t,e){return void 0!==e&&void 0!==Et[t][e]}(t,e)?Et[t][e]:Et[t]||"none"}function je(t,e,i,n,o){var r,s,a,l,d;const c=`${t}${n?`.${n}`:""}${o?`.${o}`:""}`;if(void 0===e)return console.error(`[ERROR] getCurrentValueForProperty: props is undefined for property "${c}" at timestamp ${i}. Stack trace:`,(new Error).stack),qe(t,n,o);if(void 0===e[t])return qe(t,n,o);if(void 0!==e[t]&&!(e[t]instanceof Array))return void 0!==n&&void 0!==e[t][n]?void 0!==o&&void 0!==e[t][n][o]?e[t][n][o]:e[t][n]:e[t];const u=e[t].sort((t,e)=>t.timestamp-e.timestamp);if(0===u.length)return console.error(`[ERROR] getCurrentValueForProperty: No keyframes found for property "${c}" at timestamp ${i}. Props structure:`,JSON.stringify(e,null,2)),qe(t,n,o);if(void 0!==n&&void 0!==u.find(t=>void 0===t.value[n])){const e=u.filter(t=>void 0===t.value[n]);return console.error(`[ERROR] getCurrentValueForProperty: Missing child property "${n}" in keyframes for "${c}" at timestamp ${i}.\n      Missing in ${e.length} keyframe(s) at timestamps: [${e.map(t=>t.timestamp).join(", ")}]\n      Keyframes structure:`,JSON.stringify(u,null,2)),Et[t]||"0"}if(void 0!==o&&void 0!==u.find(t=>void 0===t.value[n][o])){const e=u.filter(t=>void 0===t.value[n][o]);return console.error(`[ERROR] getCurrentValueForProperty: Missing sub-child property "${o}" in keyframes for "${c}" at timestamp ${i}.\n      Missing in ${e.length} keyframe(s) at timestamps: [${e.map(t=>t.timestamp).join(", ")}]\n      Keyframes structure:`,JSON.stringify(u,null,2)),qe(t,n,o)}if(1===u.length)return void 0===(null===(r=null==u?void 0:u[0])||void 0===r?void 0:r.value)?(console.error(`[ERROR] getCurrentValueForProperty: Single keyframe has undefined value for "${c}" at timestamp ${i}. Keyframe:`,JSON.stringify(u[0],null,2)),qe(t,n,o)):n?o?u[0].value[n][o]:u[0].value[n]:u[0].value;const h=function(t,e){for(let i=t.length-1;i>=0;i--)if(t[i].timestamp<=e)return i;return-1}(u,i);if(-1===h)return void 0===(null===(s=null==u?void 0:u[0])||void 0===s?void 0:s.value)?(console.error(`[ERROR] getCurrentValueForProperty: First keyframe has undefined value for "${c}" at timestamp ${i}. Using first keyframe before interpolation. Keyframe:`,JSON.stringify(u[0],null,2)),qe(t,n,o)):n?o?u[0].value[n][o]:u[0].value[n]:u[0].value;const p=function(t,e){for(let i=0;i<t.length;i++)if(t[i].timestamp>e)return i;return-1}(u,i);if(-1===p||p===h)return void 0===(null===(a=null==u?void 0:u[u.length-1])||void 0===a?void 0:a.value)?(console.error(`[ERROR] getCurrentValueForProperty: Last keyframe has undefined value for "${c}" at timestamp ${i}. Using last keyframe (no interpolation needed). Keyframe:`,JSON.stringify(u[u.length-1],null,2)),qe(t,n,o)):n?o?u[u.length-1].value[n][o]:u[u.length-1].value[n]:u[u.length-1].value;const m=function(t,e,i,n="linear"){return t<=e?0:t>=i?1:void 0===St[n]?(console.warn(`[WARN] Could not find easing function ${n}, using linear.`),St.linear(Math.max(0,t-e),0,1,i-e)):St[n||"linear"](Math.max(0,t-e),0,1,i-e)}(i,u[h].timestamp,u[p].timestamp,u[h].easing||"linear");if(void 0===(null===(l=null==u?void 0:u[h])||void 0===l?void 0:l.value))return console.error(`[ERROR] getCurrentValueForProperty: Start keyframe has undefined value for "${c}" at timestamp ${i}. Interpolation failed. Start keyframe (index ${h}):`,JSON.stringify(u[h],null,2)),qe(t,n,o);if(void 0===(null===(d=null==u?void 0:u[p])||void 0===d?void 0:d.value))return console.error(`[ERROR] getCurrentValueForProperty: End keyframe has undefined value for "${c}" at timestamp ${i}. Interpolation failed. End keyframe (index ${p}):`,JSON.stringify(u[p],null,2)),qe(t,n,o);let g=n?o?u[h].value[n][o]:u[h].value[n]:u[h].value,f=n?o?u[p].value[n][o]:u[p].value[n]:u[p].value;if("number"!=typeof g||"number"!=typeof f)return ie(g)&&ie(f)?function(t,e,i){function n(t){if(t.startsWith("#"))return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16)};if(t.startsWith("rgb")){const e=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.?\d*))?\)/);return{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}}return console.warn(`[WARN] Could not parse color ${t}, defaulting to black.`),{r:0,g:0,b:0}}(isNaN(i)||i<0||i>1)&&(console.warn(`[WARN] Invalid interpolation factor ${i}, defaulting to 0.`),i=0);const o=n(t),r=n(e);function s(t,e,i){return Math.round(t+(e-t)*i)}return`rgb(${s(o.r,r.r,i)}, ${s(o.g,r.g,i)}, ${s(o.b,r.b,i)})`}(g,f,m):g;if(isNaN(g)||isNaN(f))return console.warn(`[WARN] getCurrentValueForProperty: Could not parse numerical values for "${c}" at timestamp ${i}. \n      Start value: ${g} (type: ${typeof g}, isNaN: ${isNaN(g)})\n      End value: ${f} (type: ${typeof f}, isNaN: ${isNaN(f)})\n      Completeness: ${m}\n      Using fallback: ${qe(t,n,o)}\n      Start keyframe (index ${h}):`,JSON.stringify(u[h],null,2),`End keyframe (index ${p}):`,JSON.stringify(u[p],null,2)),qe(t,n,o);return g+(f-g)*m}function Ue(t,e){switch(t){case"blur":return`blur(${e||0}px)`;case"brightness":return`brightness(${e||1})`;case"contrast":return`contrast(${e||1})`;case"grayscale":return`grayscale(${e||0})`;case"hueRotate":return`hue-rotate(${e||0}deg)`;case"invert":return`invert(${e||0})`;case"saturate":return`saturate(${e||1})`;case"sepia":return`sepia(${e||0})`;default:return""}}function We(t){if(!t||"object"!=typeof t)return"none";const e=[],i=["blur","brightness","contrast","grayscale","hueRotate","invert","saturate","sepia"];for(const n of i)if(void 0!==t[n]&&null!==t[n]){const i=Ue(n,t[n]);i&&e.push(i)}return e.length>0?e.join(" "):"none"}function Ve(t,e,i,n,o){const r=structuredClone(i);function s(t,e){if(r[t]instanceof Array){const i=r[t].find(t=>t.timestamp===n);if(void 0!==i)return void(i.value+=e);const s=o(t,r,n);return void function(t,e,i,n="linear"){r[t].push({timestamp:e,value:i,easing:n}),r[t].sort((t,e)=>t.timestamp-e.timestamp)}(t,n,s+e)}r[t]=r[t]+e}switch(t){case"top":s("y",e.y),s("height",-e.y);break;case"right":s("width",e.x);break;case"bottom":s("height",e.y);break;case"left":s("x",e.x),s("width",-e.x);break;case"top-left":s("x",e.x),s("y",e.y),s("width",-e.x),s("height",-e.y);break;case"top-right":s("y",e.y),s("width",e.x),s("height",-e.y);break;case"bottom-left":s("x",e.x),s("width",-e.x),s("height",e.y);break;case"bottom-right":s("width",e.x),s("height",e.y)}return r.width instanceof Array?r.width.map(t=>(t.value<1&&(t.value=100),t)):"number"==typeof r.width&&r.width<1&&(r.width=100),r.height instanceof Array?r.height.map(t=>(t.value<1&&(t.value=100),t)):"number"==typeof r.height&&r.height<1&&(r.height=100),r}function He(t,e,i,n){const o=structuredClone(e);function r(t,e){if(o[t]instanceof Array){const r=o[t].find(t=>t.timestamp===i);if(void 0!==r)return void(r.value+=e);const s=n(t,o,i);return void function(t,e,i,n="linear"){o[t].push({timestamp:e,value:i,easing:n}),o[t].sort((t,e)=>t.timestamp-e.timestamp)}(t,i,s+e)}o[t]=o[t]+e}return void 0!==t&&void 0!==t.x&&0!==t.x&&r("x",t.x),void 0!==t&&void 0!==t.y&&0!==t.y&&r("y",t.y),o}class Ge{constructor(t){this.id=-1,this.nativePointer=t,this.pageX=t.pageX,this.pageY=t.pageY,this.clientX=t.clientX,this.clientY=t.clientY,self.Touch&&t instanceof Touch?this.id=t.identifier:Qe(t)&&(this.id=t.pointerId)}getCoalesced(){if("getCoalescedEvents"in this.nativePointer){const t=this.nativePointer.getCoalescedEvents().map(t=>new Ge(t));if(t.length>0)return t}return[this]}}const Qe=t=>"pointerId"in t,Je=t=>"changedTouches"in t,Ze=()=>{};class Ke{constructor(t,{start:e=()=>!0,move:i=Ze,end:n=Ze,rawUpdates:o=!1,avoidPointerEvents:r=!1}={}){this._element=t,this.startPointers=[],this.currentPointers=[],this._excludeFromButtonsCheck=new Set,this._pointerStart=t=>{if(Qe(t)&&0===t.buttons)this._excludeFromButtonsCheck.add(t.pointerId);else if(!(1&t.buttons))return;const e=new Ge(t);if(!this.currentPointers.some(t=>t.id===e.id)&&this._triggerPointerStart(e,t))if(Qe(t)){(t.target&&"setPointerCapture"in t.target?t.target:this._element).setPointerCapture(t.pointerId),this._element.addEventListener(this._rawUpdates?"pointerrawupdate":"pointermove",this._move),this._element.addEventListener("pointerup",this._pointerEnd),this._element.addEventListener("pointercancel",this._pointerEnd)}else window.addEventListener("mousemove",this._move),window.addEventListener("mouseup",this._pointerEnd)},this._touchStart=t=>{for(const e of Array.from(t.changedTouches))this._triggerPointerStart(new Ge(e),t)},this._move=t=>{if(!(Je(t)||Qe(t)&&this._excludeFromButtonsCheck.has(t.pointerId)||0!==t.buttons))return void this._pointerEnd(t);const e=this.currentPointers.slice(),i=Je(t)?Array.from(t.changedTouches).map(t=>new Ge(t)):[new Ge(t)],n=[];for(const t of i){const e=this.currentPointers.findIndex(e=>e.id===t.id);-1!==e&&(n.push(t),this.currentPointers[e]=t)}0!==n.length&&this._moveCallback(e,n,t)},this._triggerPointerEnd=(t,e)=>{if(!Je(e)&&1&e.buttons)return!1;const i=this.currentPointers.findIndex(e=>e.id===t.id);if(-1===i)return!1;this.currentPointers.splice(i,1),this.startPointers.splice(i,1),this._excludeFromButtonsCheck.delete(t.id);const n=!("mouseup"===e.type||"touchend"===e.type||"pointerup"===e.type);return this._endCallback(t,e,n),!0},this._pointerEnd=t=>{if(this._triggerPointerEnd(new Ge(t),t))if(Qe(t)){if(this.currentPointers.length)return;this._element.removeEventListener(this._rawUpdates?"pointerrawupdate":"pointermove",this._move),this._element.removeEventListener("pointerup",this._pointerEnd),this._element.removeEventListener("pointercancel",this._pointerEnd)}else window.removeEventListener("mousemove",this._move),window.removeEventListener("mouseup",this._pointerEnd)},this._touchEnd=t=>{for(const e of Array.from(t.changedTouches))this._triggerPointerEnd(new Ge(e),t)},this._startCallback=e,this._moveCallback=i,this._endCallback=n,this._rawUpdates=o&&"onpointerrawupdate"in window,self.PointerEvent&&!r?this._element.addEventListener("pointerdown",this._pointerStart):(this._element.addEventListener("mousedown",this._pointerStart),this._element.addEventListener("touchstart",this._touchStart),this._element.addEventListener("touchmove",this._move),this._element.addEventListener("touchend",this._touchEnd),this._element.addEventListener("touchcancel",this._touchEnd))}stop(){this._element.removeEventListener("pointerdown",this._pointerStart),this._element.removeEventListener("mousedown",this._pointerStart),this._element.removeEventListener("touchstart",this._touchStart),this._element.removeEventListener("touchmove",this._move),this._element.removeEventListener("touchend",this._touchEnd),this._element.removeEventListener("touchcancel",this._touchEnd),this._element.removeEventListener(this._rawUpdates?"pointerrawupdate":"pointermove",this._move),this._element.removeEventListener("pointerup",this._pointerEnd),this._element.removeEventListener("pointercancel",this._pointerEnd),window.removeEventListener("mousemove",this._move),window.removeEventListener("mouseup",this._pointerEnd)}_triggerPointerStart(t,e){return!!this._startCallback(t,e)&&(this.currentPointers.push(t),this.startPointers.push(t),!0)}}class Ye{constructor(t,e,i,n,o,r){this.element=t,this.document=e,this.layoutDocument=i,this.parentDocument=n,this.currentTimestamp=o,this.options=r,this.isDragging=!1,this.hasMoved=!1,this.accumulatedMovement={x:0,y:0},this.animationFrameId=null,this.pointerTracker=null}addDragHandle(){var t;if("false"===this.element.editingMode)return;if(null===(t=this.element.document.options)||void 0===t?void 0:t.locked)return;const e=document.createElement("div");e.classList.add("drag-handle"),!1===this.options.isDraggable&&e.classList.add("disabled"),this.element.setAttribute("draggable","false"),this.pointerTracker=new Ke(e,{start:(t,i)=>{if(!1!==this.options.isDraggable)return this.hasMoved=!1,this.isDragging=!0,e.classList.add("active"),document.body.style.userSelect="none",this.accumulatedMovement={x:0,y:0},this.startAnimationLoop(),!0},move:(t,e,i)=>{if(!1===this.options.isDraggable)return;if(!this.isDragging)return;const n=e[0],o=t.find(t=>t.id===n.id);if(o){const t=n.clientX-o.clientX,e=n.clientY-o.clientY;this.accumulatedMovement.x+=t,this.accumulatedMovement.y+=e,this.hasMoved=!0}},end:(t,i)=>{!1!==this.options.isDraggable&&this.isDragging&&this.stopDragging(e)}}),this.element.shadowRoot.querySelectorAll(".drag-handle").forEach(t=>{t.remove()}),this.element.shadowRoot.appendChild(e),this.dragHandle=e}removeDragHandle(){this.element.shadowRoot.querySelectorAll(".drag-handle").forEach(t=>{t.remove()})}startAnimationLoop(){if("false"===this.element.editingMode)return;const t=()=>{var e,i,n,o;if(!this.isDragging)return;const r=null===(e=this.layoutDocument.options)||void 0===e?void 0:e.snapTo,s=null===(i=this.layoutDocument.options)||void 0===i?void 0:i.grid,a=null!==(o=null===(n=window.visualViewport)||void 0===n?void 0:n.scale)&&void 0!==o?o:1,l=this.zoomFactor;let d=this.accumulatedMovement.x/(a*l),c=this.accumulatedMovement.y/(a*l);if("grid"===r&&s&&s.visible){const t=.05*s.size,e=parseInt(this.element.style.left||"0",10),i=parseInt(this.element.style.top||"0",10),n=e+d,o=i+c,r=Math.round(n/s.size)*s.size,a=Math.round(o/s.size)*s.size;Math.abs(n-r)<=t&&(d=r-e),Math.abs(o-a)<=t&&(c=a-i)}if("element"===r){const t=this.parentDocument.children,e=30,i=parseInt(this.element.style.left||"0",10),n=parseInt(this.element.style.top||"0",10),o=parseInt(this.element.style.width||"0",10),r=parseInt(this.element.style.height||"0",10),s=i+o,a=n+r,l=Array.from(t).filter(t=>{if(!t.props||t.id===this.document.id)return!1;const e=je("x",t.props,this.currentTimestamp),o=je("y",t.props,this.currentTimestamp),r=je("width",t.props,this.currentTimestamp),l=je("height",t.props,this.currentTimestamp);return a>o&&n<o+l||s>e&&i<e+r});if(l.length>0){let t={side:null,distance:1/0,position:null};l.forEach(l=>{const d=je("x",l.props,this.currentTimestamp),c=je("y",l.props,this.currentTimestamp),u=d+je("width",l.props,this.currentTimestamp),h=c+je("height",l.props,this.currentTimestamp);if(a>c&&n<h){const n=Math.abs(i-u);n<=e&&n<t.distance&&(t={side:"left",distance:n,position:u});const r=Math.abs(s-d);r<=e&&r<t.distance&&"left"!==t.side&&(t={side:"right",distance:r,position:d-o})}if(s>d&&i<u){const i=Math.abs(n-h);i<=e&&i<t.distance&&(t={side:"top",distance:i,position:h});const o=Math.abs(a-c);o<=e&&o<t.distance&&"top"!==t.side&&(t={side:"bottom",distance:o,position:c-r})}}),"left"===t.side||"right"===t.side?d=t.position-i:("top"===t.side||"bottom"===t.side)&&(c=t.position-n)}}if(this.accumulatedMovement.x=0,this.accumulatedMovement.y=0,0!==d||0!==c){const t=this.element.style.left||"0",e=this.element.style.top||"0";this.element.style.left=`${parseInt(t,10)+d}px`,this.element.style.top=`${parseInt(e,10)+c}px`,this.element.document.props=He({x:d,y:c},this.element.document.props,this.element.currentTimestamp,je),this.element.requestUpdate()}this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}stopDragging(t){"false"!==this.element.editingMode&&(this.isDragging=!1,this.pointerTracker=null,t.classList.remove("active"),document.body.style.userSelect="",this.hasMoved?this.element.dispatchEvent(new CustomEvent("dimensions-changed",{detail:{element:this.element},bubbles:!0,composed:!0})):this.element.dispatchEvent(new CustomEvent("selection-change",{detail:{element:this.element},bubbles:!0,composed:!0})),null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null))}}class Xe{constructor(t,e){this.element=t,this.options=e,this.resizeHandles={},this.resizeBubbles=[]}addResizeHandles(){var t,e,i;if("false"===this.element.editingMode)return;const n=null===(e=null===(t=this.element.config)||void 0===t?void 0:t.settings)||void 0===e?void 0:e.props,{resizeHandles:o,resizeBubbles:r}=((t,{height:e,width:i}={height:!0,width:!0},{locked:n}={locked:!1})=>{const o={top:document.createElement("div"),right:document.createElement("div"),bottom:document.createElement("div"),left:document.createElement("div")},r={"top-left":document.createElement("div"),"top-right":document.createElement("div"),"bottom-left":document.createElement("div"),"bottom-right":document.createElement("div")};return n||(Object.entries(o).forEach(([n,o])=>{o.classList.add("resize-handle","resize-handle-"+n),(e||"top"!==n&&"bottom"!==n)&&(i||"left"!==n&&"right"!==n)?o.addEventListener("mousedown",e=>t(e,n)):o.classList.add("disabled")}),Object.entries(r).forEach(([n,o])=>{o.classList.add("resize-bubble","resize-bubble-"+n),e&&i?o.addEventListener("mousedown",e=>t(e,n)):o.classList.add("disabled")})),{resizeHandles:o,resizeBubbles:r}})(this.startResize.bind(this),{width:!1!==(null==n?void 0:n.height)&&this.options.isResizable,height:!1!==(null==n?void 0:n.width)&&this.options.isResizable},{locked:null===(i=this.element.document.options)||void 0===i?void 0:i.locked});this.element.shadowRoot.querySelectorAll(".resize-handle, .resize-bubble").forEach(t=>{t.remove()}),Object.entries(o).forEach(([t,e])=>{this.element.shadowRoot.appendChild(e),this.resizeHandles[t]=e}),Object.values(r).forEach(t=>{this.element.shadowRoot.appendChild(t),this.resizeBubbles.push(t)})}removeResizeHandles(){"false"!==this.element.editingMode&&(this.element.shadowRoot.querySelectorAll(".resize-handle, .resize-bubble").forEach(t=>{t.remove()}),Object.values(this.resizeHandles).forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),this.resizeHandles={},this.resizeBubbles.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),this.resizeBubbles=[])}startResize(t,e){var i,n;if("false"===this.element.editingMode)return;if(t.preventDefault(),!1===this.options.isResizable)return;const o=null!==(n=null===(i=window.visualViewport)||void 0===i?void 0:i.scale)&&void 0!==n?n:1,r=t=>{let i=t.movementX/(o*this.zoomFactor),n=t.movementY/(o*this.zoomFactor);this.element.document.props=Ve(e,{x:i,y:n},this.element.document.props,this.element.currentTimestamp,je),this.element.requestUpdate()},s=()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s),this.element.dispatchEvent(new CustomEvent("dimensions-changed",{detail:{element:this.element},bubbles:!0,composed:!0}))};window.addEventListener("mousemove",r),window.addEventListener("mouseup",s)}}const ti=t=>class extends t{constructor(){super(...arguments),this.eventListenerManager=new Be}connectedCallback(){super.connectedCallback(),"false"!==this.editingMode&&(this.eventListenerManager.setEventListener("click",this.handleClick.bind(this)),this.eventListenerManager.setEventListener("contextmenu",this.handleContextMenu.bind(this)),this.eventListenerManager.registerEventListeners(this))}disconnectedCallback(){super.disconnectedCallback(),"false"!==this.editingMode&&this.eventListenerManager.removeEventListeners(this)}handleClick(t){this.dragManager||"false"===this.editingMode||this.dispatchEvent(new CustomEvent("selection-change",{detail:{...t,element:this},bubbles:!0,composed:!0}))}handleContextMenu(t){"false"!==this.editingMode&&this.dispatchEvent(new CustomEvent("open-context-menu",{detail:{...t,element:this},bubbles:!0,composed:!0}))}updated(t){var e;if(super.updated(t),"false"!==this.editingMode&&(t.has("zoomFactor")&&(this.resizeManager&&(this.resizeManager.zoomFactor=this.zoomFactor),this.dragManager&&(this.dragManager.zoomFactor=this.zoomFactor)),t.has("props")||t.has("selected"))){const t=void 0!==(null===(e=this.document.options)||void 0===e?void 0:e.locked)&&this.document.options.locked,i=this.editingMode&&("true"===this.editingMode||"layout"===this.editingMode);if(t)this.resizeManager&&this.resizeManager.removeResizeHandles(),this.dragManager&&this.dragManager.removeDragHandle();else{const t="boolean"==typeof this.selected&&this.selected;this.ariaSelected=String(t),t&&(this.resizeManager=new Xe(this,{isResizable:i}),this.resizeManager.zoomFactor=this.zoomFactor,this.resizeManager.addResizeHandles(),this.dragManager=new Ye(this,this.document,this.layoutDocument,this.parentDocument,this.currentTimestamp,{isDraggable:i}),this.dragManager.zoomFactor=this.zoomFactor,this.dragManager.addDragHandle())}}}render(){var t;if(super.render(),"false"===this.editingMode)return;const e=void 0!==(null===(t=this.document.options)||void 0===t?void 0:t.locked)&&this.document.options.locked,i=this.editingMode&&"false"===this.editingMode&&!e;this.style.cursor=i?"pointer":"default"}};let ei=class extends Ne{constructor(){super(),this.isPlaying=!1,this.hasAnimations=!1}connectedCallback(){super.connectedCallback(),this.applyStyles(this.currentTimestamp)}disconnectedCallback(){super.disconnectedCallback()}updated(t){if(super.updated(t),t.has("currentTimestamp")){const t=1e3/this.frameRate;this.currentTimestamp>t&&(this.hasAnimations=!1)}}play(){var t;super.play(),this.isPlaying=!0,"false"===this.editingMode&&(this.hasAnimations||(this.applyStyles(this.currentTimestamp),this.buildAnimations(),this.hasAnimations=!0),this.getAnimations().forEach(t=>{t.play()}),null===(t=this.contentWrapper)||void 0===t||t.getAnimations().forEach(t=>{t.play()}))}pause(){var t;super.pause(),this.isPlaying=!1,this.getAnimations().forEach(t=>{t.pause()}),null===(t=this.contentWrapper)||void 0===t||t.getAnimations().forEach(t=>{t.pause()})}stop(){var t;super.stop(),this.isPlaying=!1,this.hasAnimations=!1,this.getAnimations().forEach(t=>{t.cancel()}),null===(t=this.contentWrapper)||void 0===t||t.getAnimations().forEach(t=>{t.cancel()})}async renderFrame(t){return await super.renderFrame(t),new Promise(e=>{this.applyStyles(t),requestAnimationFrame(()=>{e()})})}applyStyles(t,e=0){var i,n,o,r,s;if(e>=1e3)return void console.error("[FATAL ERROR] AnimatedRenderer: applyStyles: contentWrapper unavailable after 1000 retries",{widgetType:null===(i=null==this?void 0:this.document)||void 0===i?void 0:i.type,retries:e,timestamp:t});if(void 0===this.contentWrapper||null===this.contentWrapper||e>10)return requestAnimationFrame(()=>{this.currentTimestamp===t&&this.applyStyles(t,e+1)}),void(e>=100&&e%100==0&&console.warn(`[WARNING] AnimatedRenderer: applyStyles: contentWrapper still unavailable after ${e} retries`,{widgetType:null===(n=null==this?void 0:this.document)||void 0===n?void 0:n.type,retries:e,timestamp:t}));if(!this.document||!this.document.props)return void console.error("[AnimatedRenderer] Missing document or props in applyStyles",this.document);const a=Object.keys(this.document.props),l="flexbox"===(null===(o=this.parentDocument)||void 0===o?void 0:o.type);if(l&&(this.style.position="relative"),l?(this.style.left="",this.style.top=""):(a.includes("x")&&(this.style.left=String(je("x",this.document.props,t))+"px"),a.includes("y")&&(this.style.top=String(je("y",this.document.props,t))+"px")),a.includes("width")&&(this.style.width=String(je("width",this.document.props,t))+"px"),a.includes("height")&&(this.style.height=String(je("height",this.document.props,t))+"px"),a.includes("transform")){const e=Object.keys(this.document.props.transform);if(e.includes("skew")&&(this.style.transform=`skew(${String(je("skew",this.document.props.transform,t,"x"))||String(wt.transform.skew)}deg, ${String(je("skew",this.document.props.transform,t,"y"))||String(wt.transform.skew)}deg)`),e.includes("scale")&&(this.style.scale=`${String(parseFloat(je("scale",this.document.props.transform,t,"x"))/100)||String(wt.transform.scale.x/100)} ${String(parseFloat(je("scale",this.document.props.transform,t,"y"))/100)||String(wt.transform.scale.y/100)}`),e.includes("rotate")&&(this.style.rotate=(String(je("rotate",this.document.props.transform,t))||String(wt.transform.rotate))+"deg"),a.includes("clip")){const e=je("clip",this.document.props,t,"top"),i=je("clip",this.document.props,t,"right"),n=je("clip",this.document.props,t,"bottom"),o=je("clip",this.document.props,t,"left");void 0!==this.contentWrapper&&null!==this.contentWrapper&&(this.contentWrapper.style.clipPath=`inset(${null!=e?e:0}px ${null!=i?i:0}px ${null!=n?n:0}px ${null!=o?o:0}px)`)}}a.includes("background")&&void 0!==this.contentWrapper&&null!==this.contentWrapper&&(this.contentWrapper.style.background=String(je("background",this.document.props,t))||wt.background);try{a.includes("border")&&this.setBorder(this.document.props.border,t)}catch(t){console.error(`[ERROR] Could not set border for ${null===(r=this.document)||void 0===r?void 0:r.name}`,t,this.document)}if(a.includes("opacity")){const e=je("opacity",this.document.props,t);void 0!==this.contentWrapper&&null!==this.contentWrapper&&(this.contentWrapper.style.opacity=String(e)||String(wt.opacity))}try{a.includes("filters")&&this.setFilters(this.document.props.filters,t)}catch(t){console.error(`[ERROR] Could not set filters for ${null===(s=this.document)||void 0===s?void 0:s.name}`,t,this.document)}}buildAnimations(t=0){var e,i;if(void 0===this.document)return void console.warn("[WARNING] document is undefined, can not build animations for element.");if(void 0===this.contentWrapper||null===this.contentWrapper||t>10)return void requestAnimationFrame(()=>{this.buildAnimations(t+1)});const n=void 0!==(null===(e=this.document.options)||void 0===e?void 0:e.start)?this.document.options.start:0,o=void 0!==(null===(i=this.document.options)||void 0===i?void 0:i.end)?this.document.options.end:this.layoutDuration,r=o-n,s=(t,e,i)=>{var n,o;if(void 0===e[t]||!(e[t]instanceof Array))return;if(0===e[t].length)return;if(1===e[t].length)return;if(!xt.includes(t))return void console.warn(`[WARN] Unknown property ${t} for ${this.document.name}.`);const s=function(t){switch(t){case"skew":return"transform";case"x":return"left";case"y":return"top";case"lineStyle":return"borderStyle";case"lineColor":return"borderColor";case"lineWidth":return"borderWidth";case"radius":return"borderRadius";default:return t}}(t),a=function(t){switch(t){case"x":case"y":case"lineWidth":case"radius":case"width":case"height":return"px";case"rotate":case"skew":return"deg";default:return""}}(t);let l=[];const d=(t,e,i="linear")=>{t<0||t>r||l.push({offset:t/r,[s]:e,easing:i})},c=i=>{let n="";if(i.value instanceof Object){"skew"===t&&(n+="skew(");const o=Object.keys(i.value);return["x","y","z","top","right","bottom","left"].some(t=>o.includes(t))?(o.sort().forEach((r,s)=>{let l=je(t,e,i.timestamp,r)||Et[t];"scale"===t&&(l=parseFloat(l)/100),n+=`${String(l)}${a}${"skew"===t&&s!==o.length-1?", ":" "}`}),"skew"===t&&(n+=")"),n):(console.error(`[ERROR] Unknown property ${t} for ${this.document.name}. Returning default.`),`${String(Et[t]||"0")}${a}`)}return`${String(je(t,e,i.timestamp))||Et[t]}${a}`};void 0===e[t].find(t=>0===t.timestamp)&&d(0,c(e[t][0]),(null===(n=e[t][0])||void 0===n?void 0:n.easing)||"linear"),e[t].forEach(t=>d(t.timestamp,c(t),t.easing||"linear")),void 0===e[t].find(t=>t.timestamp===r)&&d(r,c(e[t][e[t].length-1]),(null===(o=e[t][e[t].length-1])||void 0===o?void 0:o.easing)||"linear");try{"background"===t||"border"===t||"clip"===t||"opacity"===t?this.contentWrapper.animate(l,{duration:r,iterations:1/0,delay:-Math.max(0,this.currentTimestamp)}):i.animate(l,{duration:r,iterations:1/0,delay:-Math.max(0,this.currentTimestamp)})}catch(t){console.error(`[ERROR] Could not build animations for ${this.document.name}`,t)}};Object.keys(this.document.props).forEach(t=>{if("border"!==t){if("clip"!==t)if("transform"!==t){if("filters"!==t)s(t,this.document.props,"background"===t||"clip"===t||"opacity"===t?this.contentWrapper:this);else if(this.document.props.filters instanceof Array){const t=o-n,e=[];this.document.props.filters.forEach(i=>{const n=We(i.value);e.push({offset:i.timestamp/t,filter:n,easing:i.easing||"linear"})});try{this.contentWrapper.animate(e,{duration:t,iterations:1/0,delay:-Math.max(0,this.currentTimestamp)})}catch(t){console.error(`[ERROR] Could not build filter animations for ${this.document.name}`,t)}}}else Object.keys(this.document.props.transform).forEach(t=>{s(t,this.document.props.transform,"scale"===t?this.contentWrapper:this)});else if(this.document.props.clip instanceof Array){const t={top:[],right:[],bottom:[],left:[]};this.document.props.clip.forEach(e=>{Object.keys(e.value).forEach(i=>{t[i].push({timestamp:e.timestamp,value:e.value[i],easing:e.easing||"linear"})})});const e=o-n,i=[];this.document.props.clip.forEach(t=>{const n=je("clip",this.document.props,t.timestamp,"top"),o=je("clip",this.document.props,t.timestamp,"right"),r=je("clip",this.document.props,t.timestamp,"bottom"),s=je("clip",this.document.props,t.timestamp,"left");i.push({offset:t.timestamp/e,clipPath:`inset(${null!=n?n:0}px ${null!=o?o:0}px ${null!=r?r:0}px ${null!=s?s:0}px)`,easing:t.easing||"linear"})});try{this.contentWrapper.animate(i,{duration:e,iterations:1/0,delay:-Math.max(0,this.currentTimestamp)})}catch(t){console.error(`[ERROR] Could not build animations for ${this.document.name}`,t)}}}else if(this.document.props.border instanceof Array){const t={lineStyle:[],lineColor:[],lineWidth:[],radius:[]};this.document.props.border.forEach(e=>{Object.keys(e.value).forEach(i=>{t[i].push({timestamp:e.timestamp,value:e.value[i],easing:e.easing||"linear"})})}),Object.keys(t).forEach(e=>s(e,t,this.contentWrapper))}})}setBorder(t,e,i=0){if(i>10)console.warn("[WARNING] contentWrapper is undefined, can not apply border to element.");else if(void 0!==this.contentWrapper&&null!==this.contentWrapper){if(t instanceof Array){this.contentWrapper.style.borderWidth="0",this.contentWrapper.style.borderStyle=String(je("border",this.document.props,e,"lineStyle"))||wt.border.lineStyle,this.contentWrapper.style.borderColor=String(je("border",this.document.props,e,"lineColor"))||wt.border.lineColor;const t=je("border",this.document.props,e,"lineWidth");return this.contentWrapper.style.borderWidth=`${t}px`,void(this.contentWrapper.style.borderRadius=(String(je("border",this.document.props,e,"radius"))||wt.border.radius)+"px")}if(t instanceof Object){const i=Object.keys(t);i.includes("lineStyle")&&(this.contentWrapper.style.borderStyle=t.lineStyle||wt.border.lineStyle),i.includes("lineColor")&&(this.contentWrapper.style.borderColor=String(je("lineColor",t,e))||wt.border.lineColor),i.includes("lineWidth")&&(t.lineWidth instanceof Object?Object.keys(t.lineWidth).forEach(i=>{const n=je("lineWidth",t,e,i);this.contentWrapper.style[`border${i.charAt(0).toUpperCase()+i.slice(1)}Width`]=`${n}px`}):this.contentWrapper.style.borderWidth=String(je("lineWidth",t,e))+"px"),i.includes("radius")&&(this.contentWrapper.style.borderRadius=(String(je("radius",t,e))||wt.border.radius)+"px")}}else requestAnimationFrame(()=>{this.setBorder(t,e,i+1)})}setFilters(t,e,i=0){if(i>10)console.warn("[WARNING] contentWrapper is undefined, can not apply filters to element.");else if(void 0!==this.contentWrapper&&null!==this.contentWrapper){if(t instanceof Array){const t=We(je("filters",this.document.props,e));return void(this.contentWrapper.style.filter=t)}if(t instanceof Object){const e=We(t);this.contentWrapper.style.filter=e}}else requestAnimationFrame(()=>{this.setFilters(t,e,i+1)})}render(){super.render(),void 0!==this.document&&(this.document.props?"false"!==this.editingMode&&this.applyStyles(this.currentTimestamp):console.warn("[WARN] No props found for",this.document))}};function ii(t){return W`<div class="widget-content-wrapper" style="width: 100%; height: 100%; box-sizing: border-box;">${t}</div>`}ei.styles=[...Ne.styles],t([gt(".widget-content-wrapper"),e("design:type",HTMLDivElement)],ei.prototype,"contentWrapper",void 0),ei=t([ct("animated-renderer"),e("design:paramtypes",[])],ei);let ni=class extends(ti(ei)){constructor(){super(...arguments),this.muted=!0,this.videoPlaying=!1,this.hasPlayedOnce=!1,this.boundOnTimeUpdate=this.onTimeUpdate.bind(this),this.boundHandleKeydown=this.handleKeydown.bind(this)}connectedCallback(){super.connectedCallback(),ue().then(t=>{this.updateMuted(!t)})}disconnectedCallback(){super.disconnectedCallback(),this.videoElement&&(this.videoElement.pause(),this.videoElement.removeEventListener("timeupdate",this.boundOnTimeUpdate),this.videoElement.removeEventListener("keydown",this.boundHandleKeydown),this.videoElement.src="",this.videoElement.load())}firstUpdated(t){super.firstUpdated(t),this.displayFirstFrame(),this.setupVideoElement(),this.videoElement&&(this.videoElement.addEventListener("timeupdate",this.boundOnTimeUpdate),this.videoElement.addEventListener("keydown",this.boundHandleKeydown))}setupVideoElement(){var t,e,i,n,o,r,s;const a=me(this.document);if(a&&this.videoElement){this.videoElement.pause(),this.videoElement.src=a;const l=ge(this.document),d=(null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e["mark-out"])&&0!==(null===(n=null===(i=this.document)||void 0===i?void 0:i.content)||void 0===n?void 0:n["mark-out"]);this.videoElement.loop=!("loop"===l&&d),this.videoElement.muted=this.muted,this.videoElement.volume=null!==(s=null===(r=null===(o=this.document)||void 0===o?void 0:o.content)||void 0===r?void 0:r.volume)&&void 0!==s?s:1,this.videoElement.preload="auto",this.videoElement.playsInline=!0,this.videoElement.controls=!1,this.videoElement.autoplay=!1}else console.error("[ERROR] No video source provided or video element not available")}updated(t){var e,i,n,o,r,s,a,l,d,c,u,h,p,m;if(super.updated(t),!0===this.muted&&ue().then(t=>{this.updateMuted(!t)}),t.has("document")&&this.videoElement&&(this.videoElement.volume=null!==(n=null===(i=null===(e=this.document)||void 0===e?void 0:e.content)||void 0===i?void 0:i.volume)&&void 0!==n?n:1),t.has("document")&&(this.setupVideoElement(),!1===this.isPlaying&&!1===this.videoPlaying&&this.updateVideoFrame()),t.has("currentTimestamp")){const t=ve(this.document,null===(o=this.document)||void 0===o?void 0:o.content,this.currentTimestamp);if(!1===this.isPlaying&&!1===this.videoPlaying)return void this.displayFrameAt(t);const e=ge(this.document);if(0===(null===(s=null===(r=this.layoutDocument)||void 0===r?void 0:r.options)||void 0===s?void 0:s.duration)&&"once"===e&&this.hasPlayedOnce)return;if(!this.videoElement)return;if("solitary"===e)return;const i=Ae(null===(a=this.document)||void 0===a?void 0:a.content,null===(l=this.document.options)||void 0===l?void 0:l.start,null===(d=this.document.options)||void 0===d?void 0:d.end),n=ye(null===(c=this.document)||void 0===c?void 0:c.content);if("loop"===e&&this.videoElement&&this.videoPlaying){const t=fe(this.document,this.currentTimestamp);if(i&&0!==i&&"0"!==i){if(t>=i-n){const t=1e3*(null===(u=this.videoElement)||void 0===u?void 0:u.currentTime);t&&0!==t&&"0"!==t&&(t<=n||t>=i)&&this.displayFirstFrame()}}}"once"===e&&this.videoElement&&this.videoPlaying&&t>=(null!=i?i:0)&&(this.hasPlayedOnce=!0,this.videoPause(),this.displayLastFrame()),this.currentTimestamp<1e3/(null!==(h=this.frameRate)&&void 0!==h?h:30)&&this.videoElement.currentTime>0&&this.displayFrameAt(t);const g=null===(p=this.document.options)||void 0===p?void 0:p.start,f=null===(m=this.document.options)||void 0===m?void 0:m.end;void 0!==g&&this.currentTimestamp<g&&this.videoStop(),void 0!==f&&this.currentTimestamp>f&&this.videoStop(),!0===this.isPlaying&&!1===this.videoPlaying&&this.currentTimestamp>=g&&this.currentTimestamp<=f&&this.videoPlay()}}play(){super.play(),this.videoPlay()}pause(){super.pause(),this.videoPause()}stop(){super.stop(),this.videoStop()}async renderFrame(t){var e;if(await super.renderFrame(t),!this.videoElement)return console.error("[ERROR] Video element is not available"),Promise.resolve();if("step"!==this.playbackMode)return Promise.resolve();const i=ve(this.document,null===(e=this.document)||void 0===e?void 0:e.content,t)/1e3;return new Promise((t,e)=>{const n=setTimeout(()=>{var t;null===(t=this.videoElement)||void 0===t||t.removeEventListener("seeked",o),console.error("[ERROR] Seek operation timed out."),e(new Error("Seek operation timed out"))},5e3);function o(){var e;clearTimeout(n),null===(e=this.videoElement)||void 0===e||e.removeEventListener("seeked",o),t()}this.videoElement.addEventListener("seeked",o),this.videoElement.currentTime=i})}videoPlay(){var t,e,i,n,o,r,s,a,l,d;if(null===this.videoElement||void 0===this.videoElement)return;if("once"===ge(this.document)&&this.hasPlayedOnce&&0===(null===(e=null===(t=this.layoutDocument)||void 0===t?void 0:t.options)||void 0===e?void 0:e.duration))return;const c=fe(this.document,this.currentTimestamp);if(c<0)return;if(c>(null!==(n=null===(i=this.document.options)||void 0===i?void 0:i.end)&&void 0!==n?n:0)-(null!==(r=null===(o=this.document.options)||void 0===o?void 0:o.start)&&void 0!==r?r:0))return;const u=ve(this.document,null===(s=this.document)||void 0===s?void 0:s.content,this.currentTimestamp),h=Ae(null===(a=this.document)||void 0===a?void 0:a.content,null===(l=this.document.options)||void 0===l?void 0:l.start,null===(d=this.document.options)||void 0===d?void 0:d.end);"once"===ge(this.document)&&u>=h?this.hasPlayedOnce=!0:(this.videoPlaying=!0,this.videoElement.play().catch(t=>{this.videoPlaying=!1,console.error("[ERROR] Play error on video element.",this.document.name,t)}))}videoPause(){this.videoPlaying=!1,this.videoElement&&this.videoElement.pause()}videoStop(){this.videoPlaying=!1,this.displayFirstFrame(),this.videoElement&&this.videoElement.pause()}displayFrameAt(t){var e,i;let n="number"==typeof t?t:parseInt(t);if(!this.videoElement)return requestAnimationFrame(()=>{!1===this.isPlaying&&!1===this.videoPlaying&&this.displayFrameAt(t)});const o=pe(n/1e3);if(this.videoElement.currentTime===o)return;const r=null===(e=this.document.options)||void 0===e?void 0:e.start,s=null===(i=this.document.options)||void 0===i?void 0:i.end;this.videoPlaying&&(void 0!==r&&this.currentTimestamp<r||void 0!==s&&this.currentTimestamp>s)||("function"==typeof this.videoElement.fastSeek?this.videoElement.fastSeek(o):this.videoElement.currentTime=o)}displayFirstFrame(){var t;const e=ye(null===(t=this.document)||void 0===t?void 0:t.content);this.displayFrameAt(e)}displayLastFrame(){var t,e,i;const n=Ae(null===(t=this.document)||void 0===t?void 0:t.content,null===(e=this.document.options)||void 0===e?void 0:e.start,null===(i=this.document.options)||void 0===i?void 0:i.end);this.displayFrameAt(n)}updateVideoFrame(){var t,e,i,n;const o=ve(this.document,null===(t=this.document)||void 0===t?void 0:t.content,this.currentTimestamp),r=Ae(null===(e=this.document)||void 0===e?void 0:e.content,null===(i=this.document.options)||void 0===i?void 0:i.start,null===(n=this.document.options)||void 0===n?void 0:n.end),s=ge(this.document);"once"===s&&o>r&&(this.hasPlayedOnce=!0,this.displayLastFrame()),"loop"!==s&&"solitary"!==s||this.displayFrameAt(o)}handleKeydown(t){t.preventDefault(),t.stopPropagation()}onTimeUpdate(){var t;if(!this.isPlaying)return;const e=performance.now();this.lastTimeUpdateCall&&e-this.lastTimeUpdateCall<16||(this.lastTimeUpdateCall=e,this.currentTimestamp<1e3/(null!==(t=this.frameRate)&&void 0!==t?t:30)&&"solitary"!==ge(this.document)&&this.videoPlaying&&(this.videoStop(),this.displayFirstFrame(),requestAnimationFrame(()=>{this.videoPlay()})))}updateMuted(t){this.muted=t,this.videoElement&&(this.videoElement.muted=t)}render(){return super.render(),ii(W`<video
      preload="auto"
      tabindex="-1"
      .src=${me(this.document)}
      .autoplay=${!1}
      .loop=${!0}
      .controls=${!1}
      .playsInline=${!0}
    ></video>`)}};function oi(i){class n extends i{constructor(){super(...arguments),this.variableSubscriptions=new Map,this.subscribedVariables=new Set}connectedCallback(){super.connectedCallback(),this.setupVariableSubscriptions()}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribeFromAllVariables()}subscribeToVariable(t,e){if(!this.dataLayerManager)return console.warn(`[WARNING] DataLayerMixin: DataLayerManager not available, cannot subscribe to ${t}`),()=>{};if(this.subscribedVariables.has(t))return console.warn(`[WARNING] DataLayerMixin: Already subscribed to variable ${t}`),this.variableSubscriptions.get(t)||(()=>{});const i=this.dataLayerManager.subscribe((i,n)=>{if(i===t)try{e(n)}catch(e){console.error(`[ERROR] DataLayerMixin: Error in callback for variable ${t}:`,e)}});return this.variableSubscriptions.set(t,i),this.subscribedVariables.add(t),i}subscribeToVariables(t){const e=t.map(({variableId:t,callback:e})=>this.subscribeToVariable(t,e));return()=>{e.forEach(t=>t())}}subscribeToVariablesAndRerender(t){const e=t.map(t=>({variableId:t,callback:t=>{this.requestUpdate()}}));return this.subscribeToVariables(e)}unsubscribeFromVariable(t){const e=this.variableSubscriptions.get(t);e&&(e(),this.variableSubscriptions.delete(t),this.subscribedVariables.delete(t))}getVariableValue(t,e){return this.dataLayerManager?this.dataLayerManager.getValue(t,e):(console.warn(`[WARNING] DataLayerMixin: DataLayerManager not available, returning fallback for ${t}`),e)}resolveValue(t){return this.isVariableReference(t)?this.getVariableValue(t.variableId,t.fallback):t}subscribeToValue(t,e){if(this.isVariableReference(t))return this.subscribeToVariable(t.variableId,i=>{e(i||t.fallback)}),this.getVariableValue(t.variableId,t.fallback);{const i=t;return e(i),i}}createReactiveGetter(t,e){return this.subscribeToVariable(t,()=>{this.requestUpdate()}),()=>this.getVariableValue(t,e)}isVariableReference(t){return t&&"object"==typeof t&&"variableId"in t&&"string"==typeof t.variableId}setupVariableSubscriptions(){}unsubscribeFromAllVariables(){this.variableSubscriptions.forEach((t,e)=>{t()}),this.variableSubscriptions.clear(),this.subscribedVariables.clear()}getSubscribedVariables(){return Array.from(this.subscribedVariables)}isSubscribedTo(t){return this.subscribedVariables.has(t)}}return t([pt({type:Object}),e("design:type",Le)],n.prototype,"dataLayerManager",void 0),n}ni.styles=[...Ne.styles,l`
      :host {
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: transparent;
      }

      video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background-color: transparent;
      }
    `],t([gt("video"),e("design:type",HTMLVideoElement)],ni.prototype,"videoElement",void 0),ni=t([ct("video-renderer")],ni);const ri=1,si=2,ai=t=>(...e)=>({_$litDirective$:t,values:e});let li=class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}};class di extends li{constructor(t){if(super(t),this.it=H,t.type!==si)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===H||null==t)return this._t=void 0,this.it=t;if(t===V)return t;if("string"!=typeof t)throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const e=[t];return e.raw=e,this._t={_$litType$:this.constructor.resultType,strings:e,values:[]}}}di.directiveName="unsafeHTML",di.resultType=1;const ci=ai(di),ui=1e3,hi=750,pi=new Map,mi="TextRenderer_",gi="TextRenderer_Request_";let fi=null;try{fi=new BroadcastChannel("text-renderer-cache")}catch(t){console.warn("BroadcastChannel not supported, cross-window cache disabled:",t)}function vi(t){const e=`${mi}${t}`,i=localStorage.getItem(e);if(!i)return null;try{const{data:t,timestamp:n}=JSON.parse(i);return Date.now()<n?t:(localStorage.removeItem(e),null)}catch(t){return console.error("Error parsing cross-window cache data:",t),null}}async function yi(t,e){const i=vi(t);if(i)return i;if(pi.has(t))try{return await pi.get(t)}catch(e){return console.error("Existing request failed for source:",t),console.error("Error details:",e),pi.delete(t),null}if(function(t){const e=`${gi}${t}`,i=localStorage.getItem(e);if(!i)return!1;try{const{timestamp:t,requestId:n}=JSON.parse(i);return!(Date.now()-t>3e4&&(localStorage.removeItem(e),1))}catch(t){return console.error("Error parsing cross-window request data:",t),!1}}(t)){const e=3e4,i=100,n=Date.now();for(;Date.now()-n<e;){await new Promise(t=>setTimeout(t,i));const e=vi(t);if(e)return e}}const n=`${gi}${Date.now()}_${Math.random().toString(36).substr(2,9)}`;!function(t,e){const i=`${gi}${t}`,n={timestamp:Date.now(),requestId:e,source:t};localStorage.setItem(i,JSON.stringify(n))}(t,n);const o=(async()=>{try{const i=await fetch(t);if(!i.ok)throw new Error(`Failed to fetch data: ${i.status}`);const n=await i.json();return localStorage.setItem(`TextDataCache_${t}`,JSON.stringify(n)),localStorage.setItem(`TextDataCacheTimestamp_${t}`,(Date.now()+e).toString()),function(t,e,i){const n=`${mi}${t}`,o={data:e,timestamp:Date.now()+i};localStorage.setItem(n,JSON.stringify(o))}(t,n,e),function(t,e){if(fi)try{fi.postMessage({type:"cache-update",source:t,data:e})}catch(t){console.error("Error broadcasting cache update:",t)}}(t,n),n}catch(e){throw console.error("Error fetching data from:",t),console.error("Error details:",e),e}finally{pi.delete(t),function(t){const e=`${gi}${t}`;localStorage.removeItem(e)}(t)}})();pi.set(t,o);try{return await o}catch(t){return null}}function Ai(t){const{typography:e={},padding:i={}}=t,{verticalAlign:n="top"}=e,o="top"===n?"flex-start":"bottom"===n?"flex-end":"center",{top:r=0,left:s=0,bottom:a=0,right:l=0}=i;return`\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    align-items: ${o};\n    \n    position: absolute;\n    overflow: hidden;\n    \n    max-height: calc(100% - ${r+a}px);\n    max-width: calc(100% - ${s+l}px);\n    \n    top: ${r}px;\n    left: ${s}px;\n    bottom: ${a}px;\n    right: ${l}px;\n  `}function bi(t){var e,i,n,o,r,s,a,l,d,c,u,h,p;const{color:m="#000000",opacity:g=1,typography:f={},shadow:v={}}=t,{fontFamily:y="Arial",fontSize:A=16,textDecoration:b="none",textTransform:w="none",lineHeight:E="normal",letterSpacing:x="0",fontWeight:S="normal",fontStyle:$="normal",textAlign:_="left"}=f,{hidden:M=!0}=v,k=(null===(e=v.options)||void 0===e?void 0:e.color)||v.color||"#000000",C=null!==(o=null!==(n=null===(i=v.options)||void 0===i?void 0:i.opacity)&&void 0!==n?n:v.opacity)&&void 0!==o?o:0,R=null!==(a=null!==(s=null===(r=v.options)||void 0===r?void 0:r.blur)&&void 0!==s?s:v.blur)&&void 0!==a?a:0,O=null!==(c=null!==(d=null===(l=v.options)||void 0===l?void 0:l.offset)&&void 0!==d?d:v.offset)&&void 0!==c?c:0,P=null!==(p=null!==(h=null===(u=v.options)||void 0===u?void 0:u.angle)&&void 0!==h?h:v.angle)&&void 0!==p?p:0;return`\n    width: 100%;\n    \n    color: ${m};\n    opacity: ${g};\n    font-family: ${y};\n    font-size: ${A}px;\n    text-decoration: ${b};\n    text-transform: ${w};\n    line-height: ${E};\n    letter-spacing: ${x}px;\n    font-weight: ${S};\n    font-style: ${$};\n    text-align: ${_};\n    text-shadow: ${M?"none":`${O*Math.cos(Math.PI/180*P)}px \n       ${O*Math.sin(Math.PI/180*P)}px \n       ${R}px \n       rgba(${parseInt(k.slice(1,3),16)}, \n            ${parseInt(k.slice(3,5),16)}, \n            ${parseInt(k.slice(5,7),16)}, \n            ${C})`};\n  `}fi&&(fi.onmessage=t=>{const{type:e,source:i,data:n}=t.data;"cache-update"===e&&localStorage.setItem(`TextDataCache_${i}`,JSON.stringify(n))});let wi=class extends(oi(ti(ei))){constructor(){super(...arguments),this.lastFetchTime=0,this.hasConstantAnimations=!1,this.hasAnimationIn=!1,this.hasAnimationOut=!1}connectedCallback(){super.connectedCallback();this.isDynamicMode()&&this.fetchAndUpdateText().then(t=>{var e,i,n,o;const r=parseInt(null===(o=null===(n=null===(i=null===(e=this.document)||void 0===e?void 0:e.content)||void 0===i?void 0:i["text-options-dynamic"])||void 0===n?void 0:n["data-source"])||void 0===o?void 0:o["refresh-rate"])||60;this.refreshInterval=setInterval(()=>{this.fetchAndUpdateText()},1e3*r)})}disconnectedCallback(){super.disconnectedCallback(),this.refreshInterval&&clearInterval(this.refreshInterval)}updated(t){var e,i,n,o,r,s,a,l,d,c,u,h,p,m,g;super.updated(t);const f=(t,e,i,n)=>{const o=1e3/this.frameRate,r=t>=e-hi&&t<=e-hi+o;i&&!1===this.hasAnimationOut&&"none"!==n&&r&&this.triggerAnimationOut(n);const s=t>=e-hi&&t<=e;this.hasAnimationOut&&!s&&this.cleanUpAnimationOut()},v=(t,e,i)=>{const n=1e3/this.frameRate,o=t>=0&&t<=n;e&&!1===this.hasAnimationIn&&"none"!==i&&o&&this.triggerAnimationIn(i);const r=t>=0&&t<=ui+n;this.hasAnimationIn&&!r&&this.cleanUpAnimationIn()};if(t.has("currentTimestamp")){const t=(null===(n=null===(i=null===(e=this.document)||void 0===e?void 0:e.content)||void 0===i?void 0:i.options)||void 0===n?void 0:n.animationIn)||"none",y=(null===(s=null===(r=null===(o=this.document)||void 0===o?void 0:o.content)||void 0===r?void 0:r.options)||void 0===s?void 0:s.animationOut)||"none",A=(null!==(d=null===(l=null===(a=this.document)||void 0===a?void 0:a.options)||void 0===l?void 0:l.end)&&void 0!==d?d:0)-(null!==(h=null===(u=null===(c=this.document)||void 0===c?void 0:c.options)||void 0===u?void 0:u.start)&&void 0!==h?h:0),b=this.currentTimestamp-(null!==(g=null===(m=null===(p=this.document)||void 0===p?void 0:p.options)||void 0===m?void 0:m.start)&&void 0!==g?g:0),w="false"===this.editingMode&&this.isPlaying;f(b,A,w,y),v(b,w,t)}}isDynamicMode(){var t,e;return"dynamic"===(null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.mode)}calculateMinHeight(t,e){var i;if("number"==typeof e){return""+t*e}if("normal"===e){return`calc(${t}px * 1.4)`}if(e.endsWith("px")||e.endsWith("em")||e.endsWith("rem")||e.endsWith("%"))return e;return`calc(${t}px * ${null!==(i=parseFloat(e))&&void 0!==i?i:1.4})`}applyConstantAnimation(){var t,e,i;if(this.hasConstantAnimations)return;this.hasConstantAnimations=!0;const n=(null===(i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.options)||void 0===i?void 0:i.animation)||"none";if("none"===n)return;Array.from(this.renderRoot.querySelectorAll(".zcast-text-widget-text > p")).forEach((t,e)=>{"crawl"===n?t.classList.add("crawl"):"roll"===n&&(this.wrapRolling(t),t.classList.add("roll"))})}triggerAnimationIn(t="none"){if("none"===t)return;Array.from(this.renderRoot.querySelectorAll(".zcast-text-widget-text > p")).forEach((e,i)=>{"type"===t?(this.wrapTypewriter(e),e.classList.add("type-in")):"fade"!==t&&"slide"!==t&&"zoom"!==t||e.classList.add(`${t}-in`)}),this.hasAnimationIn=!0}triggerAnimationOut(t="none"){if("none"===t)return;Array.from(this.renderRoot.querySelectorAll(".zcast-text-widget-text > p")).forEach((e,i)=>{if("type"===t){e.classList.add("type-out");const t=e.dataset.original||e.textContent||"",i=50*t.length+100;setTimeout(()=>{e.innerHTML=t},i)}else"fade"!==t&&"slide"!==t&&"zoom"!==t||e.classList.add(`${t}-out`)}),this.hasAnimationOut=!0}cleanUpAnimationIn(){var t,e,i;const n=(null===(i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.options)||void 0===i?void 0:i.animationIn)||"none";if("none"===n)return;Array.from(this.renderRoot.querySelectorAll(".zcast-text-widget-text > p")).forEach((t,e)=>{"type"===n?(t.classList.remove("type-in"),t.innerHTML=t.dataset.original||t.innerHTML):"fade"!==n&&"slide"!==n&&"zoom"!==n||t.classList.remove(`${n}-in`)}),this.hasAnimationIn=!1}cleanUpAnimationOut(){var t,e,i;this.requestUpdate();const n=(null===(i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.options)||void 0===i?void 0:i.animationOut)||"none";if("none"===n)return;Array.from(this.renderRoot.querySelectorAll(".zcast-text-widget-text > p")).forEach((t,e)=>{"type"===n?(t.classList.remove("type-out"),t.innerHTML=t.dataset.original||t.innerHTML,t.classList.add("type-in")):"fade"!==n&&"slide"!==n&&"zoom"!==n||(t.classList.remove(`${n}-out`),t.classList.add(`${n}-in`))}),this.hasAnimationOut=!1}wrapRolling(t){t.dataset.original||(t.dataset.original=t.innerHTML);let e=0;const i=document.createDocumentFragment();t.childNodes.forEach((t,n)=>{if(t.nodeType===Node.TEXT_NODE){const n=t.textContent||"";Array.from(n).forEach((t,n)=>{const o=document.createElement("span");o.textContent=" "===t?" ":t,o.style.animationDelay=100*(e+n)+"ms",i.appendChild(o)}),e+=n.length}else i.appendChild(t.cloneNode(!0))}),t.innerHTML="",t.appendChild(i)}wrapTypewriter(t){t.dataset.original||(t.dataset.original=t.innerHTML);let e=0;const i=document.createDocumentFragment();t.childNodes.forEach((t,n)=>{if(t.nodeType===Node.TEXT_NODE){const n=t.textContent;n&&(Array.from(n).forEach((t,n)=>{const o=document.createElement("span");o.textContent=" "===t?" ":t,o.style.animationDelay=50*(e+n)+"ms",i.appendChild(o)}),e+=n.length)}else i.appendChild(t.cloneNode(!0))}),t.innerHTML="",t.appendChild(i)}setupVariableSubscriptions(){}async fetchAndUpdateText(t=this.document){var e;if(!t||!t.content||!t.content["text-options-dynamic"])return void(this.data=null);const i=t.content["text-options-dynamic"]["data-source"];if(!i)return void(this.data=null);let n=i.domain;if(!n)return void(this.data=null);n.endsWith("/")&&(n=n.slice(0,-1));const o=i.port||"";let r=i.route||"/";r.startsWith("/")||(r=`/${r}`);const s=`${n}${""!==o?`:${o}`:o}${r}`,a=null!==(e=parseInt(i["refresh-rate"]))&&void 0!==e?e:60,l=t.content["text-options-dynamic"].fallback||"";if(!s)return void(this.data=l);const d=Date.now(),c=d-this.lastFetchTime,u=1e3*a;let h=function(t){const e=localStorage.getItem(`TextDataCacheTimestamp_${t}`),i=localStorage.getItem(`TextDataCache_${t}`);return e&&i&&Date.now()<parseInt(e,10)?JSON.parse(i):null}(s);if(h){const t=i["value-path"]||"[0].title",e=this.getValueByPath(h,t,l);this.data!==e?(this.data=e,this.requestUpdate()):this.data=e}if(c<u&&this.lastFetchTime>0)return;this.lastFetchTime=d;let p=null;try{p=await yi(s,u)}catch(t){if(h)return;return void(this.data=l)}if(!p){if(h)return;return void(this.data=l)}const m=i["value-path"]||"[0].title",g=this.getValueByPath(p,m,l);this.data!==g?(this.data=g,this.requestUpdate()):this.data=g}getValueByPath(t,e,i=void 0){if(null==t||"string"!=typeof e||""===e.trim())return i;const n=e.replace(/\[(?:(['"])(.*?)\1|(\d+))\]/g,".$2$3").split(".").filter(t=>t.length>0).reduce((t,e)=>null==t?void 0:t[e],t);return null!=n?n:i}renderStatic(t){var e,i,n,o;const r=t.content&&t.content.options||{},s=t.content["text-options-static"]||t.content.text||{};let a;if(s.text&&"object"==typeof s.text&&s.text.variableId){const t=this.getVariableValue(s.text.variableId);if(null==t)a=s.text.fallback||"";else if(Array.isArray(t))a=t.join(", ");else if("object"==typeof t)try{a=JSON.stringify(t,null,2)}catch(e){console.warn("[TextWidget] Failed to stringify object, using string conversion:",e),a=String(t)}else a="string"==typeof t?t:String(t)}else a=s.text||"";"string"!=typeof a&&(console.warn("[TextWidget] Non-string value passed to text field, converting to string:",a),a=String(a));const l=Ai(r),d=bi(r);return W`
      <style>
        .zcast-text-widget-wrapper {
            ${"\n    width: 100%;\n    height: 100%;\n  "}
        }

        .zcast-text-widget-content {
            ${l}
        }

        .zcast-text-widget-text {
            ${d}
        }

        .zcast-text-widget-text * {
            position: relative !important;
            padding: 0;
            margin: 0;
        }

        p {
            min-height: ${this.calculateMinHeight(null!==(i=null===(e=null==r?void 0:r.typography)||void 0===e?void 0:e.fontSize)&&void 0!==i?i:16,null!==(o=null===(n=null==r?void 0:r.typography)||void 0===n?void 0:n.lineHeight)&&void 0!==o?o:"normal")};
        }
      </style>
      <div class="zcast-text-widget-wrapper">
        <div class="zcast-text-widget-content">
          <div class="zcast-text-widget-text">${ci(a)}</div>
        </div>
      </div>
    `}renderDynamic(t){var e,i,n,o,r;const s=t.content&&t.content.options||{},a=s.animation&&"none"!==s.animation,l="none"!==s.animationIn||"none"!==s.animationOut,d=a||l;let c=this.data;null==c&&(c=(null===(e=t.content["text-options-dynamic"])||void 0===e?void 0:e.fallback)||""),"string"!=typeof c&&(console.warn("[TextWidget] Non-string value passed to data field, converting to string:",c),c=String(c)),d&&!/^<p[\s>]/i.test(c.trim())&&(c=`<p>${c}</p>`);const u=Ai(s),h=bi(s);return W`
      <style>
        .zcast-text-widget-wrapper {
            ${"\n    width: 100%;\n    height: 100%;\n  "}
        }

        .zcast-text-widget-content {
            ${u}
        }

        .zcast-text-widget-text {
            ${h}
        }

        .zcast-text-widget-text * {
            position: relative !important;
            padding: 0;
            margin: 0;
        }

        p {
            min-height: ${this.calculateMinHeight(null!==(n=null===(i=null==s?void 0:s.typography)||void 0===i?void 0:i.fontSize)&&void 0!==n?n:16,null!==(r=null===(o=null==s?void 0:s.typography)||void 0===o?void 0:o.lineHeight)&&void 0!==r?r:"normal")};
        }
      </style>
      <div class="zcast-text-widget-wrapper">
        <div class="zcast-text-widget-content">
          <div class="zcast-text-widget-text">
            <p>${ci(c)}</p>
          </div>
        </div>
      </div>
    `}render(){var t;super.render();const e=this.document;if(!e)return W``;const i=this.isDynamicMode()?this.renderDynamic(e):this.renderStatic(e);return"none"!==((null===(t=e.content.options)||void 0===t?void 0:t.animation)||"none")&&requestAnimationFrame(()=>{this.applyConstantAnimation()}),ii(i)}static getCacheState(){return{size:pi.size,keys:Array.from(pi.keys())}}static clearCache(){pi.clear()}static getCrossWindowCacheState(){const t={};for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);if(i&&(i.startsWith(mi)||i.startsWith(gi)))try{const e=localStorage.getItem(i);e&&(t[i]=JSON.parse(e))}catch(e){t[i]="Error parsing value"}}return t}static clearCrossWindowCache(){const t=[];for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);i&&(i.startsWith(mi)||i.startsWith(gi))&&t.push(i)}t.forEach(t=>localStorage.removeItem(t))}static getFetchStatusForAll(){const t=document.querySelectorAll("text-renderer"),e=[];return t.forEach((t,i)=>{t.isDynamicMode&&t.getFetchStatus&&e.push({index:i,isDynamic:t.isDynamicMode(),fetchStatus:t.getFetchStatus()})}),e}async forceRefresh(){this.isDynamicMode()&&(this.lastFetchTime=0,await this.fetchAndUpdateText())}getFetchStatus(){var t,e,i,n;const o=Date.now()-this.lastFetchTime,r=parseInt(null===(n=null===(i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e["text-options-dynamic"])||void 0===i?void 0:i["data-source"])||void 0===n?void 0:n["refresh-rate"])||60,s=1e3*r,a=o<s&&this.lastFetchTime>0;return{lastFetchTime:this.lastFetchTime,timeSinceLastFetch:o,refreshRateSeconds:r,refreshRateMillis:s,isDataValid:a,timeUntilNextFetch:Math.max(0,s-o)}}};wi.styles=[...Ne.styles,l`
      :host {
        display: block;
        box-sizing: border-box;
      }

      .fade-in {
        animation: fadeIn ${ui}ms forwards;
      }

      .fade-out {
        animation: fadeOut ${hi}ms linear normal forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      .type-in span {
        opacity: 0;
        animation: typeIn 0.05s forwards;
        display: inline-block;
      }

      .type-out span {
        animation: typeOut 0.05s linear normal forwards;
      }

      @keyframes typeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes typeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      .slide-in {
        animation: slideIn ${ui}ms forwards;
      }

      .slide-out {
        animation: slideOut ${hi}ms linear normal forwards;
      }

      @keyframes slideIn {
        from {
          transform: translateY(25%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      @keyframes slideOut {
        from {
          transform: translateY(0);
          opacity: 1;
        }
        to {
          transform: translateY(25%);
          opacity: 0;
        }
      }

      .zoom-in {
        animation: zoomIn ${ui}ms forwards;
      }

      .zoom-out {
        animation: zoomOut ${hi}ms linear normal forwards;
      }

      @keyframes zoomIn {
        from {
          transform: scale(0.5);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      @keyframes zoomOut {
        from {
          transform: scale(1);
          opacity: 1;
        }
        to {
          transform: scale(0.5);
          opacity: 0;
        }
      }

      .crawl {
        animation: crawl 5s linear infinite;
        opacity: 1;
      }

      @keyframes crawl {
        0% {
          transform: translateX(0);
        }
        49.9999999999% {
          transform: translateX(100%);
        }
        50% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(0);
        }
      }

      .roll {
        vertical-align: baseline;
      }

      .roll span {
        display: inline-block;
        animation: roll 8s linear infinite;
      }

      @keyframes roll {
        0% {
          padding-top: 0.5em;
          opacity: 0;
        }
        5% {
          padding-top: 0;
          opacity: 1;
        }
        85% {
          padding-top: 0;
          opacity: 1;
        }
        90% {
          padding-top: -0.5em;
          opacity: 0;
        }
        100% {
          padding-top: -0.5em;
          opacity: 0;
        }
      }
    `],wi=t([ct("text-renderer")],wi);const Ei="important",xi=" !"+Ei,Si=ai(class extends li{constructor(t){if(super(t),t.type!==ri||"style"!==t.name||t.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce((e,i)=>{const n=t[i];return null==n?e:e+`${i=i.includes("-")?i:i.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${n};`},"")}update(t,[e]){const{style:i}=t.element;if(void 0===this.ft)return this.ft=new Set(Object.keys(e)),this.render(e);for(const t of this.ft)null==e[t]&&(this.ft.delete(t),t.includes("-")?i.removeProperty(t):i[t]=null);for(const t in e){const n=e[t];if(null!=n){this.ft.add(t);const e="string"==typeof n&&n.endsWith(xi);t.includes("-")||e?i.setProperty(t,e?n.slice(0,-11):n,e?Ei:""):i[t]=n}}return V}});let $i=class extends(ti(ei)){constructor(){super()}render(){super.render();const t={position:"absolute",width:`${String(je("width",this.document.props,this.currentTimestamp))}px`,height:`${String(je("height",this.document.props,this.currentTimestamp))}px`,left:"0",top:"0",overflow:"hidden"};return ii(W`
      <div style=${Si(t)}>
        <slot></slot>
      </div>
    `)}};$i.styles=[...ei.styles,l`
      :host {
        position: relative;
      }
      ::slotted(*) {
        position: absolute;
      }
    `],$i=t([ct("container-renderer"),e("design:paramtypes",[])],$i);let _i=class extends(oi(ti(ei))){constructor(){super(...arguments),this.currentImageSource=""}firstUpdated(t){super.firstUpdated(t),this.updateImageSource()}setupVariableSubscriptions(){var t,e;const i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.src;if(i){const t=this.subscribeToValue(i,t=>{this.currentImageSource=this.processImageSource(t),this.requestUpdate()});this.currentImageSource=this.processImageSource(t)}}updateImageSource(){var t,e;const i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.src;if(i){const t=this.resolveValue(i);this.currentImageSource=this.processImageSource(t)||"./static_images/no-signal.png"}else this.currentImageSource="./static_images/no-signal.png"}updated(t){super.updated(t)}processImageSource(t){var e,i;if(!t)return"./static_images/no-signal.png";const n=t.split(":")[0];if("http"===n||"https"===n){const o=(null===(i=null===(e=window.location)||void 0===e?void 0:e.protocol)||void 0===i?void 0:i.replace(":",""))||"";n!==o&&(t=t.replace(n,o))}return t}render(){var t,e;super.render();const i=(null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.fillMode)||"cover";return ii(W`<img
      src="${this.currentImageSource||"./static_images/no-signal.png"}"
      style="object-fit: ${i}"
    />`)}};_i.styles=[...Ne.styles,l`
      :host {
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: transparent;
      }

      img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background-color: transparent;
      }
    `],t([gt("img"),e("design:type",HTMLImageElement)],_i.prototype,"imageElement",void 0),t([mt(),e("design:type",String)],_i.prototype,"currentImageSource",void 0),_i=t([ct("image-renderer")],_i);const Mi=t=>class extends t{constructor(){super(...arguments),this.eventListenerManager=new Be}connectedCallback(){super.connectedCallback(),"false"!==this.editingMode&&(this.eventListenerManager.setEventListener("click",this.handleClick.bind(this)),this.eventListenerManager.setEventListener("contextmenu",this.handleContextMenu.bind(this)),this.eventListenerManager.registerEventListeners(this))}disconnectedCallback(){super.disconnectedCallback(),"false"!==this.editingMode&&this.eventListenerManager.removeEventListeners(this)}handleClick(t){this.dragManager||"false"===this.editingMode||this.dispatchEvent(new CustomEvent("selection-change",{detail:{...t,element:this},bubbles:!0,composed:!0}))}handleContextMenu(t){"false"!==this.editingMode&&this.dispatchEvent(new CustomEvent("open-context-menu",{detail:{...t,element:this},bubbles:!0,composed:!0}))}updated(t){if(super.updated(t),"false"!==this.editingMode&&(t.has("zoomFactor")&&(this.dragManager&&(this.dragManager.zoomFactor=this.zoomFactor),this.resizeManager&&(this.resizeManager.zoomFactor=this.zoomFactor)),t.has("props")||t.has("selected"))){const t=this.editingMode&&("true"===this.editingMode||"layout"===this.editingMode),e="boolean"==typeof this.selected&&this.selected;this.ariaSelected=String(e),e?(this.dragManager=new Ye(this,this.document,this.layoutDocument,this.parentDocument,this.currentTimestamp,{isDraggable:t}),this.dragManager.zoomFactor=this.zoomFactor,this.dragManager.addDragHandle(),this.resizeManager=new Xe(this,{isResizable:!1}),this.resizeManager.zoomFactor=this.zoomFactor,this.resizeManager.addResizeHandles()):(this.dragManager&&this.dragManager.removeDragHandle(),this.resizeManager&&this.resizeManager.removeResizeHandles())}}render(){var t;if(super.render(),"false"===this.editingMode)return;const e=void 0!==(null===(t=this.document.options)||void 0===t?void 0:t.locked)&&this.document.options.locked,i=this.editingMode&&"false"===this.editingMode&&!e;return this.style.cursor=i?"pointer":"default","layout"===this.editingMode&&e?W`<div class="locked">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock-icon lucide-lock"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        </div>`:W``}};let ki=class extends(Mi(ei)){firstUpdated(t){var e,i,n,o;if(super.firstUpdated(t),!this.layoutRenderer)return;const r=null!==(n=null===(i=null===(e=this.document)||void 0===e?void 0:e.options)||void 0===i?void 0:i.start)&&void 0!==n?n:0,s=(null!==(o=this.currentTimestamp)&&void 0!==o?o:0)-r;this.layoutRenderer.currentTimestamp=s}updated(t){var e,i;if(super.updated(t),this.layoutRenderer&&(t.has("document")&&(this.layoutRenderer.document=this.document),t.has("currentTimestamp")&&!this.isPlaying)){const t=(null===(i=null===(e=this.document)||void 0===e?void 0:e.options)||void 0===i?void 0:i.start)||0,n=(this.currentTimestamp||0)-t;this.layoutRenderer.currentTimestamp=n}}play(){super.play(),this.layoutRenderer&&this.layoutRenderer.play()}pause(){super.pause(),this.layoutRenderer&&this.layoutRenderer.pause()}stop(){super.stop(),this.layoutRenderer&&this.layoutRenderer.stop()}render(){var t,e,i,n;super.render();const o=structuredClone(this.document);return"child-layout"===o.type&&(o.type="layout"),ii(W`
      <layout-renderer
        .editingMode=${"false"}
        .playbackMode=${"child"}
        .zoomFactor=${null!==(i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.zoomFactor)&&void 0!==i?i:1}
        .frameRate=${null!==(n=this.frameRate)&&void 0!==n?n:30}
        .document=${o}
        .isChildLayout=${!0}
      ></layout-renderer>
    `)}};ki.styles=[...Ne.styles,l`
      * {
        overflow: hidden;
      }
    `],t([gt("layout-renderer"),e("design:type",on)],ki.prototype,"layoutRenderer",void 0),ki=t([ct("child-layout-renderer")],ki);let Ci=class extends(Mi(ei)){firstUpdated(t){var e,i,n,o;if(super.firstUpdated(t),!this.playlistRenderer)return;const r=null!==(n=null===(i=null===(e=this.document)||void 0===e?void 0:e.options)||void 0===i?void 0:i.start)&&void 0!==n?n:0,s=(null!==(o=this.currentTimestamp)&&void 0!==o?o:0)-r;this.playlistRenderer.currentTimestamp=s}updated(t){var e,i,n;if(super.updated(t),this.playlistRenderer&&(t.has("document")&&(this.playlistRenderer.document=null===(e=this.document)||void 0===e?void 0:e.content),t.has("currentTimestamp")&&!this.isPlaying)){const t=(null===(n=null===(i=this.document)||void 0===i?void 0:i.options)||void 0===n?void 0:n.start)||0,e=(this.currentTimestamp||0)-t;this.playlistRenderer.currentTimestamp=e}}play(){super.play(),this.playlistRenderer&&this.playlistRenderer.play()}pause(){super.pause(),this.playlistRenderer&&this.playlistRenderer.pause()}stop(){super.stop(),this.playlistRenderer&&this.playlistRenderer.stop()}render(){var t,e;super.render();const i=structuredClone(null===(t=this.document)||void 0===t?void 0:t.content);return"child-playlist"===i.type&&(i.type="playlist"),ii(W`
      <playlist-renderer
        .document=${(null===(e=this.document)||void 0===e?void 0:e.content)||this.document}
        .zoomFactor=${1}
        .frameRate=${this.frameRate}
        .currentTimestamp=${this.currentTimestamp}
      ></playlist-renderer>
    `)}};Ci.styles=[...Ne.styles,l`
      * {
        overflow: hidden;
      }
    `],t([gt("playlist-renderer"),e("design:type",Object)],Ci.prototype,"playlistRenderer",void 0),Ci=t([ct("child-playlist-renderer")],Ci);let Ri=class extends Ne{render(){super.render()}};Ri.styles=[...Ne.styles,l``],Ri=t([ct("mpv-renderer")],Ri);let Oi=class extends Ne{render(){super.render()}};Oi.styles=[...Ne.styles,l``],Oi=t([ct("file-gallery-renderer")],Oi);let Pi=class extends lt{constructor(){super(...arguments),this.handleSave=()=>{console.error("[ERROR] handleSave not implemented")},this.handleClose=()=>{console.error("[ERROR] handleClose not implemented")},this.saveAsset=()=>{console.error("[ERROR] saveAsset not implemented")}}render(){return W`<slot></slot>`}};t([pt({type:Object}),e("design:type",Object)],Pi.prototype,"content",void 0),t([pt({type:Array}),e("design:type",Array)],Pi.prototype,"tags",void 0),t([pt({type:Function}),e("design:type",Function)],Pi.prototype,"handleSave",void 0),t([pt({type:Function}),e("design:type",Function)],Pi.prototype,"handleClose",void 0),t([pt({type:Function}),e("design:type",Function)],Pi.prototype,"saveAsset",void 0),Pi=t([ct("base-settings")],Pi);let Ii=class extends Pi{constructor(){super(...arguments),this.filters={name:"",media_types:[],tags:[]},this.results=[]}connectedCallback(){if(super.connectedCallback(),this.content&&this.content.queryString)try{this.filters=JSON.parse(this.content.queryString)}catch(t){console.error("[ERROR] Invalid queryString format:",t)}this.fetchResults(this.filters).then()}async fetchResults(t){const e=new URL(`${window.location.origin}/api/media-asset/`);t.name&&""!==t.name.trim()&&e.searchParams.append("name",t.name.trim()),t.media_types.length>0&&e.searchParams.append("media_category",t.media_types.join(",")),t.tags.length>0&&e.searchParams.append("tags",t.tags.join(","));try{const t=await fetch(e.toString());if(!t.ok)throw new Error("Failed to fetch media assets");const i=await t.json();this.results=i.results||i,this.content={queryString:JSON.stringify(this.filters),results:this.results},this.requestUpdate()}catch(t){console.error("[ERROR] Error fetching media assets:",t),this.results=[]}}handleNameInput(t){const e=t.target;this.filters={...this.filters,name:e.value}}handleMediaTypesInput(t){const e=t.target.value.split(",").map(t=>t.trim()).filter(Boolean);this.filters={...this.filters,media_types:e}}toggleTag(t){const e=this.filters.tags.indexOf(t);this.filters.tags=e>-1?this.filters.tags.filter(e=>e!==t):[...this.filters.tags,t]}async handleApply(){await this.fetchResults(this.filters)}render(){return W`
      <div class="p-2">
        <div class="mb-2">
          <label for="nameInput" class="block text-sm font-bold mb-2"
            >Name</label
          >
          <input
            id="nameInput"
            type="text"
            class="px-2 py-1 border rounded w-full"
            .value="${this.filters.name}"
            @input="${this.handleNameInput}"
            placeholder="Enter name"
          />
        </div>
        <div class="mb-2">
          <label for="mediaTypesInput" class="block text-sm font-bold mb-2"
            >Media Types (comma-separated)</label
          >
          <input
            id="mediaTypesInput"
            type="text"
            class="px-2 py-1 border rounded w-full"
            .value="${this.filters.media_types.join(", ")}"
            @input="${this.handleMediaTypesInput}"
            placeholder="e.g., image, video"
          />
        </div>
        <div class="mb-2">
          <span class="block text-sm font-bold mb-2">Tags</span>
          <div>
            ${this.tags.map(t=>W`
                <button
                  class="tag-button px-3 py-1 border rounded ${this.filters.tags.includes(t.slug)?"bg-blue-500 text-white":""}"
                  @click="${()=>{this.toggleTag(t.slug),this.requestUpdate()}}"
                >
                  ${t.name}
                </button>
              `)}
          </div>
        </div>
        <div class="mb-2">
          <button
            class="bg-blue-500 text-white px-3 py-1 rounded"
            @click="${this.handleApply}"
          >
            Apply Filters
          </button>
        </div>
        <div class="mt-2 border p-2">
          <h3 class="text-lg font-bold">Results</h3>
          ${this.results.length>0?W`
                <ul class="list-disc ml-4">
                  ${this.results.map(t=>W`<li>${t.name||"Unnamed Media"}</li>`)}
                </ul>
              `:W`<p>No results found</p>`}
        </div>
      </div>
    `}};Ii.styles=l`
    * {
      font-size: 1rem;
      box-sizing: border-box;
    }
    .block {
      display: block;
    }
    .text-sm {
      font-size: 0.8rem;
    }
    .mb-2 {
      margin-bottom: 0.5rem;
    }
    .mt-2 {
      margin-top: 0.5rem;
    }
    .border {
      border: 1px solid #ccc;
    }
    .rounded {
      border-radius: 0.25rem;
    }
    .p-2 {
      padding: 0.5rem;
    }
    .w-full {
      width: 100%;
    }
    .bg-blue-500 {
      background-color: #3b82f6;
    }
    .text-white {
      color: white;
    }
    .px-3 {
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }
    .py-1 {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem;
    }
    .tag-button {
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
    }
  `,t([mt(),e("design:type",Object)],Ii.prototype,"filters",void 0),t([mt(),e("design:type",Array)],Ii.prototype,"results",void 0),Ii=t([ct("file-gallery-widget-settings")],Ii);let Di=class extends Ne{constructor(){super(...arguments),this.isPlaying=!1,this.audioPlaying=!1,this.hasPlayedOnce=!1,this.muted=!0}connectedCallback(){super.connectedCallback(),ue().then(t=>{this.updateMuted(!t)})}disconnectedCallback(){super.disconnectedCallback(),this.audioElement&&(this.audioElement.pause(),this.audioElement.removeEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.audioElement.src="",this.audioElement.load())}firstUpdated(t){super.firstUpdated(t),this.setupAudioElement()}setupAudioElement(){var t,e,i;const n=this.getAudioSource();n&&this.audioElement?(this.audioElement.pause(),this.audioElement.src=n,this.audioElement.loop=!0,this.audioElement.muted=this.muted,this.audioElement.volume=null!==(i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.volume)&&void 0!==i?i:1,this.audioElement.preload="auto",this.audioElement.addEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.audioElement.addEventListener("keydown",t=>{t.preventDefault(),t.stopPropagation()})):console.error("[ERROR] No audio source provided or audio element not available")}updated(t){var e,i,n,o,r,s,a;if(super.updated(t),t.has("document")&&this.audioElement&&(this.audioElement.volume=null!==(n=null===(i=null===(e=this.document)||void 0===e?void 0:e.content)||void 0===i?void 0:i.volume)&&void 0!==n?n:1),t.has("document")&&(this.setupAudioElement(),!1===this.isPlaying&&!1===this.audioPlaying&&this.updateAudioFrame()),t.has("currentTimestamp")){if(!1===this.isPlaying&&!1===this.audioPlaying)return void this.updateAudioFrame();!0===this.muted&&ue().then(t=>{this.updateMuted(!t)});const t=this.getPlaybackMode();if(0===(null===(r=null===(o=this.layoutDocument)||void 0===o?void 0:o.options)||void 0===r?void 0:r.duration)&&"once"===t&&this.hasPlayedOnce)return;if(!this.audioElement)return;if("solitary"===t)return;if(0===this.currentTimestamp&&this.audioElement.currentTime>0){console.info("[INFO] audio is starting over");const t=this.getEffectiveCurrentTimestamp();this.displayFrameAt(t)}const e=null===(s=this.document.options)||void 0===s?void 0:s.start,i=null===(a=this.document.options)||void 0===a?void 0:a.end;void 0!==e&&this.currentTimestamp<e&&this.audioStop(),void 0!==i&&this.currentTimestamp>i&&this.audioStop(),!0===this.isPlaying&&this.currentTimestamp>=e&&this.currentTimestamp<=i&&this.audioPlay()}}play(){super.play(),this.isPlaying=!0,this.audioPlay()}pause(){super.pause(),this.isPlaying=!1,this.audioPause()}stop(){super.stop(),this.isPlaying=!1,this.audioStop()}audioPlay(){var t,e,i,n;if(null===this.audioElement||void 0===this.audioElement)return;const o=this.getCurrentTimestampSinceStart();if(o<0)return;o>(null!==(e=null===(t=this.document.options)||void 0===t?void 0:t.end)&&void 0!==e?e:0)-(null!==(n=null===(i=this.document.options)||void 0===i?void 0:i.start)&&void 0!==n?n:0)||(this.audioPlaying=!0,this.audioElement.play().catch(t=>{this.audioPlaying=!1,console.error("[ERROR] Play error on audio element.",this.document.name,t)}))}audioPause(){this.audioPlaying=!1,this.audioElement&&this.audioElement.pause()}audioStop(){this.audioPlaying=!1,this.displayFirstFrame(),this.audioElement&&this.audioElement.pause()}displayFrameAt(t){var e,i;let n="number"==typeof t?t:parseInt(t);if(!this.audioElement)return requestAnimationFrame(()=>{!1===this.isPlaying&&!1===this.audioPlaying&&this.displayFrameAt(t)});const o=this.ensureNumber(n/1e3);if(this.audioElement.currentTime===o)return;const r=null===(e=this.document.options)||void 0===e?void 0:e.start,s=null===(i=this.document.options)||void 0===i?void 0:i.end;this.audioPlaying&&(void 0!==r&&this.currentTimestamp<r||void 0!==s&&this.currentTimestamp>s)||(this.audioElement.currentTime=o)}displayFirstFrame(){const t=this.getMarkIn();this.displayFrameAt(t)}displayLastFrame(){const t=this.getMarkOut();console.info("[INFO] last frame at",t),this.displayFrameAt(t)}updateAudioFrame(){const t=this.getEffectiveCurrentTimestamp(),e=this.getMarkOut(),i=this.getPlaybackMode();console.info("[INFO] updateAudioFrame",t,e,i),"once"===i&&t>e&&(this.hasPlayedOnce=!0,this.displayLastFrame()),"loop"!==i&&"solitary"!==i||this.displayFrameAt(t)}onTimeUpdate(){if(!this.audioPlaying||!this.audioElement)return;if("once"===this.getPlaybackMode()&&this.hasPlayedOnce)return;const t=this.getPlaybackMode(),e=this.getMarkIn()/1e3,i=this.getMarkOut()/1e3;if(this.audioElement.currentTime>=i){if("once"===t)return void(this.hasPlayedOnce||(this.audioElement.pause(),this.audioElement.muted=!0,this.audioPlaying=!1,this.hasPlayedOnce=!0));"loop"!==t&&"solitary"!==t||(this.audioElement.currentTime=e,this.audioElement.play().catch(t=>{console.error("[ERROR] Error playing audio in loop:",t)}))}}getAudioSource(){var t,e,i;const n=null!==(i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.src)&&void 0!==i?i:"";return console.info("[INFO] Resolved audio source:",n),n}ensureNumber(t,e){const i=Number(t);return isNaN(i)?(console.warn(`[WARN] ${e} is not a valid number, setting to 0`),0):i}getMarkIn(){var t,e;return this.ensureNumber(null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e["mark-in"],"mark-in")}getMarkOut(){var t,e,i,n;const o=this.getMarkIn(),r=this.ensureNumber(null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e["mark-out"],"mark-out"),s=null===(i=this.document.options)||void 0===i?void 0:i.start,a=null===(n=this.document.options)||void 0===n?void 0:n.end;if(!r||0===r){return a-s+o}return r}getPlaybackMode(){var t,e,i,n,o;const r=(null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e["playback-mode"])||"loop";return 0===(null!==(o=null===(n=null===(i=this.layoutDocument)||void 0===i?void 0:i.options)||void 0===n?void 0:n.duration)&&void 0!==o?o:0)&&"once"!==r?"solitary":r}getCurrentTimestampSinceStart(){var t,e,i;const n=null!==(e=null===(t=this.document.options)||void 0===t?void 0:t.start)&&void 0!==e?e:0;return(null!==(i=this.currentTimestamp)&&void 0!==i?i:0)-n}getEffectiveCurrentTimestamp(){const t=this.getSegmentDuration(),e=this.getMarkIn(),i=this.getCurrentTimestampSinceStart(),n=this.getPlaybackMode();if("once"===n){const t=e+i,n=this.getMarkOut();return Math.min(t,n)}if("loop"===n){return e+i%t}return i}getSegmentDuration(){const t=this.getMarkIn();return this.getMarkOut()-t}updateMuted(t){this.muted=t,this.audioElement&&(this.audioElement.muted=t)}render(){return W`<audio
      preload="auto"
      tabindex="-1"
      .src=${this.getAudioSource()}
      .autoplay=${!1}
      .loop=${!0}
      .controls=${!1}
    ></audio>`}};t([gt("audio"),e("design:type",HTMLAudioElement)],Di.prototype,"audioElement",void 0),Di=t([ct("audio-renderer")],Di);let Ti=class extends(ti(ei)){constructor(){super(...arguments),this.streamingStarted=!1}connectedCallback(){super.connectedCallback()}firstUpdated(t){super.firstUpdated(t);const e=this.getStreamSource();e?this.initializeStreaming(e):console.error("[ERROR] No streaming source provided")}updated(t){super.updated(t)}play(){super.play(),this.streamingStarted=!0,this.videoElement&&this.videoElement.play()}pause(){super.pause(),this.streamingStarted=!1,this.videoElement&&this.videoElement.pause()}getStreamSource(){var t,e,i;const n=null!==(i=null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e.src)&&void 0!==i?i:"";return console.info("[INFO] Resolved streaming source:",n),n}initializeStreaming(t){t.endsWith(".m3u8")?this.initializeHLS(t):t.endsWith(".mpd")?this.initializeMPEGDASH(t):t.startsWith("webrtc://")?this.initializeWebRTC(t):this.videoElement&&(this.videoElement.src=t,this.videoElement.preload="auto")}initializeHLS(t){}initializeMPEGDASH(t){}initializeWebRTC(t){}render(){return super.render(),ii(W`<video autoplay muted playsinline></video>`)}};Ti.styles=[...Ne.styles,l`
      :host {
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: transparent;
      }
      video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background-color: transparent;
      }
    `],t([gt("video"),e("design:type",HTMLVideoElement)],Ti.prototype,"videoElement",void 0),Ti=t([ct("streaming-renderer")],Ti);let Li=class extends(ti(ei)){constructor(){super()}mapJustify(t){switch(t){case"center":return"center";case"space-between":return"space-between";case"space-around":return"space-around";case"space-evenly":return"space-evenly";case"end":return"flex-end";default:return"flex-start"}}mapAlign(t){switch(t){case"center":return"center";case"end":return"flex-end";default:return"flex-start"}}mapOverflow(t){switch(t){case"scroll":return{overflow:"auto",wrap:"nowrap"};case"hidden":return{overflow:"hidden",wrap:"nowrap"};default:return{overflow:"visible",wrap:"wrap"}}}render(){var t,e,i,n,o,r,s,a,l,d,c;try{super.render(),this.document||console.error("[FlexboxRenderer] document is undefined"),(null===(t=this.document)||void 0===t?void 0:t.props)||console.error("[FlexboxRenderer] props missing on document",this.document);const u=(null===(e=this.document)||void 0===e?void 0:e.content)||{},h=null!==(i=u.direction)&&void 0!==i?i:"row",p=null!==(n=u.justify)&&void 0!==n?n:"start",m=null!==(o=u.align)&&void 0!==o?o:"start",g=null!==(r=u.overflow)&&void 0!==r?r:"wrap",f=null!==(s=u.rowGap)&&void 0!==s?s:0,v=null!==(a=u.columnGap)&&void 0!==a?a:0,{overflow:y,wrap:A}=this.mapOverflow(g),b=je("width",null===(l=this.document)||void 0===l?void 0:l.props,this.currentTimestamp),w=je("height",null===(d=this.document)||void 0===d?void 0:d.props,this.currentTimestamp);void 0!==b&&void 0!==w||console.error("[FlexboxRenderer] width/height undefined",{widthVal:b,heightVal:w,props:null===(c=this.document)||void 0===c?void 0:c.props});const E={position:"absolute",left:"0",top:"0",display:"flex",flexDirection:h,justifyContent:this.mapJustify(p),alignItems:this.mapAlign(m),flexWrap:A,gap:`${f}px ${v}px`,overflow:y,width:`${String(b)}px`,height:`${String(w)}px`};return ii(W`
        <div style=${Si(E)}>
          <slot></slot>
        </div>
      `)}catch(t){return console.error("[FlexboxRenderer] render failed",t,this.document),ii(W`<div data-error="flexbox-render-failed"></div>`)}}};function Fi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}Li.styles=[...ei.styles,l`
      :host {
        position: relative;
      }

      slot {
        display: contents;
      }

      ::slotted(*) {
        position: static !important;
        display: block;
        min-width: 0;
        min-height: 0;
      }
    `],Li=t([ct("flexbox-renderer"),e("design:paramtypes",[])],Li);var zi,Ni={exports:{}};var Bi,qi=(zi||(zi=1,Bi=Ni,function(t,e){Bi.exports=e()}(0,()=>(()=>{var t={873:(t,e)=>{var i,n,o=function(){var t=function(t,e){var i=t,n=s[e],o=null,r=0,l=null,f=[],v={},A=function(t,e){o=function(t){for(var e=new Array(t),i=0;i<t;i+=1){e[i]=new Array(t);for(var n=0;n<t;n+=1)e[i][n]=null}return e}(r=4*i+17),b(0,0),b(r-7,0),b(0,r-7),E(),w(),S(t,e),i>=7&&x(t),null==l&&(l=_(i,n,f)),$(l,e)},b=function(t,e){for(var i=-1;i<=7;i+=1)if(!(t+i<=-1||r<=t+i))for(var n=-1;n<=7;n+=1)e+n<=-1||r<=e+n||(o[t+i][e+n]=0<=i&&i<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=n&&n<=4)},w=function(){for(var t=8;t<r-8;t+=1)null==o[t][6]&&(o[t][6]=t%2==0);for(var e=8;e<r-8;e+=1)null==o[6][e]&&(o[6][e]=e%2==0)},E=function(){for(var t=a.getPatternPosition(i),e=0;e<t.length;e+=1)for(var n=0;n<t.length;n+=1){var r=t[e],s=t[n];if(null==o[r][s])for(var l=-2;l<=2;l+=1)for(var d=-2;d<=2;d+=1)o[r+l][s+d]=-2==l||2==l||-2==d||2==d||0==l&&0==d}},x=function(t){for(var e=a.getBCHTypeNumber(i),n=0;n<18;n+=1){var s=!t&&1==(e>>n&1);o[Math.floor(n/3)][n%3+r-8-3]=s}for(n=0;n<18;n+=1)s=!t&&1==(e>>n&1),o[n%3+r-8-3][Math.floor(n/3)]=s},S=function(t,e){for(var i=n<<3|e,s=a.getBCHTypeInfo(i),l=0;l<15;l+=1){var d=!t&&1==(s>>l&1);l<6?o[l][8]=d:l<8?o[l+1][8]=d:o[r-15+l][8]=d}for(l=0;l<15;l+=1)d=!t&&1==(s>>l&1),l<8?o[8][r-l-1]=d:l<9?o[8][15-l-1+1]=d:o[8][15-l-1]=d;o[r-8][8]=!t},$=function(t,e){for(var i=-1,n=r-1,s=7,l=0,d=a.getMaskFunction(e),c=r-1;c>0;c-=2)for(6==c&&(c-=1);;){for(var u=0;u<2;u+=1)if(null==o[n][c-u]){var h=!1;l<t.length&&(h=1==(t[l]>>>s&1)),d(n,c-u)&&(h=!h),o[n][c-u]=h,-1==(s-=1)&&(l+=1,s=7)}if((n+=i)<0||r<=n){n-=i,i=-i;break}}},_=function(t,e,i){for(var n=c.getRSBlocks(t,e),o=u(),r=0;r<i.length;r+=1){var s=i[r];o.put(s.getMode(),4),o.put(s.getLength(),a.getLengthInBits(s.getMode(),t)),s.write(o)}var l=0;for(r=0;r<n.length;r+=1)l+=n[r].dataCount;if(o.getLengthInBits()>8*l)throw"code length overflow. ("+o.getLengthInBits()+">"+8*l+")";for(o.getLengthInBits()+4<=8*l&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*l||(o.put(236,8),o.getLengthInBits()>=8*l));)o.put(17,8);return function(t,e){for(var i=0,n=0,o=0,r=new Array(e.length),s=new Array(e.length),l=0;l<e.length;l+=1){var c=e[l].dataCount,u=e[l].totalCount-c;n=Math.max(n,c),o=Math.max(o,u),r[l]=new Array(c);for(var h=0;h<r[l].length;h+=1)r[l][h]=255&t.getBuffer()[h+i];i+=c;var p=a.getErrorCorrectPolynomial(u),m=d(r[l],p.getLength()-1).mod(p);for(s[l]=new Array(p.getLength()-1),h=0;h<s[l].length;h+=1){var g=h+m.getLength()-s[l].length;s[l][h]=g>=0?m.getAt(g):0}}var f=0;for(h=0;h<e.length;h+=1)f+=e[h].totalCount;var v=new Array(f),y=0;for(h=0;h<n;h+=1)for(l=0;l<e.length;l+=1)h<r[l].length&&(v[y]=r[l][h],y+=1);for(h=0;h<o;h+=1)for(l=0;l<e.length;l+=1)h<s[l].length&&(v[y]=s[l][h],y+=1);return v}(o,n)};v.addData=function(t,e){var i=null;switch(e=e||"Byte"){case"Numeric":i=h(t);break;case"Alphanumeric":i=p(t);break;case"Byte":i=m(t);break;case"Kanji":i=g(t);break;default:throw"mode:"+e}f.push(i),l=null},v.isDark=function(t,e){if(t<0||r<=t||e<0||r<=e)throw t+","+e;return o[t][e]},v.getModuleCount=function(){return r},v.make=function(){if(i<1){for(var t=1;t<40;t++){for(var e=c.getRSBlocks(t,n),o=u(),r=0;r<f.length;r++){var s=f[r];o.put(s.getMode(),4),o.put(s.getLength(),a.getLengthInBits(s.getMode(),t)),s.write(o)}var l=0;for(r=0;r<e.length;r++)l+=e[r].dataCount;if(o.getLengthInBits()<=8*l)break}i=t}A(!1,function(){for(var t=0,e=0,i=0;i<8;i+=1){A(!0,i);var n=a.getLostPoint(v);(0==i||t>n)&&(t=n,e=i)}return e}())},v.createTableTag=function(t,e){t=t||2;var i="";i+='<table style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: "+(e=void 0===e?4*t:e)+"px;",i+='">',i+="<tbody>";for(var n=0;n<v.getModuleCount();n+=1){i+="<tr>";for(var o=0;o<v.getModuleCount();o+=1)i+='<td style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: 0px;",i+=" width: "+t+"px;",i+=" height: "+t+"px;",i+=" background-color: ",i+=v.isDark(n,o)?"#000000":"#ffffff",i+=";",i+='"/>';i+="</tr>"}return(i+="</tbody>")+"</table>"},v.createSvgTag=function(t,e,i,n){var o={};"object"==typeof arguments[0]&&(t=(o=arguments[0]).cellSize,e=o.margin,i=o.alt,n=o.title),t=t||2,e=void 0===e?4*t:e,(i="string"==typeof i?{text:i}:i||{}).text=i.text||null,i.id=i.text?i.id||"qrcode-description":null,(n="string"==typeof n?{text:n}:n||{}).text=n.text||null,n.id=n.text?n.id||"qrcode-title":null;var r,s,a,l,d=v.getModuleCount()*t+2*e,c="";for(l="l"+t+",0 0,"+t+" -"+t+",0 0,-"+t+"z ",c+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"',c+=o.scalable?"":' width="'+d+'px" height="'+d+'px"',c+=' viewBox="0 0 '+d+" "+d+'" ',c+=' preserveAspectRatio="xMinYMin meet"',c+=n.text||i.text?' role="img" aria-labelledby="'+M([n.id,i.id].join(" ").trim())+'"':"",c+=">",c+=n.text?'<title id="'+M(n.id)+'">'+M(n.text)+"</title>":"",c+=i.text?'<description id="'+M(i.id)+'">'+M(i.text)+"</description>":"",c+='<rect width="100%" height="100%" fill="white" cx="0" cy="0"/>',c+='<path d="',s=0;s<v.getModuleCount();s+=1)for(a=s*t+e,r=0;r<v.getModuleCount();r+=1)v.isDark(s,r)&&(c+="M"+(r*t+e)+","+a+l);return(c+='" stroke="transparent" fill="black"/>')+"</svg>"},v.createDataURL=function(t,e){t=t||2,e=void 0===e?4*t:e;var i=v.getModuleCount()*t+2*e,n=e,o=i-e;return y(i,i,function(e,i){if(n<=e&&e<o&&n<=i&&i<o){var r=Math.floor((e-n)/t),s=Math.floor((i-n)/t);return v.isDark(s,r)?0:1}return 1})},v.createImgTag=function(t,e,i){t=t||2,e=void 0===e?4*t:e;var n=v.getModuleCount()*t+2*e,o="";return o+="<img",o+=' src="',o+=v.createDataURL(t,e),o+='"',o+=' width="',o+=n,o+='"',o+=' height="',o+=n,o+='"',i&&(o+=' alt="',o+=M(i),o+='"'),o+"/>"};var M=function(t){for(var e="",i=0;i<t.length;i+=1){var n=t.charAt(i);switch(n){case"<":e+="&lt;";break;case">":e+="&gt;";break;case"&":e+="&amp;";break;case'"':e+="&quot;";break;default:e+=n}}return e};return v.createASCII=function(t,e){if((t=t||1)<2)return function(t){t=void 0===t?2:t;var e,i,n,o,r,s=1*v.getModuleCount()+2*t,a=t,l=s-t,d={"██":"█","█ ":"▀"," █":"▄","  ":" "},c={"██":"▀","█ ":"▀"," █":" ","  ":" "},u="";for(e=0;e<s;e+=2){for(n=Math.floor((e-a)/1),o=Math.floor((e+1-a)/1),i=0;i<s;i+=1)r="█",a<=i&&i<l&&a<=e&&e<l&&v.isDark(n,Math.floor((i-a)/1))&&(r=" "),a<=i&&i<l&&a<=e+1&&e+1<l&&v.isDark(o,Math.floor((i-a)/1))?r+=" ":r+="█",u+=t<1&&e+1>=l?c[r]:d[r];u+="\n"}return s%2&&t>0?u.substring(0,u.length-s-1)+Array(s+1).join("▀"):u.substring(0,u.length-1)}(e);t-=1,e=void 0===e?2*t:e;var i,n,o,r,s=v.getModuleCount()*t+2*e,a=e,l=s-e,d=Array(t+1).join("██"),c=Array(t+1).join("  "),u="",h="";for(i=0;i<s;i+=1){for(o=Math.floor((i-a)/t),h="",n=0;n<s;n+=1)r=1,a<=n&&n<l&&a<=i&&i<l&&v.isDark(o,Math.floor((n-a)/t))&&(r=0),h+=r?d:c;for(o=0;o<t;o+=1)u+=h+"\n"}return u.substring(0,u.length-1)},v.renderTo2dContext=function(t,e){e=e||2;for(var i=v.getModuleCount(),n=0;n<i;n++)for(var o=0;o<i;o++)t.fillStyle=v.isDark(n,o)?"black":"white",t.fillRect(n*e,o*e,e,e)},v};t.stringToBytes=(t.stringToBytesFuncs={default:function(t){for(var e=[],i=0;i<t.length;i+=1){var n=t.charCodeAt(i);e.push(255&n)}return e}}).default,t.createStringToBytes=function(t,e){var i=function(){for(var i=v(t),n=function(){var t=i.read();if(-1==t)throw"eof";return t},o=0,r={};;){var s=i.read();if(-1==s)break;var a=n(),l=n()<<8|n();r[String.fromCharCode(s<<8|a)]=l,o+=1}if(o!=e)throw o+" != "+e;return r}(),n="?".charCodeAt(0);return function(t){for(var e=[],o=0;o<t.length;o+=1){var r=t.charCodeAt(o);if(r<128)e.push(r);else{var s=i[t.charAt(o)];"number"==typeof s?(255&s)==s?e.push(s):(e.push(s>>>8),e.push(255&s)):e.push(n)}}return e}};var e,i,n,o,r,s={L:1,M:0,Q:3,H:2},a=(e=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],i=1335,n=7973,r=function(t){for(var e=0;0!=t;)e+=1,t>>>=1;return e},(o={}).getBCHTypeInfo=function(t){for(var e=t<<10;r(e)-r(i)>=0;)e^=i<<r(e)-r(i);return 21522^(t<<10|e)},o.getBCHTypeNumber=function(t){for(var e=t<<12;r(e)-r(n)>=0;)e^=n<<r(e)-r(n);return t<<12|e},o.getPatternPosition=function(t){return e[t-1]},o.getMaskFunction=function(t){switch(t){case 0:return function(t,e){return(t+e)%2==0};case 1:return function(t,e){return t%2==0};case 2:return function(t,e){return e%3==0};case 3:return function(t,e){return(t+e)%3==0};case 4:return function(t,e){return(Math.floor(t/2)+Math.floor(e/3))%2==0};case 5:return function(t,e){return t*e%2+t*e%3==0};case 6:return function(t,e){return(t*e%2+t*e%3)%2==0};case 7:return function(t,e){return(t*e%3+(t+e)%2)%2==0};default:throw"bad maskPattern:"+t}},o.getErrorCorrectPolynomial=function(t){for(var e=d([1],0),i=0;i<t;i+=1)e=e.multiply(d([1,l.gexp(i)],0));return e},o.getLengthInBits=function(t,e){if(1<=e&&e<10)switch(t){case 1:return 10;case 2:return 9;case 4:case 8:return 8;default:throw"mode:"+t}else if(e<27)switch(t){case 1:return 12;case 2:return 11;case 4:return 16;case 8:return 10;default:throw"mode:"+t}else{if(!(e<41))throw"type:"+e;switch(t){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw"mode:"+t}}},o.getLostPoint=function(t){for(var e=t.getModuleCount(),i=0,n=0;n<e;n+=1)for(var o=0;o<e;o+=1){for(var r=0,s=t.isDark(n,o),a=-1;a<=1;a+=1)if(!(n+a<0||e<=n+a))for(var l=-1;l<=1;l+=1)o+l<0||e<=o+l||0==a&&0==l||s==t.isDark(n+a,o+l)&&(r+=1);r>5&&(i+=3+r-5)}for(n=0;n<e-1;n+=1)for(o=0;o<e-1;o+=1){var d=0;t.isDark(n,o)&&(d+=1),t.isDark(n+1,o)&&(d+=1),t.isDark(n,o+1)&&(d+=1),t.isDark(n+1,o+1)&&(d+=1),0!=d&&4!=d||(i+=3)}for(n=0;n<e;n+=1)for(o=0;o<e-6;o+=1)t.isDark(n,o)&&!t.isDark(n,o+1)&&t.isDark(n,o+2)&&t.isDark(n,o+3)&&t.isDark(n,o+4)&&!t.isDark(n,o+5)&&t.isDark(n,o+6)&&(i+=40);for(o=0;o<e;o+=1)for(n=0;n<e-6;n+=1)t.isDark(n,o)&&!t.isDark(n+1,o)&&t.isDark(n+2,o)&&t.isDark(n+3,o)&&t.isDark(n+4,o)&&!t.isDark(n+5,o)&&t.isDark(n+6,o)&&(i+=40);var c=0;for(o=0;o<e;o+=1)for(n=0;n<e;n+=1)t.isDark(n,o)&&(c+=1);return i+Math.abs(100*c/e/e-50)/5*10},o),l=function(){for(var t=new Array(256),e=new Array(256),i=0;i<8;i+=1)t[i]=1<<i;for(i=8;i<256;i+=1)t[i]=t[i-4]^t[i-5]^t[i-6]^t[i-8];for(i=0;i<255;i+=1)e[t[i]]=i;return{glog:function(t){if(t<1)throw"glog("+t+")";return e[t]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return t[e]}}}();function d(t,e){if(void 0===t.length)throw t.length+"/"+e;var i=function(){for(var i=0;i<t.length&&0==t[i];)i+=1;for(var n=new Array(t.length-i+e),o=0;o<t.length-i;o+=1)n[o]=t[o+i];return n}(),n={getAt:function(t){return i[t]},getLength:function(){return i.length},multiply:function(t){for(var e=new Array(n.getLength()+t.getLength()-1),i=0;i<n.getLength();i+=1)for(var o=0;o<t.getLength();o+=1)e[i+o]^=l.gexp(l.glog(n.getAt(i))+l.glog(t.getAt(o)));return d(e,0)},mod:function(t){if(n.getLength()-t.getLength()<0)return n;for(var e=l.glog(n.getAt(0))-l.glog(t.getAt(0)),i=new Array(n.getLength()),o=0;o<n.getLength();o+=1)i[o]=n.getAt(o);for(o=0;o<t.getLength();o+=1)i[o]^=l.gexp(l.glog(t.getAt(o))+e);return d(i,0).mod(t)}};return n}var c=function(){var t=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e=function(t,e){var i={};return i.totalCount=t,i.dataCount=e,i},i={getRSBlocks:function(i,n){var o=function(e,i){switch(i){case s.L:return t[4*(e-1)+0];case s.M:return t[4*(e-1)+1];case s.Q:return t[4*(e-1)+2];case s.H:return t[4*(e-1)+3];default:return}}(i,n);if(void 0===o)throw"bad rs block @ typeNumber:"+i+"/errorCorrectionLevel:"+n;for(var r=o.length/3,a=[],l=0;l<r;l+=1)for(var d=o[3*l+0],c=o[3*l+1],u=o[3*l+2],h=0;h<d;h+=1)a.push(e(c,u));return a}};return i}(),u=function(){var t=[],e=0,i={getBuffer:function(){return t},getAt:function(e){var i=Math.floor(e/8);return 1==(t[i]>>>7-e%8&1)},put:function(t,e){for(var n=0;n<e;n+=1)i.putBit(1==(t>>>e-n-1&1))},getLengthInBits:function(){return e},putBit:function(i){var n=Math.floor(e/8);t.length<=n&&t.push(0),i&&(t[n]|=128>>>e%8),e+=1}};return i},h=function(t){var e=t,i={getMode:function(){return 1},getLength:function(t){return e.length},write:function(t){for(var i=e,o=0;o+2<i.length;)t.put(n(i.substring(o,o+3)),10),o+=3;o<i.length&&(i.length-o==1?t.put(n(i.substring(o,o+1)),4):i.length-o==2&&t.put(n(i.substring(o,o+2)),7))}},n=function(t){for(var e=0,i=0;i<t.length;i+=1)e=10*e+o(t.charAt(i));return e},o=function(t){if("0"<=t&&t<="9")return t.charCodeAt(0)-"0".charCodeAt(0);throw"illegal char :"+t};return i},p=function(t){var e=t,i={getMode:function(){return 2},getLength:function(t){return e.length},write:function(t){for(var i=e,o=0;o+1<i.length;)t.put(45*n(i.charAt(o))+n(i.charAt(o+1)),11),o+=2;o<i.length&&t.put(n(i.charAt(o)),6)}},n=function(t){if("0"<=t&&t<="9")return t.charCodeAt(0)-"0".charCodeAt(0);if("A"<=t&&t<="Z")return t.charCodeAt(0)-"A".charCodeAt(0)+10;switch(t){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+t}};return i},m=function(e){var i=t.stringToBytes(e);return{getMode:function(){return 4},getLength:function(t){return i.length},write:function(t){for(var e=0;e<i.length;e+=1)t.put(i[e],8)}}},g=function(e){var i=t.stringToBytesFuncs.SJIS;if(!i)throw"sjis not supported.";!function(){var t=i("友");if(2!=t.length||38726!=(t[0]<<8|t[1]))throw"sjis not supported."}();var n=i(e),o={getMode:function(){return 8},getLength:function(t){return~~(n.length/2)},write:function(t){for(var e=n,i=0;i+1<e.length;){var o=(255&e[i])<<8|255&e[i+1];if(33088<=o&&o<=40956)o-=33088;else{if(!(57408<=o&&o<=60351))throw"illegal char at "+(i+1)+"/"+o;o-=49472}o=192*(o>>>8&255)+(255&o),t.put(o,13),i+=2}if(i<e.length)throw"illegal char at "+(i+1)}};return o},f=function(){var t=[],e={writeByte:function(e){t.push(255&e)},writeShort:function(t){e.writeByte(t),e.writeByte(t>>>8)},writeBytes:function(t,i,n){i=i||0,n=n||t.length;for(var o=0;o<n;o+=1)e.writeByte(t[o+i])},writeString:function(t){for(var i=0;i<t.length;i+=1)e.writeByte(t.charCodeAt(i))},toByteArray:function(){return t},toString:function(){var e="";e+="[";for(var i=0;i<t.length;i+=1)i>0&&(e+=","),e+=t[i];return e+"]"}};return e},v=function(t){var e=t,i=0,n=0,o=0,r={read:function(){for(;o<8;){if(i>=e.length){if(0==o)return-1;throw"unexpected end of file./"+o}var t=e.charAt(i);if(i+=1,"="==t)return o=0,-1;t.match(/^\s$/)||(n=n<<6|s(t.charCodeAt(0)),o+=6)}var r=n>>>o-8&255;return o-=8,r}},s=function(t){if(65<=t&&t<=90)return t-65;if(97<=t&&t<=122)return t-97+26;if(48<=t&&t<=57)return t-48+52;if(43==t)return 62;if(47==t)return 63;throw"c:"+t};return r},y=function(t,e,i){for(var n=function(t,e){var i=t,n=e,o=new Array(t*e),r={setPixel:function(t,e,n){o[e*i+t]=n},write:function(t){t.writeString("GIF87a"),t.writeShort(i),t.writeShort(n),t.writeByte(128),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(255),t.writeByte(255),t.writeByte(255),t.writeString(","),t.writeShort(0),t.writeShort(0),t.writeShort(i),t.writeShort(n),t.writeByte(0);var e=s(2);t.writeByte(2);for(var o=0;e.length-o>255;)t.writeByte(255),t.writeBytes(e,o,255),o+=255;t.writeByte(e.length-o),t.writeBytes(e,o,e.length-o),t.writeByte(0),t.writeString(";")}},s=function(t){for(var e=1<<t,i=1+(1<<t),n=t+1,r=a(),s=0;s<e;s+=1)r.add(String.fromCharCode(s));r.add(String.fromCharCode(e)),r.add(String.fromCharCode(i));var l,d,c,u=f(),h=(l=u,d=0,c=0,{write:function(t,e){if(t>>>e!=0)throw"length over";for(;d+e>=8;)l.writeByte(255&(t<<d|c)),e-=8-d,t>>>=8-d,c=0,d=0;c|=t<<d,d+=e},flush:function(){d>0&&l.writeByte(c)}});h.write(e,n);var p=0,m=String.fromCharCode(o[p]);for(p+=1;p<o.length;){var g=String.fromCharCode(o[p]);p+=1,r.contains(m+g)?m+=g:(h.write(r.indexOf(m),n),r.size()<4095&&(r.size()==1<<n&&(n+=1),r.add(m+g)),m=g)}return h.write(r.indexOf(m),n),h.write(i,n),h.flush(),u.toByteArray()},a=function(){var t={},e=0,i={add:function(n){if(i.contains(n))throw"dup key:"+n;t[n]=e,e+=1},size:function(){return e},indexOf:function(e){return t[e]},contains:function(e){return void 0!==t[e]}};return i};return r}(t,e),o=0;o<e;o+=1)for(var r=0;r<t;r+=1)n.setPixel(r,o,i(r,o));var s=f();n.write(s);for(var a=function(){var t=0,e=0,i=0,n="",o={},r=function(t){n+=String.fromCharCode(s(63&t))},s=function(t){if(t<0);else{if(t<26)return 65+t;if(t<52)return t-26+97;if(t<62)return t-52+48;if(62==t)return 43;if(63==t)return 47}throw"n:"+t};return o.writeByte=function(n){for(t=t<<8|255&n,e+=8,i+=1;e>=6;)r(t>>>e-6),e-=6},o.flush=function(){if(e>0&&(r(t<<6-e),t=0,e=0),i%3!=0)for(var o=3-i%3,s=0;s<o;s+=1)n+="="},o.toString=function(){return n},o}(),l=s.toByteArray(),d=0;d<l.length;d+=1)a.writeByte(l[d]);return a.flush(),"data:image/gif;base64,"+a};return t}();o.stringToBytesFuncs["UTF-8"]=function(t){return function(t){for(var e=[],i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e.push(n):n<2048?e.push(192|n>>6,128|63&n):n<55296||n>=57344?e.push(224|n>>12,128|n>>6&63,128|63&n):(i++,n=65536+((1023&n)<<10|1023&t.charCodeAt(i)),e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return e}(t)},void 0===(n="function"==typeof(i=function(){return o})?i.apply(e,[]):i)||(t.exports=n)}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var n={};return(()=>{i.d(n,{default:()=>M});const t=t=>!!t&&"object"==typeof t&&!Array.isArray(t);function e(i,...n){if(!n.length)return i;const o=n.shift();return void 0!==o&&t(i)&&t(o)?(i=Object.assign({},i),Object.keys(o).forEach(n=>{const r=i[n],s=o[n];Array.isArray(r)&&Array.isArray(s)?i[n]=s:t(r)&&t(s)?i[n]=e(Object.assign({},r),s):i[n]=s}),e(i,...n)):i}function o(t,e){const i=document.createElement("a");i.download=e,i.href=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)}const r={L:.07,M:.15,Q:.25,H:.3};class s{constructor({svg:t,type:e,window:i}){this._svg=t,this._type=e,this._window=i}draw(t,e,i,n){let o;switch(this._type){case"dots":o=this._drawDot;break;case"classy":o=this._drawClassy;break;case"classy-rounded":o=this._drawClassyRounded;break;case"rounded":o=this._drawRounded;break;case"extra-rounded":o=this._drawExtraRounded;break;default:o=this._drawSquare}o.call(this,{x:t,y:e,size:i,getNeighbor:n})}_rotateFigure({x:t,y:e,size:i,rotation:n=0,draw:o}){var r;const s=t+i/2,a=e+i/2;o(),null===(r=this._element)||void 0===r||r.setAttribute("transform",`rotate(${180*n/Math.PI},${s},${a})`)}_basicDot(t){const{size:e,x:i,y:n}=t;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","circle"),this._element.setAttribute("cx",String(i+e/2)),this._element.setAttribute("cy",String(n+e/2)),this._element.setAttribute("r",String(e/2))}}))}_basicSquare(t){const{size:e,x:i,y:n}=t;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","rect"),this._element.setAttribute("x",String(i)),this._element.setAttribute("y",String(n)),this._element.setAttribute("width",String(e)),this._element.setAttribute("height",String(e))}}))}_basicSideRounded(t){const{size:e,x:i,y:n}=t;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("d",`M ${i} ${n}v ${e}h `+e/2+`a ${e/2} ${e/2}, 0, 0, 0, 0 ${-e}`)}}))}_basicCornerRounded(t){const{size:e,x:i,y:n}=t;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("d",`M ${i} ${n}v ${e}h ${e}v `+-e/2+`a ${e/2} ${e/2}, 0, 0, 0, ${-e/2} ${-e/2}`)}}))}_basicCornerExtraRounded(t){const{size:e,x:i,y:n}=t;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("d",`M ${i} ${n}v ${e}h ${e}a ${e} ${e}, 0, 0, 0, ${-e} ${-e}`)}}))}_basicCornersRounded(t){const{size:e,x:i,y:n}=t;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("d",`M ${i} ${n}v `+e/2+`a ${e/2} ${e/2}, 0, 0, 0, ${e/2} ${e/2}h `+e/2+"v "+-e/2+`a ${e/2} ${e/2}, 0, 0, 0, ${-e/2} ${-e/2}`)}}))}_drawDot({x:t,y:e,size:i}){this._basicDot({x:t,y:e,size:i,rotation:0})}_drawSquare({x:t,y:e,size:i}){this._basicSquare({x:t,y:e,size:i,rotation:0})}_drawRounded({x:t,y:e,size:i,getNeighbor:n}){const o=n?+n(-1,0):0,r=n?+n(1,0):0,s=n?+n(0,-1):0,a=n?+n(0,1):0,l=o+r+s+a;if(0!==l)if(l>2||o&&r||s&&a)this._basicSquare({x:t,y:e,size:i,rotation:0});else{if(2===l){let n=0;return o&&s?n=Math.PI/2:s&&r?n=Math.PI:r&&a&&(n=-Math.PI/2),void this._basicCornerRounded({x:t,y:e,size:i,rotation:n})}if(1===l){let n=0;return s?n=Math.PI/2:r?n=Math.PI:a&&(n=-Math.PI/2),void this._basicSideRounded({x:t,y:e,size:i,rotation:n})}}else this._basicDot({x:t,y:e,size:i,rotation:0})}_drawExtraRounded({x:t,y:e,size:i,getNeighbor:n}){const o=n?+n(-1,0):0,r=n?+n(1,0):0,s=n?+n(0,-1):0,a=n?+n(0,1):0,l=o+r+s+a;if(0!==l)if(l>2||o&&r||s&&a)this._basicSquare({x:t,y:e,size:i,rotation:0});else{if(2===l){let n=0;return o&&s?n=Math.PI/2:s&&r?n=Math.PI:r&&a&&(n=-Math.PI/2),void this._basicCornerExtraRounded({x:t,y:e,size:i,rotation:n})}if(1===l){let n=0;return s?n=Math.PI/2:r?n=Math.PI:a&&(n=-Math.PI/2),void this._basicSideRounded({x:t,y:e,size:i,rotation:n})}}else this._basicDot({x:t,y:e,size:i,rotation:0})}_drawClassy({x:t,y:e,size:i,getNeighbor:n}){const o=n?+n(-1,0):0,r=n?+n(1,0):0,s=n?+n(0,-1):0,a=n?+n(0,1):0;0!==o+r+s+a?o||s?r||a?this._basicSquare({x:t,y:e,size:i,rotation:0}):this._basicCornerRounded({x:t,y:e,size:i,rotation:Math.PI/2}):this._basicCornerRounded({x:t,y:e,size:i,rotation:-Math.PI/2}):this._basicCornersRounded({x:t,y:e,size:i,rotation:Math.PI/2})}_drawClassyRounded({x:t,y:e,size:i,getNeighbor:n}){const o=n?+n(-1,0):0,r=n?+n(1,0):0,s=n?+n(0,-1):0,a=n?+n(0,1):0;0!==o+r+s+a?o||s?r||a?this._basicSquare({x:t,y:e,size:i,rotation:0}):this._basicCornerExtraRounded({x:t,y:e,size:i,rotation:Math.PI/2}):this._basicCornerExtraRounded({x:t,y:e,size:i,rotation:-Math.PI/2}):this._basicCornersRounded({x:t,y:e,size:i,rotation:Math.PI/2})}}const a={dot:"dot",square:"square",extraRounded:"extra-rounded"},l=Object.values(a);class d{constructor({svg:t,type:e,window:i}){this._svg=t,this._type=e,this._window=i}draw(t,e,i,n){let o;switch(this._type){case a.square:o=this._drawSquare;break;case a.extraRounded:o=this._drawExtraRounded;break;default:o=this._drawDot}o.call(this,{x:t,y:e,size:i,rotation:n})}_rotateFigure({x:t,y:e,size:i,rotation:n=0,draw:o}){var r;const s=t+i/2,a=e+i/2;o(),null===(r=this._element)||void 0===r||r.setAttribute("transform",`rotate(${180*n/Math.PI},${s},${a})`)}_basicDot(t){const{size:e,x:i,y:n}=t,o=e/7;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("clip-rule","evenodd"),this._element.setAttribute("d",`M ${i+e/2} ${n}a ${e/2} ${e/2} 0 1 0 0.1 0zm 0 ${o}a ${e/2-o} ${e/2-o} 0 1 1 -0.1 0Z`)}}))}_basicSquare(t){const{size:e,x:i,y:n}=t,o=e/7;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("clip-rule","evenodd"),this._element.setAttribute("d",`M ${i} ${n}v ${e}h ${e}v `+-e+"z"+`M ${i+o} ${n+o}h `+(e-2*o)+"v "+(e-2*o)+"h "+(2*o-e)+"z")}}))}_basicExtraRounded(t){const{size:e,x:i,y:n}=t,o=e/7;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("clip-rule","evenodd"),this._element.setAttribute("d",`M ${i} ${n+2.5*o}v `+2*o+`a ${2.5*o} ${2.5*o}, 0, 0, 0, ${2.5*o} ${2.5*o}h `+2*o+`a ${2.5*o} ${2.5*o}, 0, 0, 0, ${2.5*o} ${2.5*-o}v `+-2*o+`a ${2.5*o} ${2.5*o}, 0, 0, 0, ${2.5*-o} ${2.5*-o}h `+-2*o+`a ${2.5*o} ${2.5*o}, 0, 0, 0, ${2.5*-o} ${2.5*o}`+`M ${i+2.5*o} ${n+o}h `+2*o+`a ${1.5*o} ${1.5*o}, 0, 0, 1, ${1.5*o} ${1.5*o}v `+2*o+`a ${1.5*o} ${1.5*o}, 0, 0, 1, ${1.5*-o} ${1.5*o}h `+-2*o+`a ${1.5*o} ${1.5*o}, 0, 0, 1, ${1.5*-o} ${1.5*-o}v `+-2*o+`a ${1.5*o} ${1.5*o}, 0, 0, 1, ${1.5*o} ${1.5*-o}`)}}))}_drawDot({x:t,y:e,size:i,rotation:n}){this._basicDot({x:t,y:e,size:i,rotation:n})}_drawSquare({x:t,y:e,size:i,rotation:n}){this._basicSquare({x:t,y:e,size:i,rotation:n})}_drawExtraRounded({x:t,y:e,size:i,rotation:n}){this._basicExtraRounded({x:t,y:e,size:i,rotation:n})}}const c={dot:"dot",square:"square"},u=Object.values(c);class h{constructor({svg:t,type:e,window:i}){this._svg=t,this._type=e,this._window=i}draw(t,e,i,n){let o;o=this._type===c.square?this._drawSquare:this._drawDot,o.call(this,{x:t,y:e,size:i,rotation:n})}_rotateFigure({x:t,y:e,size:i,rotation:n=0,draw:o}){var r;const s=t+i/2,a=e+i/2;o(),null===(r=this._element)||void 0===r||r.setAttribute("transform",`rotate(${180*n/Math.PI},${s},${a})`)}_basicDot(t){const{size:e,x:i,y:n}=t;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","circle"),this._element.setAttribute("cx",String(i+e/2)),this._element.setAttribute("cy",String(n+e/2)),this._element.setAttribute("r",String(e/2))}}))}_basicSquare(t){const{size:e,x:i,y:n}=t;this._rotateFigure(Object.assign(Object.assign({},t),{draw:()=>{this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","rect"),this._element.setAttribute("x",String(i)),this._element.setAttribute("y",String(n)),this._element.setAttribute("width",String(e)),this._element.setAttribute("height",String(e))}}))}_drawDot({x:t,y:e,size:i,rotation:n}){this._basicDot({x:t,y:e,size:i,rotation:n})}_drawSquare({x:t,y:e,size:i,rotation:n}){this._basicSquare({x:t,y:e,size:i,rotation:n})}}const p="circle",m=[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],g=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]];class f{constructor(t,e){this._roundSize=t=>this._options.dotsOptions.roundSize?Math.floor(t):t,this._window=e,this._element=this._window.document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("width",String(t.width)),this._element.setAttribute("height",String(t.height)),this._element.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.dotsOptions.roundSize||this._element.setAttribute("shape-rendering","crispEdges"),this._element.setAttribute("viewBox",`0 0 ${t.width} ${t.height}`),this._defs=this._window.document.createElementNS("http://www.w3.org/2000/svg","defs"),this._element.appendChild(this._defs),this._imageUri=t.image,this._instanceId=f.instanceCount++,this._options=t}get width(){return this._options.width}get height(){return this._options.height}getElement(){return this._element}async drawQR(t){const e=t.getModuleCount(),i=Math.min(this._options.width,this._options.height)-2*this._options.margin,n=this._options.shape===p?i/Math.sqrt(2):i,o=this._roundSize(n/e);let s={hideXDots:0,hideYDots:0,width:0,height:0};if(this._qr=t,this._options.image){if(await this.loadImage(),!this._image)return;const{imageOptions:t,qrOptions:i}=this._options,n=t.imageSize*r[i.errorCorrectionLevel],a=Math.floor(n*e*e);s=function({originalHeight:t,originalWidth:e,maxHiddenDots:i,maxHiddenAxisDots:n,dotSize:o}){const r={x:0,y:0},s={x:0,y:0};if(t<=0||e<=0||i<=0||o<=0)return{height:0,width:0,hideYDots:0,hideXDots:0};const a=t/e;return r.x=Math.floor(Math.sqrt(i/a)),r.x<=0&&(r.x=1),n&&n<r.x&&(r.x=n),r.x%2==0&&r.x--,s.x=r.x*o,r.y=1+2*Math.ceil((r.x*a-1)/2),s.y=Math.round(s.x*a),(r.y*r.x>i||n&&n<r.y)&&(n&&n<r.y?(r.y=n,r.y%2==0&&r.x--):r.y-=2,s.y=r.y*o,r.x=1+2*Math.ceil((r.y/a-1)/2),s.x=Math.round(s.y/a)),{height:s.y,width:s.x,hideYDots:r.y,hideXDots:r.x}}({originalWidth:this._image.width,originalHeight:this._image.height,maxHiddenDots:a,maxHiddenAxisDots:e-14,dotSize:o})}this.drawBackground(),this.drawDots((t,i)=>{var n,o,r,a,l,d;return!(this._options.imageOptions.hideBackgroundDots&&t>=(e-s.hideYDots)/2&&t<(e+s.hideYDots)/2&&i>=(e-s.hideXDots)/2&&i<(e+s.hideXDots)/2||(null===(n=m[t])||void 0===n?void 0:n[i])||(null===(o=m[t-e+7])||void 0===o?void 0:o[i])||(null===(r=m[t])||void 0===r?void 0:r[i-e+7])||(null===(a=g[t])||void 0===a?void 0:a[i])||(null===(l=g[t-e+7])||void 0===l?void 0:l[i])||(null===(d=g[t])||void 0===d?void 0:d[i-e+7]))}),this.drawCorners(),this._options.image&&await this.drawImage({width:s.width,height:s.height,count:e,dotSize:o})}drawBackground(){var t,e,i;const n=this._element,o=this._options;if(n){const n=null===(t=o.backgroundOptions)||void 0===t?void 0:t.gradient,r=null===(e=o.backgroundOptions)||void 0===e?void 0:e.color;let s=o.height,a=o.width;if(n||r){const t=this._window.document.createElementNS("http://www.w3.org/2000/svg","rect");this._backgroundClipPath=this._window.document.createElementNS("http://www.w3.org/2000/svg","clipPath"),this._backgroundClipPath.setAttribute("id",`clip-path-background-color-${this._instanceId}`),this._defs.appendChild(this._backgroundClipPath),(null===(i=o.backgroundOptions)||void 0===i?void 0:i.round)&&(s=a=Math.min(o.width,o.height),t.setAttribute("rx",String(s/2*o.backgroundOptions.round))),t.setAttribute("x",String(this._roundSize((o.width-a)/2))),t.setAttribute("y",String(this._roundSize((o.height-s)/2))),t.setAttribute("width",String(a)),t.setAttribute("height",String(s)),this._backgroundClipPath.appendChild(t),this._createColor({options:n,color:r,additionalRotation:0,x:0,y:0,height:o.height,width:o.width,name:`background-color-${this._instanceId}`})}}}drawDots(t){var e,i;if(!this._qr)throw"QR code is not defined";const n=this._options,o=this._qr.getModuleCount();if(o>n.width||o>n.height)throw"The canvas is too small.";const r=Math.min(n.width,n.height)-2*n.margin,a=n.shape===p?r/Math.sqrt(2):r,l=this._roundSize(a/o),d=this._roundSize((n.width-o*l)/2),c=this._roundSize((n.height-o*l)/2),u=new s({svg:this._element,type:n.dotsOptions.type,window:this._window});this._dotsClipPath=this._window.document.createElementNS("http://www.w3.org/2000/svg","clipPath"),this._dotsClipPath.setAttribute("id",`clip-path-dot-color-${this._instanceId}`),this._defs.appendChild(this._dotsClipPath),this._createColor({options:null===(e=n.dotsOptions)||void 0===e?void 0:e.gradient,color:n.dotsOptions.color,additionalRotation:0,x:0,y:0,height:n.height,width:n.width,name:`dot-color-${this._instanceId}`});for(let e=0;e<o;e++)for(let n=0;n<o;n++)t&&!t(e,n)||(null===(i=this._qr)||void 0===i?void 0:i.isDark(e,n))&&(u.draw(d+n*l,c+e*l,l,(i,r)=>!(n+i<0||e+r<0||n+i>=o||e+r>=o)&&!(t&&!t(e+r,n+i))&&!!this._qr&&this._qr.isDark(e+r,n+i)),u._element&&this._dotsClipPath&&this._dotsClipPath.appendChild(u._element));if(n.shape===p){const t=this._roundSize((r/l-o)/2),e=o+2*t,i=d-t*l,n=c-t*l,s=[],a=this._roundSize(e/2);for(let i=0;i<e;i++){s[i]=[];for(let n=0;n<e;n++)i>=t-1&&i<=e-t&&n>=t-1&&n<=e-t||Math.sqrt((i-a)*(i-a)+(n-a)*(n-a))>a?s[i][n]=0:s[i][n]=this._qr.isDark(n-2*t<0?n:n>=o?n-2*t:n-t,i-2*t<0?i:i>=o?i-2*t:i-t)?1:0}for(let t=0;t<e;t++)for(let o=0;o<e;o++)s[t][o]&&(u.draw(i+o*l,n+t*l,l,(e,i)=>{var n;return!!(null===(n=s[t+i])||void 0===n?void 0:n[o+e])}),u._element&&this._dotsClipPath&&this._dotsClipPath.appendChild(u._element))}}drawCorners(){if(!this._qr)throw"QR code is not defined";const t=this._element,e=this._options;if(!t)throw"Element code is not defined";const i=this._qr.getModuleCount(),n=Math.min(e.width,e.height)-2*e.margin,o=e.shape===p?n/Math.sqrt(2):n,r=this._roundSize(o/i),a=7*r,c=3*r,f=this._roundSize((e.width-i*r)/2),v=this._roundSize((e.height-i*r)/2);[[0,0,0],[1,0,Math.PI/2],[0,1,-Math.PI/2]].forEach(([t,n,o])=>{var p,y,A,b,w,E,x,S,$,_,M,k,C,R;const O=f+t*r*(i-7),P=v+n*r*(i-7);let I=this._dotsClipPath,D=this._dotsClipPath;if(((null===(p=e.cornersSquareOptions)||void 0===p?void 0:p.gradient)||(null===(y=e.cornersSquareOptions)||void 0===y?void 0:y.color))&&(I=this._window.document.createElementNS("http://www.w3.org/2000/svg","clipPath"),I.setAttribute("id",`clip-path-corners-square-color-${t}-${n}-${this._instanceId}`),this._defs.appendChild(I),this._cornersSquareClipPath=this._cornersDotClipPath=D=I,this._createColor({options:null===(A=e.cornersSquareOptions)||void 0===A?void 0:A.gradient,color:null===(b=e.cornersSquareOptions)||void 0===b?void 0:b.color,additionalRotation:o,x:O,y:P,height:a,width:a,name:`corners-square-color-${t}-${n}-${this._instanceId}`})),(null===(w=e.cornersSquareOptions)||void 0===w?void 0:w.type)&&l.includes(e.cornersSquareOptions.type)){const t=new d({svg:this._element,type:e.cornersSquareOptions.type,window:this._window});t.draw(O,P,a,o),t._element&&I&&I.appendChild(t._element)}else{const t=new s({svg:this._element,type:(null===(E=e.cornersSquareOptions)||void 0===E?void 0:E.type)||e.dotsOptions.type,window:this._window});for(let e=0;e<m.length;e++)for(let i=0;i<m[e].length;i++)(null===(x=m[e])||void 0===x?void 0:x[i])&&(t.draw(O+i*r,P+e*r,r,(t,n)=>{var o;return!!(null===(o=m[e+n])||void 0===o?void 0:o[i+t])}),t._element&&I&&I.appendChild(t._element))}if(((null===(S=e.cornersDotOptions)||void 0===S?void 0:S.gradient)||(null===($=e.cornersDotOptions)||void 0===$?void 0:$.color))&&(D=this._window.document.createElementNS("http://www.w3.org/2000/svg","clipPath"),D.setAttribute("id",`clip-path-corners-dot-color-${t}-${n}-${this._instanceId}`),this._defs.appendChild(D),this._cornersDotClipPath=D,this._createColor({options:null===(_=e.cornersDotOptions)||void 0===_?void 0:_.gradient,color:null===(M=e.cornersDotOptions)||void 0===M?void 0:M.color,additionalRotation:o,x:O+2*r,y:P+2*r,height:c,width:c,name:`corners-dot-color-${t}-${n}-${this._instanceId}`})),(null===(k=e.cornersDotOptions)||void 0===k?void 0:k.type)&&u.includes(e.cornersDotOptions.type)){const t=new h({svg:this._element,type:e.cornersDotOptions.type,window:this._window});t.draw(O+2*r,P+2*r,c,o),t._element&&D&&D.appendChild(t._element)}else{const t=new s({svg:this._element,type:(null===(C=e.cornersDotOptions)||void 0===C?void 0:C.type)||e.dotsOptions.type,window:this._window});for(let e=0;e<g.length;e++)for(let i=0;i<g[e].length;i++)(null===(R=g[e])||void 0===R?void 0:R[i])&&(t.draw(O+i*r,P+e*r,r,(t,n)=>{var o;return!!(null===(o=g[e+n])||void 0===o?void 0:o[i+t])}),t._element&&D&&D.appendChild(t._element))}})}loadImage(){return new Promise((t,e)=>{var i;const n=this._options;if(!n.image)return e("Image is not defined");if(null===(i=n.nodeCanvas)||void 0===i?void 0:i.loadImage)n.nodeCanvas.loadImage(n.image).then(e=>{var i,o;if(this._image=e,this._options.imageOptions.saveAsBlob){const t=null===(i=n.nodeCanvas)||void 0===i?void 0:i.createCanvas(this._image.width,this._image.height);null===(o=null==t?void 0:t.getContext("2d"))||void 0===o||o.drawImage(e,0,0),this._imageUri=null==t?void 0:t.toDataURL()}t()}).catch(e);else{const e=new this._window.Image;"string"==typeof n.imageOptions.crossOrigin&&(e.crossOrigin=n.imageOptions.crossOrigin),this._image=e,e.onload=async()=>{this._options.imageOptions.saveAsBlob&&(this._imageUri=await async function(t,e){return new Promise(i=>{const n=new e.XMLHttpRequest;n.onload=function(){const t=new e.FileReader;t.onloadend=function(){i(t.result)},t.readAsDataURL(n.response)},n.open("GET",t),n.responseType="blob",n.send()})}(n.image||"",this._window)),t()},e.src=n.image}})}async drawImage({width:t,height:e,count:i,dotSize:n}){const o=this._options,r=this._roundSize((o.width-i*n)/2),s=this._roundSize((o.height-i*n)/2),a=r+this._roundSize(o.imageOptions.margin+(i*n-t)/2),l=s+this._roundSize(o.imageOptions.margin+(i*n-e)/2),d=t-2*o.imageOptions.margin,c=e-2*o.imageOptions.margin,u=this._window.document.createElementNS("http://www.w3.org/2000/svg","image");u.setAttribute("href",this._imageUri||""),u.setAttribute("xlink:href",this._imageUri||""),u.setAttribute("x",String(a)),u.setAttribute("y",String(l)),u.setAttribute("width",`${d}px`),u.setAttribute("height",`${c}px`),this._element.appendChild(u)}_createColor({options:t,color:e,additionalRotation:i,x:n,y:o,height:r,width:s,name:a}){const l=s>r?s:r,d=this._window.document.createElementNS("http://www.w3.org/2000/svg","rect");if(d.setAttribute("x",String(n)),d.setAttribute("y",String(o)),d.setAttribute("height",String(r)),d.setAttribute("width",String(s)),d.setAttribute("clip-path",`url('#clip-path-${a}')`),t){let e;if("radial"===t.type)e=this._window.document.createElementNS("http://www.w3.org/2000/svg","radialGradient"),e.setAttribute("id",a),e.setAttribute("gradientUnits","userSpaceOnUse"),e.setAttribute("fx",String(n+s/2)),e.setAttribute("fy",String(o+r/2)),e.setAttribute("cx",String(n+s/2)),e.setAttribute("cy",String(o+r/2)),e.setAttribute("r",String(l/2));else{const l=((t.rotation||0)+i)%(2*Math.PI),d=(l+2*Math.PI)%(2*Math.PI);let c=n+s/2,u=o+r/2,h=n+s/2,p=o+r/2;d>=0&&d<=.25*Math.PI||d>1.75*Math.PI&&d<=2*Math.PI?(c-=s/2,u-=r/2*Math.tan(l),h+=s/2,p+=r/2*Math.tan(l)):d>.25*Math.PI&&d<=.75*Math.PI?(u-=r/2,c-=s/2/Math.tan(l),p+=r/2,h+=s/2/Math.tan(l)):d>.75*Math.PI&&d<=1.25*Math.PI?(c+=s/2,u+=r/2*Math.tan(l),h-=s/2,p-=r/2*Math.tan(l)):d>1.25*Math.PI&&d<=1.75*Math.PI&&(u+=r/2,c+=s/2/Math.tan(l),p-=r/2,h-=s/2/Math.tan(l)),e=this._window.document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),e.setAttribute("id",a),e.setAttribute("gradientUnits","userSpaceOnUse"),e.setAttribute("x1",String(Math.round(c))),e.setAttribute("y1",String(Math.round(u))),e.setAttribute("x2",String(Math.round(h))),e.setAttribute("y2",String(Math.round(p)))}t.colorStops.forEach(({offset:t,color:i})=>{const n=this._window.document.createElementNS("http://www.w3.org/2000/svg","stop");n.setAttribute("offset",100*t+"%"),n.setAttribute("stop-color",i),e.appendChild(n)}),d.setAttribute("fill",`url('#${a}')`),this._defs.appendChild(e)}else e&&d.setAttribute("fill",e);this._element.appendChild(d)}}f.instanceCount=0;const v=f,y="canvas",A={};for(let t=0;t<=40;t++)A[t]=t;const b={type:y,shape:"square",width:300,height:300,data:"",margin:0,qrOptions:{typeNumber:A[0],mode:void 0,errorCorrectionLevel:"Q"},imageOptions:{saveAsBlob:!0,hideBackgroundDots:!0,imageSize:.4,crossOrigin:void 0,margin:0},dotsOptions:{type:"square",color:"#000",roundSize:!0},backgroundOptions:{round:0,color:"#fff"}};function w(t){const e=Object.assign({},t);if(!e.colorStops||!e.colorStops.length)throw"Field 'colorStops' is required in gradient";return e.rotation?e.rotation=Number(e.rotation):e.rotation=0,e.colorStops=e.colorStops.map(t=>Object.assign(Object.assign({},t),{offset:Number(t.offset)})),e}function E(t){const e=Object.assign({},t);return e.width=Number(e.width),e.height=Number(e.height),e.margin=Number(e.margin),e.imageOptions=Object.assign(Object.assign({},e.imageOptions),{hideBackgroundDots:Boolean(e.imageOptions.hideBackgroundDots),imageSize:Number(e.imageOptions.imageSize),margin:Number(e.imageOptions.margin)}),e.margin>Math.min(e.width,e.height)&&(e.margin=Math.min(e.width,e.height)),e.dotsOptions=Object.assign({},e.dotsOptions),e.dotsOptions.gradient&&(e.dotsOptions.gradient=w(e.dotsOptions.gradient)),e.cornersSquareOptions&&(e.cornersSquareOptions=Object.assign({},e.cornersSquareOptions),e.cornersSquareOptions.gradient&&(e.cornersSquareOptions.gradient=w(e.cornersSquareOptions.gradient))),e.cornersDotOptions&&(e.cornersDotOptions=Object.assign({},e.cornersDotOptions),e.cornersDotOptions.gradient&&(e.cornersDotOptions.gradient=w(e.cornersDotOptions.gradient))),e.backgroundOptions&&(e.backgroundOptions=Object.assign({},e.backgroundOptions),e.backgroundOptions.gradient&&(e.backgroundOptions.gradient=w(e.backgroundOptions.gradient))),e}var x=i(873),S=i.n(x);function $(t){if(!t)throw new Error("Extension must be defined");"."===t[0]&&(t=t.substring(1));const e={bmp:"image/bmp",gif:"image/gif",ico:"image/vnd.microsoft.icon",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",webp:"image/webp",pdf:"application/pdf"}[t.toLowerCase()];if(!e)throw new Error(`Extension "${t}" is not supported`);return e}class _{constructor(t){(null==t?void 0:t.jsdom)?this._window=new t.jsdom("",{resources:"usable"}).window:this._window=window,this._options=t?E(e(b,t)):b,this.update()}static _clearContainer(t){t&&(t.innerHTML="")}_setupSvg(){if(!this._qr)return;const t=new v(this._options,this._window);this._svg=t.getElement(),this._svgDrawingPromise=t.drawQR(this._qr).then(()=>{var e;this._svg&&(null===(e=this._extension)||void 0===e||e.call(this,t.getElement(),this._options))})}_setupCanvas(){var t,e;this._qr&&((null===(t=this._options.nodeCanvas)||void 0===t?void 0:t.createCanvas)?(this._nodeCanvas=this._options.nodeCanvas.createCanvas(this._options.width,this._options.height),this._nodeCanvas.width=this._options.width,this._nodeCanvas.height=this._options.height):(this._domCanvas=document.createElement("canvas"),this._domCanvas.width=this._options.width,this._domCanvas.height=this._options.height),this._setupSvg(),this._canvasDrawingPromise=null===(e=this._svgDrawingPromise)||void 0===e?void 0:e.then(()=>{var t;if(!this._svg)return;const e=this._svg,i=(new this._window.XMLSerializer).serializeToString(e),n=btoa(i),o=`data:${$("svg")};base64,${n}`;if(null===(t=this._options.nodeCanvas)||void 0===t?void 0:t.loadImage)return this._options.nodeCanvas.loadImage(o).then(t=>{var e,i;t.width=this._options.width,t.height=this._options.height,null===(i=null===(e=this._nodeCanvas)||void 0===e?void 0:e.getContext("2d"))||void 0===i||i.drawImage(t,0,0)});{const t=new this._window.Image;return new Promise(e=>{t.onload=()=>{var i,n;null===(n=null===(i=this._domCanvas)||void 0===i?void 0:i.getContext("2d"))||void 0===n||n.drawImage(t,0,0),e()},t.src=o})}}))}async _getElement(t="png"){if(!this._qr)throw"QR code is empty";return"svg"===t.toLowerCase()?(this._svg&&this._svgDrawingPromise||this._setupSvg(),await this._svgDrawingPromise,this._svg):((this._domCanvas||this._nodeCanvas)&&this._canvasDrawingPromise||this._setupCanvas(),await this._canvasDrawingPromise,this._domCanvas||this._nodeCanvas)}update(t){_._clearContainer(this._container),this._options=t?E(e(this._options,t)):this._options,this._options.data&&(this._qr=S()(this._options.qrOptions.typeNumber,this._options.qrOptions.errorCorrectionLevel),this._qr.addData(this._options.data,this._options.qrOptions.mode||function(t){switch(!0){case/^[0-9]*$/.test(t):return"Numeric";case/^[0-9A-Z $%*+\-./:]*$/.test(t):return"Alphanumeric";default:return"Byte"}}(this._options.data)),this._qr.make(),this._options.type===y?this._setupCanvas():this._setupSvg(),this.append(this._container))}append(t){if(t){if("function"!=typeof t.appendChild)throw"Container should be a single DOM node";this._options.type===y?this._domCanvas&&t.appendChild(this._domCanvas):this._svg&&t.appendChild(this._svg),this._container=t}}applyExtension(t){if(!t)throw"Extension function should be defined.";this._extension=t,this.update()}deleteExtension(){this._extension=void 0,this.update()}async getRawData(t="png"){if(!this._qr)throw"QR code is empty";const e=await this._getElement(t),i=$(t);if(!e)return null;if("svg"===t.toLowerCase()){const t=`<?xml version="1.0" standalone="no"?>\r\n${(new this._window.XMLSerializer).serializeToString(e)}`;return"undefined"==typeof Blob||this._options.jsdom?Buffer.from(t):new Blob([t],{type:i})}return new Promise(t=>{const n=e;if("toBuffer"in n)if("image/png"===i)t(n.toBuffer(i));else if("image/jpeg"===i)t(n.toBuffer(i));else{if("application/pdf"!==i)throw Error("Unsupported extension");t(n.toBuffer(i))}else"toBlob"in n&&n.toBlob(t,i,1)})}async download(t){if(!this._qr)throw"QR code is empty";if("undefined"==typeof Blob)throw"Cannot download in Node.js, call getRawData instead.";let e="png",i="qr";"string"==typeof t?(e=t,console.warn("Extension is deprecated as argument for 'download' method, please pass object { name: '...', extension: '...' } as argument")):"object"==typeof t&&null!==t&&(t.name&&(i=t.name),t.extension&&(e=t.extension));const n=await this._getElement(e);if(n)if("svg"===e.toLowerCase()){let t=(new XMLSerializer).serializeToString(n);t='<?xml version="1.0" standalone="no"?>\r\n'+t,o(`data:${$(e)};charset=utf-8,${encodeURIComponent(t)}`,`${i}.svg`)}else o(n.toDataURL($(e)),`${i}.${e}`)}}const M=_})(),n.default})())),Ni.exports),ji=Fi(qi);let Ui=class extends(ti(ei)){firstUpdated(t){super.firstUpdated(t),this.getImageSource().then(t=>{t?this.imageElement.src=t:console.error("[ERROR] No image source provided")})}async generateQrCode(){var t,e,i;const n=null===(t=this.document)||void 0===t?void 0:t.content,o=null==n?void 0:n.value;if(!o)return console.error("[ERROR] No QR content provided"),"";const r=n.shape||"square",s=n.background||"#fff",a=n.dotsOptions||{type:"square",color:"#000"},l=n.cornersOptions||{type:"square",color:"#000"};try{const t=new ji({width:null!==(e=this.offsetWidth)&&void 0!==e?e:300,height:null!==(i=this.offsetHeight)&&void 0!==i?i:300,data:o,type:"svg",shape:r,backgroundOptions:{color:s},dotsOptions:{color:a.color,type:a.type},cornersSquareOptions:{color:l.color,type:l.type}}),n=await t.getRawData("svg");return await this.blobToDataURL(n)}catch(t){return console.error("[ERROR] Error generating QR code",t),""}}blobToDataURL(t){return new Promise((e,i)=>{if(t instanceof Buffer){const i=t.toString("base64");e(`data:image/svg+xml;base64,${i}`)}else{const n=new FileReader;n.onloadend=()=>e(n.result),n.onerror=i,n.readAsDataURL(t)}})}async getImageSource(){var t;const e=null===(t=this.document)||void 0===t?void 0:t.content;return(null==e?void 0:e.value)?await this.generateQrCode():(console.error("[ERROR] No content provided"),"./static_images/no-signal.png")}render(){return super.render(),ii(W`<img />`)}};Ui.styles=[...Ne.styles,l`
      :host {
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: transparent;
      }
      img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background-color: transparent;
      }
    `],t([gt("img"),e("design:type",HTMLImageElement)],Ui.prototype,"imageElement",void 0),Ui=t([ct("qr-code-renderer")],Ui);let Wi=class extends Pi{constructor(){super(...arguments),this.qrType="url",this.details={},this.shape="square",this.background="#fff",this.dotsOptions={type:"square",color:"#000"},this.cornersOptions={type:"square",color:"#000"},this.preview=""}firstUpdated(t){super.firstUpdated(t),this.content&&(this.qrType=this.content.qrType||"url",this.details=this.parseQrContent(this.qrType,this.content.value||""),this.shape=this.content.shape||"square",this.background=this.content.background||"#fff",this.dotsOptions=this.content.dotsOptions||{type:"square",color:"#000"},this.cornersOptions=this.content.cornersOptions||{type:"square",color:"#000"},this.generateQrCode().then())}parseQrContent(t,e){const i={};switch(t){case"url":i.url=e;break;case"text":i.text=e;break;case"phone":i.phone=e.replace(/^tel:/,"");break;case"sms":{const t=e.match(/^sms:([^?]+)(?:\?body=(.*))?$/);t&&(i.phone=t[1],i.sms=decodeURIComponent(t[2]||""));break}case"email":{const t=e.match(/^mailto:([^?]+)(?:\?subject=([^&]+)&body=(.*))?$/);t&&(i.email=t[1],i.subject=decodeURIComponent(t[2]||""),i.body=decodeURIComponent(t[3]||""));break}case"wifi":{const t=e.match(/T:([^;]+);/),n=e.match(/S:([^;]+);/),o=e.match(/P:([^;]+);/);i.encryption=t?t[1]:"WPA",i.ssid=n?n[1]:"",i.password=o?o[1]:"";break}case"geo":{const t=e.match(/^geo:([^,]+),(.+)$/);t&&(i.lat=t[1],i.lng=t[2]);break}case"vcard":{const t=e.match(/FN:([^\n\r]+)/),n=e.match(/TEL:([^\n\r]+)/),o=e.match(/EMAIL:([^\n\r]+)/);i.name=t?t[1]:"",i.phone=n?n[1]:"",i.email=o?o[1]:"";break}}return i}getQrContent(){switch(this.qrType){case"url":return this.details.url||"";case"text":return this.details.text||"";case"phone":return`tel:${this.details.phone||""}`;case"sms":return`sms:${this.details.phone||""}?body=${encodeURIComponent(this.details.sms||"")}`;case"email":return`mailto:${this.details.email||""}?subject=${encodeURIComponent(this.details.subject||"")}&body=${encodeURIComponent(this.details.body||"")}`;case"wifi":return`WIFI:T:${this.details.encryption||"WPA"};S:${this.details.ssid||""};P:${this.details.password||""};;`;case"geo":return`geo:${this.details.lat||""},${this.details.lng||""}`;case"vcard":return`BEGIN:VCARD\nVERSION:3.0\nFN:${this.details.name||""}\nTEL:${this.details.phone||""}\nEMAIL:${this.details.email||""}\nEND:VCARD`;default:return""}}blobToDataURL(t){return new Promise((e,i)=>{if(t instanceof Buffer){const i=t.toString("base64");e(`data:image/svg+xml;base64,${i}`)}else{const n=new FileReader;n.onloadend=()=>e(n.result),n.onerror=i,n.readAsDataURL(t)}})}async generateQrCode(){const t=this.getQrContent();if(t.trim())try{const e=new ji({width:300,height:300,data:t,type:"svg",shape:this.shape,backgroundOptions:{color:this.background},dotsOptions:this.dotsOptions,cornersSquareOptions:this.cornersOptions}),i=await e.getRawData("svg"),n=await this.blobToDataURL(i);this.preview=n,this.updateContent()}catch(t){console.error("[ERROR] Could not generate QR code",t),this.updateContent()}else this.handleSave()}updateContent(){this.content={qrType:this.qrType,value:this.getQrContent(),shape:this.shape,background:this.background,dotsOptions:this.dotsOptions,cornersOptions:this.cornersOptions},this.handleSave()}async downloadQrCode(){const t=new ji({width:3e3,height:3e3,data:this.getQrContent()}),e=await t.getRawData("svg"),i=await this.blobToDataURL(e),n=document.createElement("a");n.href=i,n.download=`qr-code-${this.qrType}-${Date.now()}.svg`,n.click()}async saveToMediaAssets(){const t=new ji({width:3e3,height:3e3,data:this.getQrContent()}),e=await t.getRawData("svg"),i=await this.blobToDataURL(e);this.saveAsset(`qr-code-${this.qrType}-${Date.now()}.svg`,"image/svg+xml",i)}renderInputs(){switch(this.qrType){case"url":return W`
          <label class="block">
            URL:
            <input
              type="text"
              class="input"
              .value=${this.details.url||""}
              placeholder="Enter URL"
              @input=${t=>{this.details.url=t.target.value,this.updateContent()}}
            />
          </label>
        `;case"text":return W`
          <label class="block">
            Text:
            <input
              type="text"
              class="input"
              .value=${this.details.text||""}
              placeholder="Enter text"
              @input=${t=>{this.details.text=t.target.value,this.updateContent()}}
            />
          </label>
        `;case"phone":return W`
          <label class="block">
            Phone Number:
            <input
              type="tel"
              class="input"
              .value=${this.details.phone||""}
              placeholder="Enter phone number"
              @input=${t=>{this.details.phone=t.target.value,this.updateContent()}}
            />
          </label>
        `;case"sms":return W`
          <label class="block">
            Phone Number:
            <input
              type="tel"
              class="input"
              .value=${this.details.phone||""}
              placeholder="Enter phone number"
              @input=${t=>{this.details.phone=t.target.value,this.updateContent()}}
            />
          </label>
          <label class="block">
            SMS Message:
            <textarea
              class="input"
              .value=${this.details.sms||""}
              placeholder="Enter SMS message"
              @input=${t=>{this.details.sms=t.target.value,this.updateContent()}}
            ></textarea>
          </label>
        `;case"email":return W`
          <label class="block">
            Email Address:
            <input
              type="email"
              class="input"
              .value=${this.details.email||""}
              placeholder="Enter email address"
              @input=${t=>{this.details.email=t.target.value,this.updateContent()}}
            />
          </label>
          <label class="block">
            Subject:
            <input
              type="text"
              class="input"
              .value=${this.details.subject||""}
              placeholder="Enter subject"
              @input=${t=>{this.details.subject=t.target.value,this.updateContent()}}
            />
          </label>
          <label class="block">
            Body:
            <textarea
              class="input"
              .value=${this.details.body||""}
              placeholder="Enter body"
              @input=${t=>{this.details.body=t.target.value,this.updateContent()}}
            ></textarea>
          </label>
        `;case"wifi":return W`
          <label class="block">
            SSID:
            <input
              type="text"
              class="input"
              .value=${this.details.ssid||""}
              placeholder="Enter Wi-Fi SSID"
              @input=${t=>{this.details.ssid=t.target.value,this.updateContent()}}
            />
          </label>
          <label class="block">
            Password:
            <input
              type="password"
              class="input"
              .value=${this.details.password||""}
              placeholder="Enter Wi-Fi password"
              @input=${t=>{this.details.password=t.target.value,this.updateContent()}}
            />
          </label>
          <label class="block">
            Encryption:
            <select
              class="select"
              @change=${t=>{this.details.encryption=t.target.value,this.updateContent()}}
            >
              <option
                value="WPA"
                ?selected=${"WPA"===this.details.encryption}
              >
                WPA
              </option>
              <option
                value="WEP"
                ?selected=${"WEP"===this.details.encryption}
              >
                WEP
              </option>
              <option
                value="nopass"
                ?selected=${"nopass"===this.details.encryption}
              >
                None
              </option>
            </select>
          </label>
        `;case"geo":return W`
          <label class="block">
            Latitude:
            <input
              type="number"
              class="input"
              .value=${this.details.lat||""}
              placeholder="Enter latitude"
              @input=${t=>{this.details.lat=t.target.value,this.updateContent()}}
            />
          </label>
          <label class="block">
            Longitude:
            <input
              type="number"
              class="input"
              .value=${this.details.lng||""}
              placeholder="Enter longitude"
              @input=${t=>{this.details.lng=t.target.value,this.updateContent()}}
            />
          </label>
        `;case"vcard":return W`
          <label class="block">
            Full Name:
            <input
              type="text"
              class="input"
              .value=${this.details.name||""}
              placeholder="Enter full name"
              @input=${t=>{this.details.name=t.target.value,this.updateContent()}}
            />
          </label>
          <label class="block">
            Phone:
            <input
              type="tel"
              class="input"
              .value=${this.details.phone||""}
              placeholder="Enter phone number"
              @input=${t=>{this.details.phone=t.target.value,this.updateContent()}}
            />
          </label>
          <label class="block">
            Email:
            <input
              type="email"
              class="input"
              .value=${this.details.email||""}
              placeholder="Enter email"
              @input=${t=>{this.details.email=t.target.value,this.updateContent()}}
            />
          </label>
        `;default:return W``}}render(){return W`
      <div style="display: flex; flex-direction: row; gap: 1rem;">
        <div
          style="width: 200px; padding-right: 1rem; border-right: 1px solid #333;"
        >
          <div style="font-size: 1rem; font-weight: bold">Content</div>
          <label class="block">
            QR Code Type:
            <select
              class="select"
              @change=${t=>{this.qrType=t.target.value,this.details={},this.updateContent()}}
            >
              <option value="url" ?selected=${"url"===this.qrType}>
                URL
              </option>
              <option value="text" ?selected=${"text"===this.qrType}>
                Plain Text
              </option>
              <option value="phone" ?selected=${"phone"===this.qrType}>
                Phone
              </option>
              <option value="sms" ?selected=${"sms"===this.qrType}>
                SMS
              </option>
              <option value="email" ?selected=${"email"===this.qrType}>
                Email
              </option>
              <option value="wifi" ?selected=${"wifi"===this.qrType}>
                Wi-Fi
              </option>
              <option value="geo" ?selected=${"geo"===this.qrType}>
                Geo
              </option>
              <option value="vcard" ?selected=${"vcard"===this.qrType}>
                vCard
              </option>
            </select>
          </label>
          ${this.renderInputs()}
        </div>
        <div
          style="width: 200px; padding-right: 1rem; border-right: 1px solid #333;"
        >
          <div style="font-size: 1rem; font-weight: bold">Styling</div>

          <label class="block">
            Background Color:
            <input
              type="text"
              class="input"
              .value=${this.background}
              @input=${t=>{this.background=t.target.value,this.updateContent()}}
            />
          </label>

          <div style="margin-bottom: .5rem; border-bottom: 1px solid #333;">
            <label class="block">
              Shape:
              <select
                class="select"
                @change=${t=>{this.shape=t.target.value,this.updateContent()}}
              >
                <option value="square" ?selected=${"square"===this.shape}>
                  Square
                </option>
                <option value="circle" ?selected=${"circle"===this.shape}>
                  Circle
                </option>
              </select>
            </label>
          </div>

          <div style="margin-bottom: .5rem; border-bottom: 1px solid #333;">
            <div style="font-family: 'Courier New', monospace; color: #777">
              Dots
            </div>
            <label class="block">
              Dots Shape:
              <select
                class="select"
                @change=${t=>{this.dotsOptions={...this.dotsOptions,type:t.target.value},this.updateContent()}}
              >
                <option
                  value="square"
                  ?selected=${"square"===this.dotsOptions.type}
                >
                  Square
                </option>
                <option
                  value="dots"
                  ?selected=${"dots"===this.dotsOptions.type}
                >
                  Dots
                </option>
                <option
                  value="rounded"
                  ?selected=${"rounded"===this.dotsOptions.type}
                >
                  Rounded
                </option>
                <option
                  value="classy"
                  ?selected=${"classy"===this.dotsOptions.type}
                >
                  Classy
                </option>
                <option
                  value="classy-rounded"
                  ?selected=${"classy-rounded"===this.dotsOptions.type}
                >
                  Classy Rounded
                </option>
                <option
                  value="extra-rounded"
                  ?selected=${"extra-rounded"===this.dotsOptions.type}
                >
                  Extra Rounded
                </option>
              </select>
            </label>

            <label class="block">
              Dots Color:
              <input
                type="text"
                class="input"
                .value=${this.dotsOptions.color}
                @input=${t=>{this.dotsOptions={...this.dotsOptions,color:t.target.value},this.updateContent()}}
              />
            </label>
          </div>
          <div style="margin-top: .5rem;">
            <div style="font-family: 'Courier New', monospace; color: #777">
              Corner
            </div>
            <label class="block">
              Corner Shape:
              <select
                class="select"
                @change=${t=>{this.cornersOptions={...this.cornersOptions,type:t.target.value},this.updateContent()}}
              >
                <option
                  value="square"
                  ?selected=${"square"===this.cornersOptions.type}
                >
                  Square
                </option>
                <option
                  value="dots"
                  ?selected=${"dots"===this.cornersOptions.type}
                >
                  Dots
                </option>
                <option
                  value="rounded"
                  ?selected=${"rounded"===this.cornersOptions.type}
                >
                  Rounded
                </option>
                <option
                  value="classy"
                  ?selected=${"classy"===this.cornersOptions.type}
                >
                  Classy
                </option>
                <option
                  value="classy-rounded"
                  ?selected=${"classy-rounded"===this.cornersOptions.type}
                >
                  Classy Rounded
                </option>
                <option
                  value="extra-rounded"
                  ?selected=${"extra-rounded"===this.cornersOptions.type}
                >
                  Extra Rounded
                </option>
              </select>
            </label>

            <label class="block">
              Corner Color:
              <input
                type="text"
                class="input"
                .value=${this.cornersOptions.color}
                @input=${t=>{this.cornersOptions={...this.cornersOptions,color:t.target.value},this.updateContent()}}
              />
            </label>
          </div>
        </div>
        <div style="width: 150px;">
          <button
            style="margin-bottom: 1rem; width: 150px"
            class="button button-primary"
            @click=${this.generateQrCode}
          >
            Generate Preview
          </button>
          <div style="height: 150px; width: 150px; background-color: white;">
            ${this.preview?W`<img
                  style="width: 150px; height: 150px;"
                  src="${this.preview}"
                  alt="QR Code Preview"
                />`:""}
          </div>
          ${this.preview?W`<button
              style="margin-top: 1rem; margin-bottom: 1rem; border-top: 1px solid #333; width: 150px"
              class="button button-secondary"
              @click=${this.downloadQrCode}
            >
              Download
            </button>`:""}
          ${this.preview?W`<button
              style="margin-bottom: 1rem; width: 150px"
              class="button button-secondary"
              @click=${this.saveToMediaAssets}
            >
              Save to Media Assets
            </button>`:""}
        </div>
      </div>
    `}};Wi.styles=l`
    * {
      box-sizing: border-box;
    }

    .block {
      display: block;
      margin-bottom: 0.5rem;
    }

    label {
      margin-top: 0.5rem;
      font-size: 0.75rem;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      font-family: "Courier New", monospace;
      color: white;
      background: transparent;
      border: 1px solid #333;
    }

    button {
      font-size: 0.75rem;
      color: white;
      padding: 0.5rem;
      border: none;
      cursor: pointer;
    }

    .button:disabled {
      cursor: default;
      opacity: 0.7;
    }

    .button.button-primary {
      background: hsl(209 100% 41%);
    }

    .button.button-secondary {
      background: rgb(95 97 99);
    }

    .result {
      margin-top: 1rem;
    }
  `,t([mt(),e("design:type",String)],Wi.prototype,"qrType",void 0),t([mt(),e("design:type",Object)],Wi.prototype,"details",void 0),t([mt(),e("design:type",String)],Wi.prototype,"shape",void 0),t([mt(),e("design:type",String)],Wi.prototype,"background",void 0),t([mt(),e("design:type",Object)],Wi.prototype,"dotsOptions",void 0),t([mt(),e("design:type",Object)],Wi.prototype,"cornersOptions",void 0),t([mt(),e("design:type",String)],Wi.prototype,"preview",void 0),Wi=t([ct("qr-code-widget-settings")],Wi);let Vi=class extends(ti(ei)){constructor(){super(...arguments),this.muted=!0,this.videoPlaying=!1,this.hasPlayedOnce=!1,this.boundOnTimeUpdate=this.onTimeUpdate.bind(this),this.boundHandleKeydown=this.handleKeydown.bind(this)}connectedCallback(){super.connectedCallback(),"video"===this.mediaType&&ue().then(t=>{this.updateMuted(!t)})}disconnectedCallback(){super.disconnectedCallback(),this.videoElement&&(this.videoElement.pause(),this.videoElement.removeEventListener("timeupdate",this.boundOnTimeUpdate),this.videoElement.removeEventListener("keydown",this.boundHandleKeydown),this.videoElement.src="",this.videoElement.load())}get imageOptions(){var t,e;return(null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e["image-options"])||{}}get videoOptions(){var t,e;return(null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e["video-options"])||{}}get mediaType(){var t,e;return(null===(e=null===(t=this.document)||void 0===t?void 0:t.content)||void 0===e?void 0:e["media-type"])||"image"}firstUpdated(t){if(super.firstUpdated(t),"video"===this.mediaType)return this.displayFirstFrame(),this.setupVideoElement(),void(this.videoElement&&(this.videoElement.addEventListener("timeupdate",this.boundOnTimeUpdate),this.videoElement.addEventListener("keydown",this.boundHandleKeydown)));const e=this.getImageSource();this.imageElement&&(e?this.imageElement.src=e:console.error("[ERROR] No image source provided"))}setupVideoElement(){var t;const e=this.getVideoSource(this.document);e&&this.videoElement?(this.videoElement.pause(),this.videoElement.src=e,this.videoElement.loop=!0,this.videoElement.muted=this.muted,this.videoElement.volume=null!==(t=this.videoOptions.volume)&&void 0!==t?t:1,this.videoElement.preload="auto",this.videoElement.playsInline=!0,this.videoElement.controls=!1,this.videoElement.autoplay=!1):console.error("[ERROR] No video source provided or video element not available")}updated(t){var e,i,n,o,r,s;if(super.updated(t),"video"===this.mediaType&&this.videoElement&&(!0===this.muted&&ue().then(t=>{this.updateMuted(!t)}),t.has("document")&&this.videoElement&&(this.videoElement.volume=null!==(e=this.videoOptions.volume)&&void 0!==e?e:1),t.has("document")&&(this.setupVideoElement(),!1===this.isPlaying&&!1===this.videoPlaying&&this.updateVideoFrame()),t.has("currentTimestamp"))){if(!1===this.isPlaying&&!1===this.videoPlaying)return void this.updateVideoFrame();const t=ge(this.document);if(0===(null===(n=null===(i=this.layoutDocument)||void 0===i?void 0:i.options)||void 0===n?void 0:n.duration)&&"once"===t&&this.hasPlayedOnce)return;if(!this.videoElement)return;if("solitary"===t)return;if(this.currentTimestamp<1e3/(null!==(o=this.frameRate)&&void 0!==o?o:30)&&this.videoElement.currentTime>0){const t=ve(this.document,this.videoOptions,this.currentTimestamp);this.displayFrameAt(t)}const e=null===(r=this.document.options)||void 0===r?void 0:r.start,a=null===(s=this.document.options)||void 0===s?void 0:s.end;void 0!==e&&this.currentTimestamp<e&&this.videoStop(),void 0!==a&&this.currentTimestamp>a&&this.videoStop(),!0===this.isPlaying&&this.currentTimestamp>=e&&this.currentTimestamp<=a&&this.videoPlay()}}play(){super.play(),"video"===this.mediaType&&this.videoPlay()}pause(){super.pause(),"video"===this.mediaType&&this.videoPause()}stop(){super.stop(),"video"===this.mediaType&&this.videoStop()}async renderFrame(t){if(await super.renderFrame(t),"video"!==this.mediaType||!this.videoElement)return Promise.resolve();const e=ve(this.document,this.videoOptions,t)/1e3;return new Promise((t,i)=>{const n=setTimeout(()=>{var t;null===(t=this.videoElement)||void 0===t||t.removeEventListener("seeked",o),console.error("[ERROR] Seek operation timed out."),i(new Error("Seek operation timed out"))},5e3);function o(){var e;clearTimeout(n),null===(e=this.videoElement)||void 0===e||e.removeEventListener("seeked",o),t()}this.videoElement.addEventListener("seeked",o),this.videoElement.currentTime=e})}videoPlay(){var t,e,i,n;if(null===this.videoElement||void 0===this.videoElement)return;const o=fe(this.document,this.currentTimestamp);if(o<0)return;o>(null!==(e=null===(t=this.document.options)||void 0===t?void 0:t.end)&&void 0!==e?e:0)-(null!==(n=null===(i=this.document.options)||void 0===i?void 0:i.start)&&void 0!==n?n:0)||(this.videoPlaying=!0,this.videoElement.play().catch(t=>{this.videoPlaying=!1,console.error("[ERROR] Play error on video element.",this.document.name,t)}))}videoPause(){this.videoPlaying=!1,this.videoElement&&this.videoElement.pause()}videoStop(){this.videoPlaying=!1,this.displayFirstFrame(),this.videoElement&&this.videoElement.pause()}displayFrameAt(t){var e,i;let n="number"==typeof t?t:parseInt(t);if(!this.videoElement)return requestAnimationFrame(()=>{!1===this.isPlaying&&!1===this.videoPlaying&&this.displayFrameAt(t)});const o=pe(n/1e3);if(this.videoElement.currentTime===o)return;const r=null===(e=this.document.options)||void 0===e?void 0:e.start,s=null===(i=this.document.options)||void 0===i?void 0:i.end;this.videoPlaying&&(void 0!==r&&this.currentTimestamp<r||void 0!==s&&this.currentTimestamp>s)||("function"==typeof this.videoElement.fastSeek?this.videoElement.fastSeek(o):this.videoElement.currentTime=o)}displayFirstFrame(){const t=ye(this.videoOptions);this.displayFrameAt(t)}displayLastFrame(){var t,e;const i=Ae(this.videoOptions,null===(t=this.document.options)||void 0===t?void 0:t.start,null===(e=this.document.options)||void 0===e?void 0:e.end);this.displayFrameAt(i)}updateVideoFrame(){var t,e;const i=ve(this.document,this.videoOptions,this.currentTimestamp),n=Ae(this.videoOptions,null===(t=this.document.options)||void 0===t?void 0:t.start,null===(e=this.document.options)||void 0===e?void 0:e.end),o=ge(this.document);"once"===o&&i>n&&(this.hasPlayedOnce=!0,this.displayLastFrame()),"loop"!==o&&"solitary"!==o||this.displayFrameAt(i)}handleKeydown(t){t.preventDefault(),t.stopPropagation()}onTimeUpdate(){if(!this.isPlaying)return;const t=performance.now();this.lastTimeUpdateCall&&t-this.lastTimeUpdateCall<16||(this.lastTimeUpdateCall=t)}updateMuted(t){this.muted=t,this.videoElement&&(this.videoElement.muted=t)}getVideoSource(t){var e,i;let n=this.videoOptions.src;if(!n)return console.error("[ERROR] No source found for video.",t),"";const o=n.split(":")[0];if("http"===o||"https"===o){const t=(null===(i=null===(e=window.location)||void 0===e?void 0:e.protocol)||void 0===i?void 0:i.replace(":",""))||"";o!==t&&(n=n.replace(o,t))}return n}getImageSource(){var t,e,i;let n=null!==(t=this.imageOptions.src)&&void 0!==t?t:"./static_images/no-signal.png";const o=n.split(":")[0];if("http"===o||"https"===o){const t=(null===(i=null===(e=window.location)||void 0===e?void 0:e.protocol)||void 0===i?void 0:i.replace(":",""))||"";o!==t&&(n=n.replace(o,t))}return console.info("[INFO] Resolved image source:",n),n}render(){if(super.render(),"video"===this.mediaType)return ii(W`<video
        preload="auto"
        tabindex="-1"
        .src=${this.getVideoSource(this.document)}
        .autoplay=${!1}
        .loop=${!0}
        .controls=${!1}
        .playsInline=${!0}
      ></video>`);const{src:t,fillMode:e="cover"}=this.imageOptions;return ii(W`<img style="object-fit: ${e}" src="${t}" />`)}};Vi.styles=[...Ne.styles,l`
      :host {
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: transparent;
      }

      video,
      img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background-color: transparent;
      }
    `],t([gt("img"),e("design:type",HTMLImageElement)],Vi.prototype,"imageElement",void 0),t([gt("video"),e("design:type",HTMLVideoElement)],Vi.prototype,"videoElement",void 0),Vi=t([ct("media-renderer")],Vi);let Hi=class extends(oi(ti(ei))){constructor(){super(...arguments),this.currentSource=""}firstUpdated(t){super.firstUpdated(t),this.updateIframeSource()}setupVariableSubscriptions(){var t,e;const i=this.document;if("data-source"===(null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.mode)){const t=null===(e=null==i?void 0:i.content)||void 0===e?void 0:e["iframe-options-data-source"];let n=null;(null==t?void 0:t.variable)&&("string"==typeof t.variable?n=t.variable:"object"==typeof t.variable&&t.variable.variableId&&(n=t.variable.variableId)),n&&this.subscribeToVariable(n,t=>{this.updateIframeSource(),this.requestUpdate()})}}updateIframeSource(){var t,e;const i=this.document;if(!(null==i?void 0:i.content))return void(this.currentSource="");let n="";switch(i.content.mode||"static"){case"static":n=(null===(t=i.content["iframe-options-static"])||void 0===t?void 0:t.src)||"";break;case"media":n=(null===(e=i.content["iframe-options-media"])||void 0===e?void 0:e.src)||"";break;case"data-source":const o=i.content["iframe-options-data-source"];let r=null;if((null==o?void 0:o.variable)&&("string"==typeof o.variable?r=o.variable:"object"==typeof o.variable&&o.variable.variableId&&(r=o.variable.variableId)),r){const t=this.getVariableValue(r);null!=t&&(n=String(t))}break;default:n=""}this.currentSource=n?this.processIframeSource(n):""}updated(t){super.updated(t),(t.has("props")||t.has("document")||t.has("variables"))&&this.updateIframeSource()}processIframeSource(t){return t&&"string"==typeof t?((t=t.trim())&&!t.match(/^https?:\/\//i)&&(t=`https://${t}`),t):""}render(){var t,e,i;super.render();const n=this.document,o=null!==(i=null===(e=null===(t=null==n?void 0:n.content)||void 0===t?void 0:t.options)||void 0===e?void 0:e.scrolling)&&void 0!==i&&i,r="cpu"===this.playbackMode||"true"===this.editingMode?"disabled-interaction":"";return this.currentSource?ii(W`<iframe
      src="${this.currentSource}"
      sandbox="allow-same-origin allow-cross-origin allow-scripts allow-popups allow-forms"
      class="${r}"
      scrolling="${o?"yes":"no"}"
      loading="eager"
    ></iframe>`):ii(W`
        <div class="iframe-placeholder">
          No URL specified for iframe
        </div>
      `)}};function Gi(t,e,i){const n=new Map(e.map(t=>[t.id,t])),o=Ji(t).filter(t=>!n.has(t)),r=o.length>0,s=Zi(t.id,e),a=null!==s,l=Qi(t,n,i),d=l.length>0;return{isValid:!r&&!a&&!d,hasUndefinedReferences:r,hasCyclicDependency:a,hasCalculationIssues:d,undefinedVariableIds:o,cyclicPath:s||void 0,calculationIssues:l.length>0?l:void 0}}function Qi(t,e,i){var n;const o=[];if("function"!==t.type||!t.function)return o;const r=t.function,s=r.method;if("add"===s||"subtract"===s){const t=null!==(n=r.operands)&&void 0!==n?n:[];if(!t||0===t.length)return o.push("Math operation requires at least one value"),o;for(const n of t){const t=e.get(n);if(t&&(t.valueType&&!["number","any"].includes(t.valueType)&&o.push(`Variable "${t.name||n}" has type "${t.valueType}" but math operations require numeric values`),i))try{const e=i(n);if(null!=e){const i=parseFloat(e);isNaN(i)&&o.push(`Variable "${t.name||n}" evaluates to "${e}" which is not a valid number`)}}catch(e){o.push(`Failed to evaluate variable "${t.name||n}": ${e instanceof Error?e.message:"Unknown error"}`)}}}if("equals"===s){const t=r;[t.left,t.right].filter(t=>"string"==typeof t&&t.trim().length>0).length<1&&o.push("Boolean comparison requires at least one reference")}return o}function Ji(t){var e;const i=[];switch(t.type){case"fixed":break;case"function":{const n=t.function;if(!n)break;if("add"===n.method||"subtract"===n.method){const t=null!==(e=n.operands)&&void 0!==e?e:[];t&&i.push(...t.filter(t=>"string"==typeof t&&t.trim().length>0))}else if("equals"===n.method){const t=n,e=t.left,o=t.right;e&&e.trim()&&i.push(e),o&&o.trim()&&i.push(o)}break}}return i}function Zi(t,e){const i=new Map(e.map(t=>[t.id,t])),n=new Set,o=new Set,r=[];if(function t(e){if(o.has(e))return!0;if(n.has(e))return!1;n.add(e),o.add(e),r.push(e);const s=i.get(e);if(s){const e=Ji(s);for(const i of e)if(t(i))return!0}return o.delete(e),r.pop(),!1}(t)){const e=r.indexOf(t);return r.slice(e)}return null}function Ki(t,e){const i=new Map;for(const n of t)i.set(n.id,Gi(n,t,e));return i}function Yi(t){return t.hasCyclicDependency?"bg-red-900/30 border-red-500":t.hasUndefinedReferences||t.hasCalculationIssues?"bg-yellow-900/30 border-yellow-500":""}function Xi(t){var e;if(t.hasCyclicDependency){return`Cyclic dependency detected: ${(null===(e=t.cyclicPath)||void 0===e?void 0:e.join(" → "))||"unknown"}`}if(t.hasUndefinedReferences){const e=t.undefinedVariableIds.length;return`References ${e} undefined variable${e>1?"s":""}: ${t.undefinedVariableIds.join(", ")}`}return t.hasCalculationIssues&&t.calculationIssues?t.calculationIssues.join("; "):null}Hi.styles=[...Ne.styles,l`
      :host {
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: transparent;
      }

      iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        background-color: transparent;
      }

      iframe.disabled-interaction {
        pointer-events: none;
      }

      .iframe-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f5f5f5;
        color: #666;
        font-family: Arial, sans-serif;
        font-size: 14px;
        border: 2px dashed #ccc;
        box-sizing: border-box;
      }
    `],t([gt("iframe"),e("design:type",HTMLIFrameElement)],Hi.prototype,"iframeElement",void 0),t([mt(),e("design:type",String)],Hi.prototype,"currentSource",void 0),Hi=t([ct("iframe-renderer")],Hi),$t.register({type:"child-layout",data:{title:"Layout"},settings:{modal:!1,props:{width:!1,height:!1,background:!1,border:!1}},internal:!0,webComponent:ki}),$t.register({type:"child-playlist",data:{title:"Playlist"},internal:!0,settings:{modal:!1,props:{width:!1,height:!1,background:!1,border:!1}},webComponent:Ci}),$t.register({type:"image",data:{title:"Image"},settings:{modal:!1,content:{src:{type:"image",label:"Source",placeholder:"Image Source",variable:{types:["string"]},widgetBuilderSettings:{isDefinedByDynamicProperty:!1,hidden:!0}},fillMode:{type:"select",label:"Fill Mode",display:"layout",options:{contain:"Contain",cover:"Cover",fill:"Fill",none:"None","scale-down":"Scale Down"}}}},defaults:{content:{src:"",fillMode:"contain"}},internal:!0,webComponent:_i}),$t.register({type:"video",internal:!0,data:{title:"Video"},settings:{modal:!1,content:{src:{type:"video",label:"Source",placeholder:"Video Source"},volume:{type:"percent",label:"Volume",unit:"%",display:"layout"},"playback-mode":{type:"select",label:"Playback Mode",display:"layout",options:{loop:"Loop",once:"Once",solitary:"Solitary"}},"mark-in":{type:"number",label:"Mark In",unit:"ms",display:"layout"},"mark-out":{type:"number",label:"Mark Out",unit:"ms",display:"layout"},"play-start-delay":{type:"number",label:"Play Start Delay",unit:"ms",display:"layout"}}},defaults:{content:{src:"",volume:1,"playback-mode":"loop","mark-in":0,"mark-out":0,"play-start-delay":0}},webComponent:ni}),$t.register({type:"media",data:{title:"Media Zone",icon:"animated_images"},settings:{modal:!1,content:{"media-type":{type:"select",label:"Media Type",default:"image",options:{image:"Image",video:"Video"}},"image-options":{type:"object",label:"Image Options",logic:{if:{type:"equals",path:"content.media-type",value:"image",then:{display:!0},else:{display:!1}}},properties:{src:{type:"image",label:"Image Source",placeholder:"Enter image URL"},fillMode:{type:"select",label:"Fill Mode",display:"layout",options:{contain:"Contain",cover:"Cover",fill:"Fill",none:"None","scale-down":"Scale Down"}}}},"video-options":{type:"object",label:"Video Options",logic:{if:{type:"equals",path:"content.media-type",value:"video",then:{display:!0},else:{display:!1}}},properties:{src:{type:"video",label:"Video Source",placeholder:"Enter video URL"},volume:{type:"percent",label:"Volume",unit:"%",display:"layout"},"playback-mode":{type:"select",label:"Playback Mode",display:"layout",options:{loop:"Loop",once:"Once",solitary:"Solitary"}},"mark-in":{type:"number",label:"Mark In",unit:"ms"},"mark-out":{type:"number",label:"Mark Out",unit:"ms"}}}}},defaults:{content:{"media-type":"image","image-options":{src:"",fillMode:"contain"},"video-options":{src:"",volume:1,"playback-mode":"loop","mark-in":0,"mark-out":0}}},webComponent:Vi}),$t.register({type:"audio",internal:!0,data:{title:"Audio"},settings:{modal:!1,props:{x:!1,y:!1,width:!1,height:!1,background:!1,border:!1,clip:!1,transform:!1,rotate:!1,scale:!1,skew:!1,opacity:!1},content:{src:{type:"audio",label:"Source",placeholder:"Audio Source"},volume:{type:"percent",label:"Volume",unit:"%",display:"layout"},"playback-mode":{type:"select",label:"Playback Mode",display:"layout",options:{loop:"Loop",once:"Once",solitary:"Solitary"}},"mark-in":{type:"number",label:"Mark In",unit:"ms"},"mark-out":{type:"number",label:"Mark Out",unit:"ms"}}},defaults:{content:{src:"",volume:1,"playback-mode":"loop","mark-in":0,"mark-out":0}},webComponent:Di}),$t.register({type:"iframe",data:{title:"iFrame",icon:"web"},settings:{modal:!1,content:{mode:{type:"select",label:"Source Type",default:"static",disabled:"template",options:{static:"Static URL",media:"Media Asset","data-source":"Data Source"},widgetBuilderSettings:{isDefinedByDynamicProperty:!1,hidden:!0}},"iframe-options-static":{type:"object",label:"",logic:{if:{type:"equals",path:"content.mode",value:"static",then:{display:!0},else:{display:!1}}},properties:{src:{type:"text",label:"URL",placeholder:"Enter website URL (e.g., https://example.com)",default:""}}},"iframe-options-media":{type:"object",label:"",logic:{if:{type:"equals",path:"content.mode",value:"media",then:{display:!0},else:{display:!1}}},properties:{src:{type:"webpage",label:"Webpage",placeholder:"Select a webpage media asset"}}},"iframe-options-data-source":{type:"object",label:"",logic:{if:{type:"equals",value:"data-source",path:"content.mode",then:{display:!0},else:{display:!1}}},properties:{variable:{type:"variable",label:"Variable",placeholder:"Select a variable"}}},dividerOptions:{type:"divider",display:"layout",widgetBuilderSettings:{isDefinedByDynamicProperty:!1,hidden:!0}},options:{type:"object",label:"Display Options",display:"layout",properties:{scrolling:{type:"boolean",label:"Show Scrollbars",default:!1}}}}},defaults:{content:{mode:"static","iframe-options-static":{src:""},"iframe-options-media":{src:""},"iframe-options-data-source":{variable:""},options:{scrolling:!1}}},webComponent:Hi}),$t.register({type:"streaming",data:{title:"Streaming",icon:"stream"},settings:{modal:!1,content:{src:{type:"external-url",label:"Stream URL",placeholder:"Enter streaming URL (HLS, MPEG-DASH, or WebRTC)"},type:{type:"select",label:"Stream Type",options:{hls:"HLS","mpeg-dash":"MPEG-DASH",webrtc:"WebRTC"}}}},defaults:{content:{src:"",type:"webrtc"}},webComponent:Ti}),$t.register({type:"container",internal:!0,data:{title:"Container",icon:"grid"},webComponent:$i}),$t.register({type:"flexbox",internal:!1,data:{title:"Flexbox",icon:"view_quilt"},settings:{modal:!1,content:{direction:{type:"select",label:"Direction",display:"layout",options:{row:"Row",column:"Column"}},justify:{type:"select",label:"Justify Content",display:"layout",options:{start:"Start",center:"Center",end:"End","space-between":"Space Between","space-around":"Space Around","space-evenly":"Space Evenly"}},align:{type:"select",label:"Align Items",display:"layout",options:{start:"Start",center:"Center",end:"End"}},overflow:{type:"select",label:"Overflow",display:"layout",options:{wrap:"Wrap",scroll:"Scroll",hidden:"Hidden"}},rowGap:{type:"number",label:"Row Gap",unit:"px",display:"layout"},columnGap:{type:"number",label:"Column Gap",unit:"px",display:"layout"}}},defaults:{width:400,height:300,content:{direction:"row",justify:"start",align:"start",overflow:"wrap",rowGap:0,columnGap:0}},webComponent:Li}),$t.register({type:"mpv",internal:!1,data:{title:"MPV",icon:"display_external_input"},settings:{modal:!1,content:{source:{type:"text",label:"Source",placeholder:"MPV Source"}}},defaults:{content:{source:""}},webComponent:Ri}),$t.register({type:"text",data:{title:"Text",icon:"serif"},settings:{modal:!1,content:{mode:{type:"select",label:"Type",default:"static",disabled:"template",options:{static:"Static",dynamic:"Dynamic"},widgetBuilderSettings:{isDefinedByDynamicProperty:!1,hidden:!0}},"text-options-static":{type:"object",label:"",logic:{if:{type:"equals",path:"content.mode",value:"static",then:{display:!0},else:{display:!1}}},properties:{text:{type:"rich-text",label:"Text",default:"<p>Hello, World!</p>",widgetBuilderSettings:{isDefinedByDynamicProperty:!0,hidden:!0}}}},"text-options-dynamic":{type:"object",label:"Text Options",logic:{if:{type:"equals",value:"dynamic",path:"content.mode",then:{display:!0},else:{display:!1}}},properties:{fallback:{type:"rich-text",label:"Fallback Text",default:"Hello, World!"},"data-source":{type:"object",label:"Data Source",properties:{domain:{type:"text",label:"Domain",disabled:"template",placeholder:"https://example.com"},port:{type:"text",label:"Port",disabled:"template",placeholder:"80"},route:{type:"text",label:"Route",disabled:"template",placeholder:"/api/data"},"value-path":{type:"text",label:"Value Path",disabled:"template",placeholder:"value.array[0].text"},"refresh-rate":{type:"select",label:"Refresh Rate",disabled:"template",options:{10:"10s",30:"30s",60:"60s (1m)",120:"120s (2m)",240:"240s (4m)",300:"300s (5m)",600:"600s (10m)",900:"900s (15m)",1800:"1800s (30m)",3600:"3600s (1h)"}}}}},widgetBuilderSettings:{isDefinedByDynamicProperty:!1,hidden:!0}},dividerOptions:{type:"divider",display:"layout",widgetBuilderSettings:{isDefinedByDynamicProperty:!1,hidden:!0}},options:{type:"object",label:"Options",display:"layout",properties:{color:{type:"color",label:"Text Color"},opacity:{type:"percent",label:"Text Opacity",unit:"%"},dividerTypography:{type:"divider"},typography:{type:"object",label:"Typography",display:"layout",properties:{fontFamily:{type:"font-family",label:"Font Family"},fontSize:{type:"number",label:"Font Size",unit:"px"},textDecoration:{type:"select",label:"Text Decoration",options:{none:"None",underline:"Underline",overline:"Overline"}},textTransform:{type:"select",label:"Text Transform",options:{none:"None",uppercase:"Uppercase",lowercase:"Lowercase",capitalize:"Capitalize"}},lineHeight:{type:"text",label:"Line Height"},letterSpacing:{type:"number",label:"Letter Spacing",unit:"px"},fontWeight:{type:"select",label:"Font Weight",options:{normal:"Normal",bold:"Bold",bolder:"Bolder",lighter:"Lighter",100:"100",200:"200",300:"300",400:"400",500:"500",600:"600",700:"700",800:"800",900:"900"}},fontStyle:{type:"select",label:"Font Style",options:{normal:"Normal",italic:"Italic",oblique:"Oblique"}},textAlign:{type:"select",label:"Text Align",options:{left:"Left",center:"Center",right:"Right",justify:"Justify"}},verticalAlign:{type:"select",label:"Vertical Align",options:{top:"Top",middle:"Middle",bottom:"Bottom"}}}},dividerPadding:{type:"divider",display:"layout"},padding:{type:"object",label:"Padding",display:"layout",properties:{top:{type:"number",label:"Top",unit:"px"},bottom:{type:"number",label:"Bottom",unit:"px"},left:{type:"number",label:"Left",unit:"px"},right:{type:"number",label:"Right",unit:"px"}}},dividerAnimation:{type:"divider",display:"layout"},animation:{type:"select",label:"Animation",display:"layout",options:{none:"None",crawl:"Crawl",roll:"Roll"}},animationIn:{type:"select",label:"Animation In",display:"layout",options:{none:"None",fade:"Fade",slide:"Slide",zoom:"Zoom"}},animationOut:{type:"select",label:"Animation Out",display:"layout",options:{none:"None",fade:"Fade",slide:"Slide",zoom:"Zoom"}},dividerShadow:{type:"divider",display:"layout"},shadow:{type:"object",label:"Text Shadow",display:"layout",properties:{hidden:{type:"boolean",label:"Hidden"},options:{type:"object",display:"layout",logic:{if:{type:"equals",path:"content.options.shadow.hidden",value:!1,then:{display:!0},else:{display:!1}}},properties:{color:{type:"color",label:"Color"},opacity:{type:"percent",label:"Opacity",unit:"%"},blur:{type:"number",label:"Blur",unit:"px"},offset:{type:"number",label:"Offset",unit:"px"},angle:{type:"number",label:"Angle",unit:"deg"}}}}}}}}},defaults:{width:200,height:100,content:{mode:"static","text-options-static":{text:"<p>Hello, World!</p>"},"text-options-dynamic":{fallback:"Hello, World!","data-source":{domain:"",port:"80",route:"","value-path":"","refresh-rate":"60"}},options:{color:"#000000",typography:{fontFamily:"Arial",fontSize:16,textDecoration:"none",textTransform:"none",lineHeight:"normal",letterSpacing:0,fontWeight:"normal",fontStyle:"normal",textAlign:"left",verticalAlign:"top"},padding:{top:0,right:0,bottom:0,left:0},opacity:1,animation:"none",animationIn:"none",animationOut:"none",shadow:{hidden:!0,options:{color:"#000000",opacity:100,blur:10,offset:10,angle:45}}}}},webComponent:wi}),$t.register({type:"file-gallery",internal:!1,data:{title:"File Gallery",icon:"gallery_thumbnail"},settings:{modal:"layout",content:{queryString:{type:"media-query",readonly:!0,display:"layout",label:"Query"},results:{type:"media-items-list",label:"Results"}}},webComponent:Oi,settingsComponent:Ii}),$t.register({type:"qr-code",data:{title:"QR Code",icon:"qr_code_2"},settings:{modal:!0,props:{background:!1},content:{qrType:{type:"select",label:"QR Code Type",options:{text:"Plain Text",url:"URL",phone:"Phone",sms:"SMS",email:"Email",wifi:"Wi-Fi",geo:"Geo",vcard:"vCard"},disabled:!0},value:{type:"text",label:"Value",placeholder:"Enter value for QR code",disabled:!0},shape:{type:"select",label:"Shape",display:!1,options:{square:"Square",circle:"Circle"},disabled:!0},background:{type:"color",label:"Background Color",disabled:!0,display:!1},dotsOptions:{type:"object",label:"Dots",disabled:!0,display:!1,properties:{color:{type:"color",label:"Color",disabled:!0},type:{type:"select",label:"Type",disabled:!0,options:{square:"Square",circle:"Circle"}}}},cornersOptions:{type:"object",label:"Corners",disabled:!0,display:!1,properties:{color:{type:"color",label:"Color",disabled:!0},type:{type:"select",label:"Type",disabled:!0,options:{square:"Square",circle:"Circle"}}}}}},defaults:{content:{qrType:"text",value:"Default QR-Code Value",shape:"square",background:"#ffffff",dotsOptions:{color:"#000000",type:"square"},cornersOptions:{color:"#000000",type:"square"}}},webComponent:Ui,settingsComponent:Wi});const tn=[...Object.keys(le),"Helvetica","Arial","Verdana","Tahoma","Trebuchet MS","Times New Roman","Georgia","Garamond","Courier New","Brush Script MT"],en=$t,nn=new Set;let on=class extends lt{get resolvedDocument(){var t;if(this._resolvedDocument)return this._resolvedDocument;try{(null===(t=this.document)||void 0===t?void 0:t.dataLayer)&&!this.dataLayerManager.isInitialized()&&this.dataLayerManager.initialize(this.document.dataLayer);const e=this.dataLayerManager.setDocument(this.document);return this._resolvedDocument=e,e}catch(t){console.error("[LayoutRenderer] Failed to resolve document on demand:",t);const e=this.dataLayerManager.setDocument(this.document);return this._resolvedDocument=e,e}}set resolvedDocument(t){this._resolvedDocument=t}constructor(){var t;if(super(),this.document=vt,this.editingMode="false",this.playbackMode="gpu",this.zoomFactor=1,this.currentTimestamp=0,this.frameRate=30,this.isChildLayout=!1,this.assets=[],this.hasPlayedOnce=!1,this.isPlaying=!1,this.audioTimeline=[],this.isPrefetching=!1,this.rendererManager=new ae,this.dataLayerManager=new Le,this.canPlayAudio=!1,async function(t){const e=document.createElement("style");let i="";for(const[e,n]of Object.entries(t)){const t=n.variants[0];if(!t){console.warn(`[WARNING] No variants found for font family: ${n.family}`);continue}const e=await de(t.src);if(!e){console.error(`[ERROR] Could not find fonts for family: ${n.family}`);continue}const o=e.replace(t.src,"");n.variants.forEach(t=>{const e=`${o}${t.src}`,r=document.createElement("link");r.href=e,r.rel="prefetch",r.as="font",r.type="font/woff2",document.head.appendChild(r),i+=`\n@font-face {\n  font-family: '${n.family}';\n  src: url('${e}') format('woff2');\n  font-weight: ${t.weight};\n  font-style: ${t.style};\n}`})}e.textContent=i,document.head.appendChild(e)}(le),null===(t=this.document)||void 0===t?void 0:t.dataLayer){this.dataLayerManager.initialize(this.document.dataLayer);const t=this.dataLayerManager.setDocument(this.document);this._resolvedDocument=t}void 0===this.renderer&&(this.rendererManager.setDataLayerManager(this.dataLayerManager),this.renderer=this.rendererManager.buildRenderer(this.resolvedDocument,this.editingMode,this.playbackMode,this.zoomFactor,this.currentTimestamp,this.frameRate)),this.prepareMediaAssets(this.resolvedDocument).catch(t=>console.error("[ERROR] Error prefetching media:",t)),this.unsubscribeDataLayerDoc=this.dataLayerManager.subscribeToDocumentUpdates(t=>{try{this.resolvedDocument=t,this.rendererManager.setDataLayerManager(this.dataLayerManager),this.rendererManager.updateRenderer(t,this.editingMode,this.playbackMode,this.zoomFactor,this.currentTimestamp,this.frameRate)}catch(t){console.error("[LayoutRenderer] Failed to update renderer from data layer doc:",t)}}),ue().then(t=>{t?(console.info("[INFO] videos can autoplay with sound."),this.canPlayAudio=!0):(console.info("[INFO] videos cannot autoplay with sound."),this.canPlayAudio=!1)})}connectedCallback(){super.connectedCallback(),this.isChildLayout||(this.style.scale=`${this.zoomFactor}`,this.style.transformOrigin="top left",this.addEventListener("update-document",this.updateDocument.bind(this)),this.addEventListener("open-context-menu",t=>this.openContextMenu(t)),this.addEventListener("selection-change",t=>this.selectionChange(t)),this.addEventListener("dimensions-changed",t=>{const e=t.detail.element,i=e.document.id,{document:n}=se(i,this.document),o=structuredClone(e.props);if(!o||!n)return void console.error("[ERROR] Could not find document node for ID",i);const r=oe(n.props,o.props);this.recursiveDocumentUpdate(n,{options:{...n.options},props:r})}))}disconnectedCallback(){var t;super.disconnectedCallback(),this.rendererManager.cleanUpRenderers();try{null===(t=this.unsubscribeDataLayerDoc)||void 0===t||t.call(this)}catch{}this.dataLayerManager.cleanup(),this.removeEventListener("update-document",this.updateDocument.bind(this)),this.removeEventListener("open-context-menu",t=>this.openContextMenu(t)),this.removeEventListener("selection-change",t=>this.selectionChange(t))}updated(t){if(void 0===this.document)return;let e=!1;if(t.has("document")){const i=structuredClone(t.get("document"));if(!te(this.document,i)){this.dataLayerManager.initialize(this.document.dataLayer);const t=this.dataLayerManager.setDocument(this.document),i=structuredClone(this.resolvedDocument);this.resolvedDocument=t;(()=>{var e,n,o,r;if(!i)return!0;const s={...i,children:[]},a={...t,children:[]};return!te(s,a)||(null!==(n=null===(e=i.children)||void 0===e?void 0:e.length)&&void 0!==n?n:0)!==(null!==(r=null===(o=t.children)||void 0===o?void 0:o.length)&&void 0!==r?r:0)})()?(this.rendererManager.setDataLayerManager(this.dataLayerManager),this.renderer=this.rendererManager.buildRenderer(t,this.editingMode,this.playbackMode,this.zoomFactor,this.currentTimestamp,this.frameRate)):e=!0,this.prepareMediaAssets(this.resolvedDocument).catch(t=>console.error("[ERROR] Error prefetching media:",t)),function({layoutRenderer:t}){if(null!==t&&void 0!==t.document&&void 0!==t.document.props){try{t.style.setProperty("--layout-width",`${t.document.props.width}px`)}catch(t){console.error("[ERROR] Could not set layout width",t)}try{t.style.setProperty("--layout-height",`${t.document.props.height}px`)}catch(t){console.error("[ERROR] Could not set layout height",t)}try{t.style.setProperty("--layout-background",`${t.document.props.background}`)}catch(t){console.error("[ERROR] Could not set layout background",t)}}}({layoutRenderer:this})}}if(t.has("zoomFactor")&&(this.style.scale=`${this.zoomFactor}`,this.style.transformOrigin="top left",this.rendererManager.updateZoomFactor(this.zoomFactor)),t.has("currentTimestamp")&&this.rendererManager.updateCurrentTimestamp(this.currentTimestamp),t.has("editingMode")&&(this.stop(),e=!0),t.has("playbackMode")&&("step"===this.playbackMode&&this.stop(),"gpu"===this.playbackMode&&(this.editingMode="false")),"step"===this.playbackMode&&(e=!1),e){this.rendererManager.setDataLayerManager(this.dataLayerManager);const t=this.rendererManager.updateRenderer(this.resolvedDocument,this.editingMode,this.playbackMode,this.zoomFactor,this.currentTimestamp,this.frameRate);this.renderer=t}}updateDocument(t){this.dispatchEvent(new CustomEvent("onDocumentUpdate",{bubbles:!0,detail:structuredClone(t)}));const e=this.dataLayerManager.setDocument(t);this.resolvedDocument=e,this.document=t}openContextMenu(t){console.info("[INFO] Opening context menu",t),t.preventDefault()}selectionChange(t){var e,i,n;t.preventDefault();const o=t.detail.element,r=o.document.id,{document:s}=se(r,this.resolvedDocument);if(!s)return void console.error("[ERROR] Could not find document node for ID",r);if(void 0===s.options&&(console.warn("[WARN] No options found for document. Setting default options."),s.options={selected:!1,locked:!1,visible:!0,start:0,end:null!==(e=this.resolvedDocument.options.duration)&&void 0!==e?e:0}),("false"===this.editingMode||"template"===this.editingMode)&&((null===(i=s.options)||void 0===i?void 0:i.locked)||!1===(null===(n=s.options)||void 0===n?void 0:n.visible)))return;const a=!("boolean"==typeof o.selected&&o.selected);this.recursiveDocumentUpdate(s,{options:{...s.options,selected:a}})}play(){var t;if(this.isPlaying)return Promise.resolve();if(this.isPlaying=!0,void 0!==this.playbackInterval)return console.warn(`[WARN] Could not play layout "${this.resolvedDocument.name}". Layout is already playing.`),Promise.resolve();const e=1e3/this.frameRate,i=null!==(t=this.resolvedDocument.options.duration)&&void 0!==t?t:0;return this.playbackStartTime=performance.now(),this.playbackStartTimestamp=this.currentTimestamp,this.playbackInterval=window.setInterval(()=>{var t;if(0===i)return void(this.currentTimestamp=0);const e=performance.now()-this.playbackStartTime,n=this.playbackStartTimestamp+e;if(this.resolvedDocument.options&&this.resolvedDocument.options.duration&&this.resolvedDocument.options.duration>0&&n>this.resolvedDocument.options.duration){this.hasPlayedOnce=!0,null===(t=this.onHasPlayedOnce)||void 0===t||t.call(this);const e=n-this.resolvedDocument.options.duration;return this.playbackStartTime=performance.now()-e,this.playbackStartTimestamp=0,void(this.currentTimestamp=e)}this.currentTimestamp=n,"cpu"!==this.playbackMode&&"false"===this.editingMode||requestAnimationFrame(()=>{this.rendererManager.renderFrame(this.currentTimestamp).catch(t=>{console.error("[ERROR] Failed to render frame during play loop:",t)})})},e),!1===this.editingMode&&console.warn("[WARN] Editing mode must be passed as a string.",this),"gpu"===this.playbackMode&&"false"===this.editingMode?console.info(`[INFO] Playing layout "${this.resolvedDocument.name}" with hardware acceleration.`):console.info(`[INFO] Playing layout "${this.resolvedDocument.name}" without hardware acceleration.`),this.rendererManager.play(),Promise.resolve()}pause(){return this.isPlaying?(this.isPlaying=!1,window.clearInterval(this.playbackInterval),this.playbackInterval=void 0,this.playbackStartTime=void 0,this.playbackStartTimestamp=void 0,this.rendererManager.pause(),Promise.resolve()):Promise.resolve()}stop(){this.isPlaying=!1,window.clearInterval(this.playbackInterval),this.currentTimestamp=0,this.playbackInterval=void 0,this.playbackStartTime=void 0,this.playbackStartTimestamp=void 0,this.rendererManager.stop(),this.rendererManager.setDataLayerManager(this.dataLayerManager);const t=this.rendererManager.updateRenderer(this.resolvedDocument,this.editingMode,this.playbackMode,this.zoomFactor,0,this.frameRate);return this.renderer=t,Promise.resolve()}async nextFrame(){var t,e;if(this.isPlaying)throw new Error("[LayoutRenderer] ERROR: Layout is playing. Cannot call nextFrame.");if("step"!==this.playbackMode)throw new Error("[LayoutRenderer] ERROR: Layout is not in step mode. Cannot call nextFrame.");const i=1e3/this.frameRate,n=this.currentTimestamp+i;if(this.resolvedDocument.options&&this.resolvedDocument.options.duration&&this.resolvedDocument.options.duration>0&&n>this.resolvedDocument.options.duration)return this.hasPlayedOnce=!0,null===(t=this.onHasPlayedOnce)||void 0===t||t.call(this),void(this.currentTimestamp=(null!==(e=this.resolvedDocument.options.duration)&&void 0!==e?e:0)-n);this.currentTimestamp=n;this.rendererManager.renderFrame(n,()=>{var t;return null===(t=this.onFrameLoaded)||void 0===t?void 0:t.call(this,{timestamp:this.currentTimestamp})}).then().catch(t=>{throw console.error("[ERROR] Failed to render frame:",t),t})}recursiveDocumentUpdate(t,e){const i=structuredClone(this.document),n=i=>{const o={...i};return o.id===t.id?(Object.entries(e).forEach(([t,e])=>{o[t]=e}),o):(Array.isArray(o.children)&&(o.children=o.children.map(t=>n(t))),o)};return Array.isArray(i.children)&&(i.children=i.children.map(n)),this.updateDocument(i),i}async prepareMediaAssets(t){var e;if(this.isChildLayout)this.isPrefetching=!1;else try{const e=ft(t,[]);this.assets=e,window.assets=JSON.stringify(e),this.prepareAudioTimeline(e);const i=new Set,n=Array.from(new Set(e)).filter(t=>!i.has(t.src)&&!nn.has(t.src)&&(i.add(t.src),!0));if(0===n.length)return;const o=n.sort((t,e)=>t.priority-e.priority);for(let t=0;t<o.length;t++){const e=o[t];await this.prefetchAsset(e.src,e.type)}}catch(t){console.error("[ERROR] Failed to prefetch media assets:",t)}finally{this.isPrefetching=!1,null===(e=this.onLayoutLoaded)||void 0===e||e.call(this,{canPlayAudio:this.canPlayAudio,isPrefetching:this.isPrefetching})}}async prepareAudioTimeline(t){const e=[],i=new Map;for(const n of t){let t=!1;"audio"===n.type?t=!0:"video"===n.type&&(i.has(n.src)?t=i.get(n.src):(t=await he(n.src),i.set(n.src,t))),t&&e.push({from:n.start,to:n.end})}e.sort((t,e)=>t.from-e.from);const n=[];let o=e[0];for(let t=1;t<e.length;t++){const i=e[t];i.from<=o.to?o.to=Math.max(o.to,i.to):(n.push(o),o=i)}o&&n.push(o),this.audioTimeline=n}async prefetchAsset(t,e){var i,n;if(nn.has(t))return;nn.add(t),this.isPrefetching=!0;const o=t.split(":")[0];if("http"!==o&&"https"!==o)return;const r=(null===(n=null===(i=window.location)||void 0===i?void 0:i.protocol)||void 0===n?void 0:n.replace(":",""))||"";return o!==r&&(t=t.replace(o,r)),new Promise((i,n)=>{if("image"===e){const e=new Image;e.onload=()=>i(),e.onerror=e=>n(new Error(`Failed to load image: ${t} – ${JSON.stringify(e)}`)),e.src=t}if("video"===e){const e=document.createElement("video");e.onloadeddata=()=>i(),e.onerror=()=>n(new Error(`Failed to load video: ${t}`)),e.src=t,e.load()}if("audio"===e){const e=document.createElement("audio");e.onloadeddata=()=>i(),e.onerror=()=>n(new Error(`Failed to load audio: ${t}`)),e.src=t,e.load()}})}render(){if(!this.document)return console.error("[ERROR] No document found for layout renderer."),W` <div>No document found.</div>`;const t=this.renderer;return t?(this.style.scale=`${this.zoomFactor}`,this.style.transformOrigin="top left",W`
      <div
        style="position: relative; width: 100%; height: 100%; overflow: hidden;"
      >
        ${this.isPrefetching?W`
              <div
                style="
                  position: absolute;
                  width: 20%;
                  height: 20%;
                  top: 50%;
                  left: 50%;
                  transform: translate(-50%, -50%);
                  z-index: 10000;
                  background: rgba(255, 255, 255);
                  color: #000;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  text-align: center;
                  padding: 10px;
                  border-radius: 4px;
                  pointer-events: none;
                "
              >
                loading...
              </div>
            `:null}
        ${t}
      </div>
    `):(console.error("[ERROR] No renderer found for layout renderer."),W` <div>No renderer found.</div>`)}};on.styles=re,t([pt({type:Object}),e("design:type",Object)],on.prototype,"document",void 0),t([pt({type:String}),e("design:type",String)],on.prototype,"editingMode",void 0),t([pt({type:String}),e("design:type",String)],on.prototype,"playbackMode",void 0),t([pt({type:Number}),e("design:type",Object)],on.prototype,"zoomFactor",void 0),t([pt({type:Number}),e("design:type",Object)],on.prototype,"currentTimestamp",void 0),t([pt({type:Number}),e("design:type",Object)],on.prototype,"frameRate",void 0),t([pt({type:Boolean}),e("design:type",Object)],on.prototype,"isChildLayout",void 0),t([pt({type:Function}),e("design:type",Function)],on.prototype,"onLayoutLoaded",void 0),t([pt({type:Function}),e("design:type",Function)],on.prototype,"onFrameLoaded",void 0),t([pt({type:Function}),e("design:type",Function)],on.prototype,"onHasPlayedOnce",void 0),t([mt(),e("design:type",Array)],on.prototype,"assets",void 0),t([mt(),e("design:type",Object)],on.prototype,"hasPlayedOnce",void 0),t([mt(),e("design:type",Object)],on.prototype,"isPlaying",void 0),t([mt(),e("design:type",Object)],on.prototype,"isPrefetching",void 0),on=t([ct("layout-renderer"),e("design:paramtypes",[])],on);export{Le as DataLayerManager,tn as RENDERER_STATIC_FONTS,De as broadcastChannel,on as default,Zi as detectCyclicDependency,Ji as getReferencedVariableIds,Xi as getValidationMessage,Me as getValueByPath,Yi as getVariableStatusClass,Ki as validateAllVariables,Qi as validateCalculation,Gi as validateVariable,en as widgetRegistry};
//# sourceMappingURL=index.js.map
